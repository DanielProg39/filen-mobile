{"ast":null,"code":"import * as language from \"../utils/language\";\nimport { loadingController, modalController, popoverController, alertController, actionSheetController } from \"@ionic/core\";\nimport * as Ionicons from 'ionicons/icons';\nimport { Capacitor, HapticsImpactStyle, Plugins } from \"@capacitor/core\";\nimport { FileOpener } from \"@ionic-native/file-opener\";\n\nconst utils = require(\"../utils/utils\");\n\nconst safeAreaInsets = require('safe-area-insets');\n\nexport async function updateItemList(showLoader = true) {\n  if (!this.state.isLoggedIn) {\n    return this.showLogin();\n  }\n\n  if (this.state.userAPIKey.length <= 16) {\n    return this.showLogin();\n  }\n\n  if (Capacitor.isNative) {\n    Capacitor.Plugins.Keyboard.hide();\n    Plugins.SplashScreen.hide();\n  }\n\n  this.setState({\n    searchbarOpen: false,\n    mainSearchTerm: \"\"\n  });\n  let routeEx = window.location.hash.split(\"/\");\n  let parent = routeEx[routeEx.length - 1];\n\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  window.customVariables.currentThumbnailURL = window.location.href;\n  let items = [];\n\n  if (parent == \"base\") {\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/user/baseFolders\", {\n        apiKey: this.state.userAPIKey\n      });\n    } catch (e) {\n      console.log(e);\n      window.customFunctions.dismissLoader();\n      let alert = await alertController.create({\n        header: \"\",\n        subHeader: \"\",\n        message: language.get(this.state.lang, \"apiRequestError\"),\n        buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n      });\n      return alert.present();\n    }\n\n    if (!res.status) {\n      console.log(res.message);\n      window.customFunctions.dismissLoader();\n      let alert = await alertController.create({\n        header: \"\",\n        subHeader: \"\",\n        message: language.get(this.state.lang, \"apiRequestError\"),\n        buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n      });\n      return alert.present();\n    }\n\n    items.push({\n      type: \"folder\",\n      uuid: \"default\",\n      name: \"Default\",\n      date: language.get(this.state.lang, \"defaultFolder\"),\n      timestamp: +new Date() / 1000 - 86400 * 3650,\n      parent: \"base\",\n      receiverId: 0,\n      receiverEmail: \"\",\n      sharerId: 0,\n      sharerEmail: \"\",\n      color: null\n    });\n\n    for (let i = 0; i < res.data.folders.length; i++) {\n      let folder = res.data.folders[i];\n      let folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid);\n      let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n      let item = {\n        type: \"folder\",\n        uuid: folder.uuid,\n        name: utils.sanitizeHTML(folderName),\n        date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n        timestamp: folder.timestamp,\n        parent: \"base\",\n        receiverId: 0,\n        receiverEmail: \"\",\n        sharerId: 0,\n        sharerEmail: \"\",\n        color: folder.color || null\n      };\n      items.push(item);\n      window.customVariables.cachedFolders[folder.uuid] = item;\n    }\n\n    let iItems = [];\n    iItems.push(items[0]);\n\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].name.toLowerCase() == \"filen sync\" && items[i].uuid !== \"default\") {\n        iItems.push(items[i]);\n      }\n    }\n\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].name.toLowerCase() !== \"filen sync\" && items[i].uuid !== \"default\") {\n        iItems.push(items[i]);\n      }\n    }\n\n    items = iItems;\n  } else {\n    if (routeEx[1] == \"shared-in\") {\n      try {\n        var usrPrivKey = await window.crypto.subtle.importKey(\"pkcs8\", utils._base64ToArrayBuffer(this.state.userPrivateKey), {\n          name: \"RSA-OAEP\",\n          hash: \"SHA-512\"\n        }, true, [\"decrypt\"]);\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"unknownDeviceError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/in\", {\n          apiKey: this.state.userAPIKey,\n          uuid: parent,\n          folders: JSON.stringify([\"shred-in\"]),\n          page: 1,\n          app: \"true\"\n        });\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      if (!res.status) {\n        console.log(res.message);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      for (let i = 0; i < res.data.folders.length; i++) {\n        let folder = res.data.folders[i];\n        let folderName = await utils.decryptFolderNamePrivateKey(folder.metadata, usrPrivKey, folder.uuid);\n        let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n        let item = {\n          type: \"folder\",\n          uuid: folder.uuid,\n          name: utils.sanitizeHTML(folderName),\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: folder.timestamp,\n          parent: folder.parent,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: folder.sharerId,\n          sharerEmail: folder.sharerEmail,\n          color: folder.color || null\n        };\n        items.push(item);\n        window.customVariables.cachedFolders[folder.uuid] = item;\n      }\n\n      for (let i = 0; i < res.data.uploads.length; i++) {\n        let file = res.data.uploads[i];\n        let decryptedMetadata = await utils.decryptFileMetadataPrivateKey(file.metadata, usrPrivKey, file.uuid);\n        let uploadDate = new Date(file.timestamp * 1000).toString().split(\" \");\n        let offline = false;\n\n        if (typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\") {\n          offline = true;\n        }\n\n        let item = {\n          type: \"file\",\n          uuid: file.uuid,\n          name: utils.sanitizeHTML(decryptedMetadata.name),\n          mime: utils.sanitizeHTML(decryptedMetadata.mime),\n          size: parseInt(decryptedMetadata.size),\n          key: utils.sanitizeHTML(decryptedMetadata.key),\n          bucket: file.bucket,\n          region: file.region,\n          parent: file.parent,\n          rm: file.rm,\n          chunks: file.chunks,\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: file.timestamp,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: file.sharerId,\n          sharerEmail: file.sharerEmail,\n          offline: offline,\n          thumbnail: typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined\n        };\n        items.push(item);\n        window.customVariables.cachedFiles[file.uuid] = item;\n      }\n    } else if (routeEx[1] == \"shared-out\") {\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/out\", {\n          apiKey: this.state.userAPIKey,\n          uuid: parent,\n          folders: JSON.stringify([\"default\"]),\n          page: 1,\n          app: \"true\",\n          receiverId: this.state.currentReceiverId\n        });\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      if (!res.status) {\n        console.log(res.message);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      for (let i = 0; i < res.data.folders.length; i++) {\n        let folder = res.data.folders[i];\n        let folderName = utils.decryptCryptoJSFolderName(folder.metadata, this.state.userMasterKeys, folder.uuid);\n        let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n        let item = {\n          type: \"folder\",\n          uuid: folder.uuid,\n          name: utils.sanitizeHTML(folderName),\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: folder.timestamp,\n          parent: folder.parent,\n          receiverId: folder.receiverId,\n          receiverEmail: folder.receiverEmail,\n          sharerId: 0,\n          sharerEmail: \"\",\n          color: folder.color || null\n        };\n        items.push(item);\n        window.customVariables.cachedFolders[folder.uuid] = item;\n      }\n\n      for (let i = 0; i < res.data.uploads.length; i++) {\n        let file = res.data.uploads[i];\n        let metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid);\n        let uploadDate = new Date(file.timestamp * 1000).toString().split(\" \");\n        let offline = false;\n\n        if (typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\") {\n          offline = true;\n        }\n\n        let item = {\n          type: \"file\",\n          uuid: file.uuid,\n          name: utils.sanitizeHTML(metadata.name),\n          mime: utils.sanitizeHTML(metadata.mime),\n          size: parseInt(metadata.size),\n          key: utils.sanitizeHTML(metadata.key),\n          bucket: file.bucket,\n          region: file.region,\n          parent: file.parent,\n          rm: file.rm,\n          chunks: file.chunks,\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: file.timestamp,\n          receiverId: file.receiverId,\n          receiverEmail: file.receiverEmail,\n          sharerId: 0,\n          sharerEmail: \"\",\n          offline: offline,\n          thumbnail: typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined\n        };\n        items.push(item);\n        window.customVariables.cachedFiles[file.uuid] = item;\n      }\n    } else {\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/dir/content\", {\n          apiKey: this.state.userAPIKey,\n          uuid: parent,\n          folders: JSON.stringify([\"default\"]),\n          page: 1,\n          app: \"true\"\n        });\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      if (!res.status) {\n        console.log(res.message);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      for (let i = 0; i < res.data.folders.length; i++) {\n        let folder = res.data.folders[i];\n        let folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid);\n        let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n        let item = {\n          type: \"folder\",\n          uuid: folder.uuid,\n          name: utils.sanitizeHTML(folderName),\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: folder.timestamp,\n          parent: folder.parent,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: 0,\n          sharerEmail: \"\",\n          color: folder.color || null\n        };\n        items.push(item);\n        window.customVariables.cachedFolders[folder.uuid] = item;\n      }\n\n      for (let i = 0; i < res.data.uploads.length; i++) {\n        let file = res.data.uploads[i];\n        let metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid);\n        let uploadDate = new Date(file.timestamp * 1000).toString().split(\" \");\n        let offline = false;\n\n        if (typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\") {\n          offline = true;\n        }\n\n        let item = {\n          type: \"file\",\n          uuid: file.uuid,\n          name: utils.sanitizeHTML(metadata.name),\n          mime: utils.sanitizeHTML(metadata.mime),\n          size: parseInt(metadata.size),\n          key: utils.sanitizeHTML(metadata.key),\n          bucket: file.bucket,\n          region: file.region,\n          parent: file.parent,\n          rm: file.rm,\n          chunks: file.chunks,\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: file.timestamp,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: 0,\n          sharerEmail: \"\",\n          offline: offline,\n          thumbnail: typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined\n        };\n        items.push(item);\n        window.customVariables.cachedFiles[file.uuid] = item;\n      }\n    }\n  }\n\n  items = utils.orderItemsByType(items, window.customVariables.orderBy);\n  window.customVariables.itemList = items;\n  let scrollTo = 0;\n\n  if (typeof window.customVariables.scrollToIndex[parent] !== \"undefined\") {\n    scrollTo = window.customVariables.scrollToIndex[parent];\n    delete window.customVariables.scrollToIndex[parent];\n  }\n\n  return this.setState({\n    itemList: items,\n    scrollToIndex: scrollTo\n  }, () => {\n    window.customFunctions.dismissLoader();\n    this.forceUpdate();\n    window.customVariables.currentThumbnailURL = window.location.href;\n\n    for (let i = 0; i < items.length; i++) {\n      this.getFileThumbnail(items[i], window.customVariables.currentThumbnailURL, i);\n    }\n\n    window.customFunctions.saveCachedItems();\n    window.customFunctions.saveThumbnailCache();\n  });\n}\nexport function getFileThumbnail(file, thumbURL, index) {\n  if (file.type !== \"file\" || file.name.indexOf(\".\") == -1 || typeof file.thumbnail !== \"undefined\") {\n    return false;\n  }\n\n  if (typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\") {\n    if (window.customVariables.getThumbnailErrors[file.uuid] >= 16) {\n      return false;\n    }\n  }\n\n  let intervalTimer = utils.getRandomArbitrary(10, 50);\n\n  if (document.getElementById(\"item-thumbnail-\" + file.uuid) !== null) {\n    intervalTimer = 1;\n  }\n\n  let onScreenInterval = setInterval(async () => {\n    if (thumbURL !== window.location.href) {\n      return clearInterval(onScreenInterval);\n    } else {\n      if (document.getElementById(\"item-thumbnail-\" + file.uuid) !== null) {\n        clearInterval(onScreenInterval);\n        let ext = file.name.split(\".\");\n        ext = ext[ext.length - 1];\n        let thumbnail = undefined;\n\n        if (utils.canShowThumbnail(ext)) {\n          try {\n            thumbnail = await this.getThumbnail(file, thumbURL, ext);\n          } catch (e) {\n            console.log(e);\n\n            if (e.indexOf(\"url changed\") == -1) {\n              if (typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\") {\n                window.customVariables.getThumbnailErrors[file.uuid] = window.customVariables.getThumbnailErrors[file.uuid] + 1;\n              } else {\n                window.customVariables.getThumbnailErrors[file.uuid] = 1;\n              }\n\n              window.customFunctions.saveGetThumbnailErrors();\n            }\n\n            return false;\n          }\n        } else {\n          return false;\n        }\n\n        if (typeof thumbnail !== \"undefined\") {\n          await window.customVariables.updateItemsSemaphore.acquire();\n          let newItems = this.state.itemList;\n\n          for (let i = 0; i < newItems.length; i++) {\n            if (newItems[i].uuid == file.uuid) {\n              newItems[i].thumbnail = thumbnail;\n            }\n          }\n\n          window.customVariables.itemList = newItems;\n\n          if (thumbURL == window.location.href) {\n            return this.setState({\n              itemList: newItems\n            }, () => {\n              this.forceUpdate();\n              window.customVariables.updateItemsSemaphore.release();\n            });\n          } else {\n            window.customVariables.updateItemsSemaphore.release();\n            return false;\n          }\n        } else {\n          return false;\n        }\n      }\n    }\n  }, intervalTimer);\n}\nexport async function refreshMainList(event) {\n  await this.updateItemList();\n  return event.detail.complete();\n}\nexport function selectItem(type, index) {\n  let items = this.state.itemList;\n  let selectedItems = this.state.selectedItems;\n\n  if (type) {\n    if (!items[index].selected) {\n      items[index].selected = type;\n      selectedItems = selectedItems + 1;\n    }\n\n    if (selectedItems == 1 && Capacitor.isNative) {\n      Plugins.Haptics.impact(HapticsImpactStyle.Light);\n    }\n  } else {\n    if (items[index].selected) {\n      items[index].selected = type;\n      selectedItems = selectedItems - 1;\n    }\n  }\n\n  return this.setState({\n    itemList: items,\n    selectedItems\n  });\n}\nexport function clearSelectedItems() {\n  let items = this.state.itemList;\n\n  for (let i = 0; i < items.length; i++) {\n    items[i].selected = false;\n  }\n\n  return this.setState({\n    itemList: items,\n    selectedItems: 0\n  });\n}\nexport async function selectItemsAction(event) {\n  event.persist();\n  let appLang = this.state.lang;\n  let customElementId = utils.generateRandomClassName();\n  let selectedItemsDoesNotContainFolder = utils.selectedItemsDoesNotContainFolder(this.state.itemList);\n  let inner = \"\";\n\n  if (window.location.href.indexOf(\"shared-in\") !== -1) {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.removeSelectedItemsFromSharedIn()\">` + language.get(appLang, \"removeFromShared\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  } else if (window.location.href.indexOf(\"shared-out\") !== -1) {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.stopSharingSelectedItems()\">` + language.get(appLang, \"stopSharing\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  } else if (window.location.href.indexOf(\"trash\") !== -1) {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.restoreSelectedItems()\">` + language.get(appLang, \"restoreItem\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  } else {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t` + (selectedItemsDoesNotContainFolder ? `<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.storeSelectedItemsOffline()\">` + language.get(appLang, \"storeSelectedItemsOffline\") + `</ion-item>` : ``) + `\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.moveSelectedItems()\">` + language.get(appLang, \"moveItem\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.trashSelectedItems()\">` + language.get(appLang, \"trashItem\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  }\n\n  window.customElements.define(customElementId, class ModalContent extends HTMLElement {\n    connectedCallback() {\n      this.innerHTML = inner;\n    }\n\n  });\n  let popover = await popoverController.create({\n    component: customElementId,\n    event: event\n  });\n  return popover.present();\n}\nexport async function previewItem(item, lastModalPreviewType = undefined) {\n  if (item.type !== \"file\") {\n    return false;\n  }\n\n  if (Capacitor.isNative && typeof lastModalPreviewType == \"undefined\") {\n    if (this.state.settings.onlyWifi) {\n      let networkStatus = await Plugins.Network.getStatus();\n\n      if (networkStatus.connectionType !== \"wifi\") {\n        return this.spawnToast(language.get(this.state.lang, \"onlyWifiError\"));\n      }\n    }\n  }\n\n  if (Capacitor.isNative) {\n    Capacitor.Plugins.Keyboard.hide();\n  }\n\n  if (typeof window.customVariables.offlineSavedFiles[item.uuid] !== \"undefined\" && typeof lastModalPreviewType == \"undefined\") {\n    this.getDownloadDir(true, item.uuid, (err, dirObj) => {\n      if (err) {\n        console.log(err);\n        return this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"));\n      }\n\n      FileOpener.open(dirObj.uri.uri + \"/\" + item.name, item.mime).then(() => {\n        console.log(dirObj.uri.uri + \"/\" + item.name, item.mime);\n      }).catch(err => {\n        console.log(err);\n        console.log(dirObj.uri.uri + \"/\" + item.name, item.mime);\n        return this.spawnToast(language.get(this.state.lang, \"noAppFoundToOpenFile\", true, [\"__NAME__\"], [item.name]));\n      });\n    });\n  } else {\n    let nameEx = item.name.split(\".\");\n    let previewType = utils.getFilePreviewType(nameEx[nameEx.length - 1]);\n\n    if (previewType == \"none\") {\n      if (typeof lastModalPreviewType !== \"undefined\") {\n        window.customFunctions.dismissModal();\n      }\n\n      return this.spawnItemActionSheet(item);\n    }\n\n    if (item.size > 1024 * 1024 * 64) {\n      if (typeof lastModalPreviewType !== \"undefined\") {\n        window.customFunctions.dismissModal();\n      }\n\n      return this.spawnItemActionSheet(item);\n    }\n\n    const gotPreviewData = async dataArray => {\n      let blob = new Blob([dataArray], {\n        type: item.mime,\n        name: item.name\n      });\n\n      if (typeof window.customVariables.currentPreviewURL !== \"undefined\") {\n        window.customVariables.urlCreator.revokeObjectURL(window.customVariables.currentPreviewURL);\n      }\n\n      window.customVariables.currentPreviewURL = window.customVariables.urlCreator.createObjectURL(blob);\n      let previewModalContent = ``;\n\n      if (previewType == \"image\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow preview-header-hidden\" style=\"position: absolute; display: none; margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\" onClick=\"window.customFunctions.togglePreviewHeader(true)\">\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\n\t\t\t\t\t\t\t<ion-slide>\n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t\t<img id=\"preview-img\" src=\"` + window.customVariables.currentPreviewURL + `\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh;\">\n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t</ion-slide>\n\t\t\t\t\t\t</ion-slides>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"video\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute; margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\n\t\t\t\t\t\t\t<ion-slide>\n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t\t<video id=\"preview-video\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh; margin-top: 56px;\" src=\"` + window.customVariables.currentPreviewURL + `\" autoplay preload controls></video>\n\t\t\t\t\t\t\t\t</center>\n\t\t\t\t\t\t\t</ion-slide>\n\t\t\t\t\t\t</ion-slides>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"audio\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute; margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\n\t\t\t\t\t\t<ion-toolbar style=\"--background: transparent; color: white;\">\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\n\t\t\t\t\t\t\t<ion-slide>\n\t\t\t\t\t\t\t\t<audio autoplay preload controls>\n\t\t\t\t\t\t\t\t\t<source src=\"` + window.customVariables.currentPreviewURL + `\" type=\"audio/mpeg\">\n\t\t\t\t\t\t\t\t</audio>\n\t\t\t\t\t\t\t</ion-slide>\n\t\t\t\t\t\t</ion-slides>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"code\" || previewType == \"text\") {\n        let text = new TextDecoder().decode(dataArray).split(\"<\").join(\"&lt;\");\n        previewModalContent = `\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\n\t\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content fullscreen style=\"-webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">\n\t\t\t\t\t\t<pre style=\"width: 100vw; height: 100%; margin-top: 0px; padding: 10px; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">` + text + `</pre>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"pdf\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\n\t\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content fullscreen>\n\t\t\t\t\t\t<div id=\"pdf-viewer\" style=\"width: 100%; height: 100%; overflow: scroll;\"></div>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      }\n\n      if (previewModalContent.length <= 8) {\n        if (typeof lastModalPreviewType !== \"undefined\") {\n          window.customFunctions.dismissModal();\n        }\n\n        return this.spawnItemActionSheet(item);\n      }\n\n      const setupBars = async () => {\n        if (previewType == \"image\" || previewType == \"video\" || previewType == \"audio\") {\n          this.setupStatusbar(\"image/video\");\n\n          try {\n            let modal = await modalController.getTop();\n            modal.onDidDismiss().then(() => {\n              this.setupStatusbar();\n            });\n          } catch (e) {\n            console.log(e);\n          }\n        }\n      };\n\n      const setupSlider = lastPreviewType => {\n        let slider = document.getElementById(\"slider\");\n\n        if (slider == null) {\n          return false;\n        }\n\n        let itemList = this.state.itemList;\n\n        const getPrevOrNextItem = type => {\n          let step = 1;\n          let max = 128;\n          let tries = 0;\n\n          const getItemRecursive = type => {\n            if (tries > max) {\n              return undefined;\n            }\n\n            tries += 1;\n\n            for (let i = 0; i < itemList.length; i++) {\n              if (itemList[i].uuid == item.uuid) {\n                let item = undefined;\n                let listIndex = undefined;\n\n                if (type == \"prev\") {\n                  listIndex = i - step;\n                  item = itemList[listIndex];\n                } else {\n                  listIndex = i + step;\n                  item = itemList[listIndex];\n                }\n\n                if (typeof item == \"undefined\") {\n                  step += 1;\n                  return getItemRecursive(type);\n                } else {\n                  let thisNameEx = item.name.split(\".\");\n                  let thisPreviewType = utils.getFilePreviewType(thisNameEx[thisNameEx.length - 1]);\n\n                  if (thisPreviewType == lastPreviewType) {\n                    return {\n                      item,\n                      listIndex\n                    };\n                  } else {\n                    step += 1;\n                    return getItemRecursive(type);\n                  }\n                }\n              }\n            }\n          };\n\n          return getItemRecursive(type);\n        };\n\n        slider.options = {\n          freeMode: false\n        };\n        let offset = 75;\n        let offsetY = 150;\n        let xDown, yDown;\n        slider.addEventListener(\"touchstart\", e => {\n          let firstTouch = getTouch(e);\n          xDown = firstTouch.clientX;\n          yDown = firstTouch.clientY;\n        });\n        slider.addEventListener(\"touchend\", e => {\n          if (!xDown || !yDown) {\n            return false;\n          }\n\n          let {\n            clientX: xUp,\n            clientY: yUp\n          } = getTouch(e);\n          let xDiff = xDown - xUp;\n          let yDiff = yDown - yUp;\n          let xDiffAbs = Math.abs(xDown - xUp);\n          let yDiffAbs = Math.abs(yDown - yUp);\n\n          if (Math.max(xDiffAbs, yDiffAbs) < offset) {\n            return false;\n          }\n\n          if (xDiffAbs > yDiffAbs) {\n            if (xDiff > 0) {\n              let nextItem = getPrevOrNextItem(\"next\");\n\n              if (typeof nextItem == \"undefined\") {\n                return false;\n              }\n\n              this.setState({\n                scrollToIndex: nextItem.listIndex\n              });\n              return this.previewItem(nextItem.item, lastPreviewType);\n            } else {\n              let prevItem = getPrevOrNextItem(\"prev\");\n\n              if (typeof prevItem == \"undefined\") {\n                return false;\n              }\n\n              this.setState({\n                scrollToIndex: prevItem.listIndex\n              });\n              return this.previewItem(prevItem.item, lastPreviewType);\n            }\n          } else {\n            if (xDiffAbs < yDiffAbs && Math.max(xDiffAbs, yDiffAbs) > offsetY) {\n              window.customFunctions.dismissModal();\n            }\n          }\n\n          return false;\n        });\n\n        const getTouch = e => {\n          return e.changedTouches[0];\n        };\n      };\n\n      const loadPdf = async () => {\n        let canvasContainer = document.getElementById(\"pdf-viewer\");\n\n        if (typeof window.pdfjsLib == \"undefined\") {\n          return window.customFunctions.dismissModal();\n        }\n\n        window.pdfjsLib.GlobalWorkerOptions.workerSrc = \"assets/pdf/build/pdf.worker.js\";\n        let loader = await loadingController.create({\n          message: \"\"\n        });\n        loader.present();\n\n        function renderPage(page) {\n          let viewport = page.getViewport({\n            scale: 2\n          });\n          let canvas = document.createElement('canvas');\n          let ctx = canvas.getContext('2d');\n          let renderContext = {\n            canvasContext: ctx,\n            viewport: viewport\n          };\n          canvas.height = viewport.height;\n          canvas.width = viewport.width;\n          canvasContainer.appendChild(canvas);\n          page.render(renderContext);\n        }\n\n        function renderPages(pdfDoc) {\n          if (typeof loader !== \"undefined\") {\n            loader.dismiss();\n          }\n\n          for (let i = 1; i <= pdfDoc.numPages; i++) {\n            pdfDoc.getPage(i).then(renderPage);\n          }\n        }\n\n        let loadingTask = window.pdfjsLib.getDocument({\n          data: dataArray\n        });\n        loadingTask.promise.then(renderPages).catch(err => {\n          console.log(err);\n          return window.customFunctions.dismissModal();\n        });\n      };\n\n      if (typeof lastModalPreviewType !== \"undefined\") {\n        try {\n          var currentModal = document.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0];\n        } catch (e) {\n          window.customFunctions.dismissModal();\n          return this.spawnItemActionSheet(item);\n        }\n\n        currentModal.innerHTML = previewModalContent;\n\n        if (previewType == \"pdf\") {\n          loadPdf();\n        }\n\n        setupBars();\n        setupSlider(previewType);\n        return true;\n      } else {\n        let modalId = \"preview-modal-\" + utils.generateRandomClassName();\n        customElements.define(modalId, class ModalContent extends HTMLElement {\n          connectedCallback() {\n            this.innerHTML = previewModalContent;\n          }\n\n        });\n        var modal = await modalController.create({\n          component: modalId,\n          swipeToClose: true,\n          showBackdrop: false,\n          backdropDismiss: false,\n          cssClass: \"modal-fullscreen\"\n        });\n        await modal.present();\n\n        if (Capacitor.isNative) {\n          Capacitor.Plugins.Keyboard.hide();\n        }\n\n        if (previewType == \"image\" || previewType == \"video\" || previewType == \"audio\") {\n          try {\n            document.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0].style.backgroundColor = \"black\";\n          } catch (e) {\n            console.log(e);\n          }\n        }\n\n        if (previewType == \"pdf\") {\n          loadPdf();\n        }\n\n        setupBars();\n        setupSlider(previewType);\n        return true;\n      }\n    };\n\n    let loading = await loadingController.create({\n      message: \"\",\n      //language.get(this.state.lang, \"loadingPreview\")\n      backdropDismiss: true\n    });\n    loading.present();\n\n    try {\n      loading.onDidDismiss().then(() => {\n        window.customVariables.stopGettingPreviewData = true;\n      });\n    } catch (e) {\n      console.log(e);\n    }\n\n    window.customVariables.isGettingPreviewData = true;\n    window.customVariables.stopGettingPreviewData = false;\n    this.downloadPreview(item, chunksDone => {//console.log(chunksDone)\n    }, (err, dataArray) => {\n      window.customVariables.isGettingPreviewData = false;\n      loading.dismiss();\n\n      if (err) {\n        if (err !== \"stopped\") {\n          console.log(err);\n          return this.spawnToast(language.get(this.state.lang, \"fileNoPreviewAvailable\", true, [\"__NAME__\"], [item.name]));\n        } else {\n          return false;\n        }\n      }\n\n      return gotPreviewData(dataArray);\n    });\n  }\n}\nexport async function dirExists(name, parent, callback) {\n  if (parent == null) {\n    parent = \"base\";\n  }\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/dir/exists\", {\n      apiKey: this.state.userAPIKey,\n      parent,\n      nameHashed: utils.hashFn(name.toLowerCase())\n    });\n  } catch (e) {\n    return callback(e);\n  }\n\n  if (!res.status) {\n    return callback(res.message);\n  }\n\n  return callback(null, res.data.exists, res.data.uuid);\n}\nexport async function moveFolder(folder, destination, showLoader) {\n  if (folder.parent == destination) {\n    return this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"));\n  }\n\n  if (utils.currentParentFolder() == \"base\") {\n    if (folder.uuid == \"default\" || folder.name.toLowerCase() == \"filen sync\") {\n      return this.spawnToast(language.get(this.state.lang, \"thisFolderCannotBeMoved\"));\n    }\n  }\n\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  this.dirExists(folder.name, destination, async (err, exists, existsUUID) => {\n    if (err) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (exists) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"folderMoveAlreadyExistsHere\", true, [\"__NAME__\"], [folder.name]));\n    }\n\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/dir/move\", {\n        apiKey: this.state.userAPIKey,\n        uuid: folder.uuid,\n        folderUUID: destination\n      });\n    } catch (e) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    if (!res.status) {\n      return this.spawnToast(res.message);\n    }\n\n    utils.checkIfItemParentIsBeingShared(destination, \"folder\", {\n      name: folder.name\n    }, () => {\n      this.spawnToast(language.get(this.state.lang, \"folderMoved\", true, [\"__NAME__\"], [folder.name]));\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        if (utils.currentParentFolder() == destination) {\n          this.updateItemList();\n        }\n      }, 500);\n      return true;\n    });\n  });\n}\nexport async function moveFile(file, destination, showLoader) {\n  if (file.parent == destination) {\n    return this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"));\n  }\n\n  if (destination == \"trash\" || destination == \"base\" || destination == \"shared-in\" || destination == \"shared-out\") {\n    return this.spawnToast(language.get(this.state.lang, \"cannotMoveFileHere\"));\n  }\n\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  this.fileExists(file.name, destination, async (err, exists, existsUUID) => {\n    if (err) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (exists) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"fileMoveAlreadyExistsHere\", true, [\"__NAME__\"], [file.name]));\n    }\n\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/file/move\", {\n        apiKey: this.state.userAPIKey,\n        fileUUID: file.uuid,\n        folderUUID: destination\n      });\n    } catch (e) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    if (!res.status) {\n      return this.spawnToast(res.message);\n    }\n\n    utils.checkIfItemParentIsBeingShared(destination, \"file\", {\n      uuid: file.uuid,\n      name: file.name,\n      size: parseInt(file.size),\n      mime: file.mime,\n      key: file.key\n    }, () => {\n      this.spawnToast(language.get(this.state.lang, \"fileMoved\", true, [\"__NAME__\"], [file.name]));\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        if (utils.currentParentFolder() == destination) {\n          this.updateItemList();\n        }\n      }, 500);\n      return true;\n    });\n  });\n}\nexport function moveItem(item) {\n  this.spawnMoveToast((cancelled, destination) => {\n    if (cancelled) {\n      return false;\n    }\n\n    if (item.type == \"file\") {\n      return this.moveFile(item, destination, true);\n    } else {\n      return this.moveFolder(item, destination, true);\n    }\n  });\n}\nexport async function renameItem(item) {\n  let parent = utils.currentParentFolder();\n\n  if (parent == \"base\") {\n    if (item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\") {\n      return this.spawnToast(language.get(this.state.lang, \"cannotRenameItem\", true, [\"__NAME__\"], [item.name]));\n    }\n  }\n\n  this.spawnRenamePrompt(item, async (cancelled, newName) => {\n    if (cancelled) {\n      return false;\n    }\n\n    if (item.name == newName) {\n      return false;\n    }\n\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n\n    if (item.type == \"file\") {\n      newName = utils.removeIllegalCharsFromString(newName);\n\n      if (utils.nameRegex(newName) || utils.checkIfNameIsBanned(newName) || utils.fileNameValidationRegex(newName)) {\n        loading.dismiss();\n        return this.spawnToast(language.get(this.state.lang, \"invalidFileName\"));\n      }\n\n      let nameEx = item.name.split(\".\");\n      let fileExt = nameEx[nameEx.length - 1];\n      let renameWithDot = false;\n\n      if (item.name.indexOf(\".\") !== -1) {\n        renameWithDot = true;\n      }\n\n      this.fileExists(newName, parent, async (err, exists, existsUUID) => {\n        if (err) {\n          console.log(err);\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (exists) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"fileRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]));\n        }\n\n        if (renameWithDot) {\n          newName = newName + \".\" + fileExt;\n        }\n\n        try {\n          var res = await utils.apiRequest(\"POST\", \"/v1/file/rename\", {\n            apiKey: this.state.userAPIKey,\n            uuid: item.uuid,\n            name: utils.cryptoJSEncrypt(newName, item.key),\n            nameHashed: utils.hashFn(newName.toLowerCase()),\n            metaData: utils.cryptoJSEncrypt(JSON.stringify({\n              name: newName,\n              size: parseInt(item.size),\n              mime: item.mime,\n              key: item.key\n            }), this.state.userMasterKeys[this.state.userMasterKeys.length - 1])\n          });\n        } catch (e) {\n          console.log(e);\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (!res.status) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"couldNotRenameFile\"));\n        }\n\n        utils.checkIfItemIsBeingSharedForRename(\"file\", item.uuid, {\n          name: newName,\n          size: parseInt(item.size),\n          mime: item.mime,\n          key: item.key\n        }, () => {\n          loading.dismiss();\n          this.spawnToast(language.get(this.state.lang, \"fileRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]));\n          delete window.customVariables.cachedFiles[item.uuid];\n          clearTimeout(window.customVariables.reloadAfterActionTimeout);\n          window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n            if (utils.currentParentFolder() == parent) {\n              this.updateItemList();\n            }\n          }, 500);\n\n          if (typeof window.customVariables.offlineSavedFiles !== \"undefined\" && Capacitor.isNative) {\n            this.getDownloadDir(true, item.uuid, async (err, dirObj) => {\n              if (err) {\n                console.log(err);\n                return this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"));\n              }\n\n              try {\n                await Plugins.Filesystem.rename({\n                  from: dirObj + \"/\" + item.name,\n                  to: dirObj + \"/\" + newName,\n                  directory: dirObj.directory\n                });\n              } catch (e) {\n                console.log(err);\n                return this.spawnToast(language.get(this.state.lang, \"couldNotRenameFileLocally\"));\n              }\n\n              return console.log(\"File renamed locally\");\n            });\n          }\n\n          return true;\n        });\n      });\n    } else {\n      newName = utils.removeIllegalCharsFromString(newName);\n\n      if (utils.checkIfNameIsBanned(newName) || utils.folderNameRegex(newName) || utils.fileNameValidationRegex(newName)) {\n        loading.dismiss();\n        return this.spawnToast(language.get(this.state.lang, \"invalidFolderName\"));\n      }\n\n      this.dirExists(newName, parent, async (err, exists, existsUUID) => {\n        if (err) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (exists) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"folderRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]));\n        }\n\n        try {\n          var res = await utils.apiRequest(\"POST\", \"/v1/dir/rename\", {\n            apiKey: this.state.userAPIKey,\n            uuid: item.uuid,\n            name: utils.cryptoJSEncrypt(JSON.stringify({\n              name: newName\n            }), this.state.userMasterKeys[this.state.userMasterKeys.length - 1]),\n            nameHashed: utils.hashFn(newName.toLowerCase())\n          });\n        } catch (e) {\n          console.log(e);\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (!res.status) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"couldNotRenameFolder\"));\n        }\n\n        utils.checkIfItemIsBeingSharedForRename(\"folder\", item.uuid, {\n          name: newName\n        }, () => {\n          loading.dismiss();\n          this.spawnToast(language.get(this.state.lang, \"folderRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]));\n          delete window.customVariables.cachedFolders[item.uuid];\n          clearTimeout(window.customVariables.reloadAfterActionTimeout);\n          window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n            if (utils.currentParentFolder() == parent) {\n              this.updateItemList();\n            }\n          }, 500);\n          return true;\n        });\n      });\n    }\n  });\n}\nexport async function moveSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  this.spawnMoveToast((cancelled, destination) => {\n    if (cancelled) {\n      return false;\n    }\n\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].type == \"file\") {\n        this.moveFile(items[i], destination, true);\n      } else {\n        this.moveFolder(items[i], destination, true);\n      }\n    }\n  });\n}\nexport async function trashSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  let alert = await alertController.create({\n    header: language.get(this.state.lang, \"trashItemHeader\"),\n    message: language.get(this.state.lang, \"trashItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: () => {\n        items.forEach(item => {\n          this.trashItem(item, false);\n        });\n      }\n    }]\n  });\n  return alert.present();\n}\nexport async function restoreSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  let alert = await alertController.create({\n    header: language.get(this.state.lang, \"restoreItemsHeader\"),\n    message: language.get(this.state.lang, \"restoreItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: () => {\n        items.forEach(item => {\n          this.restoreItem(item, false);\n        });\n      }\n    }]\n  });\n  return alert.present();\n}\nexport function getSelectedItems() {\n  return new Promise((resolve, reject) => {\n    let items = this.state.itemList.filter(item => {\n      return item.selected === true;\n    });\n    return resolve(items);\n  });\n}\nexport async function restoreItem(item, showLoader) {\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  if (item.type == \"file\") {\n    this.fileExists(item.name, item.parent, async (err, exists, existsUUID) => {\n      if (err) {\n        console.log(err);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (exists) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"fileExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/file/restore\", {\n          apiKey: this.state.userAPIKey,\n          uuid: item.uuid\n        });\n      } catch (e) {\n        console.log(e);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (!res.status) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        this.updateItemList();\n      }, 500);\n      return this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]));\n    });\n  } else {\n    this.dirExists(item.name, item.parent, async (err, exists, existsUUID) => {\n      if (err) {\n        console.log(err);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (exists) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"folderExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/dir/restore\", {\n          apiKey: this.state.userAPIKey,\n          uuid: item.uuid\n        });\n      } catch (e) {\n        console.log(e);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (!res.status) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        this.updateItemList();\n      }, 500);\n      return this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]));\n    });\n  }\n}\nexport async function trashItem(item, showLoader) {\n  if (utils.currentParentFolder() == \"base\") {\n    if (item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\") {\n      return this.spawnToast(language.get(this.state.lang, \"cannotTrashItem\", true, [\"__NAME__\"], [item.name]));\n    }\n  }\n\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  try {\n    if (item.type == \"file\") {\n      var res = await utils.apiRequest(\"POST\", \"/v1/file/trash\", {\n        apiKey: this.state.userAPIKey,\n        uuid: item.uuid\n      });\n    } else {\n      var res = await utils.apiRequest(\"POST\", \"/v1/dir/trash\", {\n        apiKey: this.state.userAPIKey,\n        uuid: item.uuid\n      });\n    }\n  } catch (e) {\n    console.log(e);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n  }\n\n  if (!res.status) {\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"couldNotTrashItem\", true, [\"__NAME__\"], [item.name]));\n  }\n\n  if (showLoader) {\n    loading.dismiss();\n  }\n\n  clearTimeout(window.customVariables.reloadAfterActionTimeout);\n  window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n    this.updateItemList();\n  }, 500);\n  return this.spawnToast(language.get(this.state.lang, \"itemTrashed\", true, [\"__NAME__\"], [item.name]));\n}\nexport async function shareItemWithEmail(email, uuid, type, callback) {\n  if (email == this.state.userEmail) {\n    return callback(language.get(this.state.lang, \"cannotShareWithSelf\"));\n  }\n\n  let loading = await loadingController.create({\n    message: \"\"\n  });\n  loading.present();\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/user/publicKey/get\", {\n      email\n    });\n  } catch (e) {\n    loading.dismiss();\n    return callback(e);\n  }\n\n  if (!res.status) {\n    loading.dismiss();\n    return callback(res.message);\n  }\n\n  let userPubKey = res.data.publicKey;\n\n  if (userPubKey == null) {\n    loading.dismiss();\n    return callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]));\n  }\n\n  if (userPubKey.length <= 1) {\n    loading.dismiss();\n    return callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]));\n  }\n\n  try {\n    var usrPubKey = await window.crypto.subtle.importKey(\"spki\", utils._base64ToArrayBuffer(userPubKey), {\n      name: \"RSA-OAEP\",\n      hash: \"SHA-512\"\n    }, true, [\"encrypt\"]);\n  } catch (e) {\n    loading.dismiss();\n    return callback(e);\n  }\n\n  if (type == \"file\") {\n    if (typeof window.customVariables.cachedFiles[uuid] == \"undefined\") {\n      loading.dismiss();\n      return callback(language.get(this.state.lang, \"shareItemFileNotFound\", true, [\"__NAME__\"], [uuid]));\n    }\n\n    let fileName = window.customVariables.cachedFiles[uuid].name;\n    let fileSize = window.customVariables.cachedFiles[uuid].size;\n    let fileMime = window.customVariables.cachedFiles[uuid].mime;\n    let fileKey = window.customVariables.cachedFiles[uuid].key;\n\n    try {\n      var encrypted = await window.crypto.subtle.encrypt({\n        name: \"RSA-OAEP\"\n      }, usrPubKey, new TextEncoder().encode(JSON.stringify({\n        name: fileName,\n        size: fileSize,\n        mime: fileMime,\n        key: fileKey\n      })));\n    } catch (e) {\n      loading.dismiss();\n      return console.log(e);\n    }\n\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/share\", {\n        apiKey: this.state.userAPIKey,\n        uuid,\n        parent: \"none\",\n        email,\n        type: \"file\",\n        metadata: utils.base64ArrayBuffer(encrypted)\n      });\n    } catch (e) {\n      loading.dismiss();\n      return callback(e);\n    }\n\n    if (!res.status) {\n      loading.dismiss();\n      return callback(res.message);\n    }\n\n    loading.dismiss();\n    return callback(null);\n  } else {\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/download/dir\", {\n        apiKey: this.state.userAPIKey,\n        uuid\n      });\n    } catch (e) {\n      loading.dismiss();\n      return callback(e);\n    }\n\n    if (!res.status) {\n      loading.dismiss();\n      return callback(res.message);\n    }\n\n    let shareItems = [];\n    let files = res.data.files;\n    let folders = res.data.folders;\n\n    if (files.length + folders.length > 1000000) {\n      loading.dismiss();\n      return callback(language.get(this.state.lang, \"shareTooBigForApp\"));\n    }\n\n    for (let i = 0; i < files.length; i++) {\n      let metadata = utils.decryptFileMetadata(files[i].metadata, this.state.userMasterKeys, files[i].uuid);\n\n      if (metadata.key.length > 0) {\n        shareItems.push({\n          uuid: files[i].uuid,\n          parent: files[i].parent,\n          metadata: {\n            name: metadata.name,\n            size: parseInt(metadata.size),\n            mime: metadata.mime,\n            key: metadata.key\n          },\n          type: \"file\"\n        });\n      }\n    }\n\n    for (let i = 0; i < folders.length; i++) {\n      let dirName = utils.decryptCryptoJSFolderName(folders[i].name, this.state.userMasterKeys, folders[i].uuid);\n\n      if (dirName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\") {\n        shareItems.push({\n          uuid: folders[i].uuid,\n          parent: i == 0 ? \"none\" : folders[i].parent,\n          metadata: dirName,\n          type: \"folder\"\n        });\n      }\n    }\n\n    let itemsShared = 0;\n    let erroredItems = 0;\n    let isAlreadyShared = false;\n\n    const shareItemRequest = async (data, tries, maxTries, cb) => {\n      if (tries >= maxTries) {\n        return cb(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/share\", data);\n      } catch (e) {\n        console.log(e);\n        return setTimeout(() => {\n          shareItemRequest(data, tries + 1, maxTries, cb);\n        }, 1000);\n      }\n\n      return cb(null);\n    };\n\n    for (let i = 0; i < shareItems.length; i++) {\n      await window.customVariables.shareItemSemaphore.acquire();\n      let item = shareItems[i];\n      let itemMetadata = \"\";\n\n      if (item.type == \"file\") {\n        itemMetadata = JSON.stringify(item.metadata);\n      } else {\n        itemMetadata = JSON.stringify({\n          name: item.metadata\n        });\n      }\n\n      try {\n        var encrypted = await window.crypto.subtle.encrypt({\n          name: \"RSA-OAEP\"\n        }, usrPubKey, new TextEncoder().encode(itemMetadata));\n      } catch (e) {\n        loading.dismiss();\n        window.customVariables.shareItemSemaphore.release();\n        return callback(e);\n      }\n\n      shareItemRequest({\n        apiKey: this.state.userAPIKey,\n        uuid: item.uuid,\n        parent: item.parent,\n        email: email,\n        type: item.type,\n        metadata: utils.base64ArrayBuffer(encrypted)\n      }, 0, 32, err => {\n        if (err) {\n          console.log(err);\n          erroredItems += 1;\n        }\n\n        window.customVariables.shareItemSemaphore.release();\n        itemsShared += 1;\n        loading.message = language.get(this.state.lang, \"sharedItemsCount\", true, [\"__SHARED__\", \"__TOTAL__\"], [itemsShared, shareItems.length]);\n\n        if (itemsShared == shareItems.length) {\n          loading.dismiss();\n          return callback(null);\n        }\n      });\n    }\n  }\n}\nexport async function shareSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  let alert = await alertController.create({\n    header: language.get(this.state.lang, \"shareItems\"),\n    inputs: [{\n      type: \"text\",\n      id: \"share-items-email-input\",\n      name: \"share-items-email-input\",\n      placeholder: language.get(this.state.lang, \"receiverEmail\")\n    }],\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: async inputs => {\n        let email = inputs['share-items-email-input'];\n        let itemsShared = 0;\n\n        for (let i = 0; i < items.length; i++) {\n          let item = items[i];\n\n          if (item.type == \"folder\" && item.uuid == \"default\") {\n            this.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"));\n          } else {\n            this.shareItemWithEmail(email, item.uuid, item.type, err => {\n              if (err) {\n                console.log(err);\n                this.spawnToast(err.toString());\n              }\n\n              itemsShared += 1;\n\n              if (itemsShared >= items.length) {\n                return this.spawnToast(language.get(this.state.lang, \"itemsShared\", true, [\"__COUNT__\", \"__EMAIL__\"], [items.length, email]));\n              }\n            });\n          }\n        }\n      }\n    }]\n  });\n  await alert.present();\n  setTimeout(() => {\n    try {\n      document.querySelector(\"ion-alert input\").focus();\n    } catch (e) {}\n  }, 500);\n  return true;\n}\nexport async function shareItem(item) {\n  if (item.type == \"folder\" && item.uuid == \"default\") {\n    return this.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"));\n  }\n\n  let alert = await alertController.create({\n    header: item.type == \"file\" ? language.get(this.state.lang, \"shareFile\") : language.get(this.state.lang, \"shareFolder\"),\n    inputs: [{\n      type: \"text\",\n      id: \"share-item-email-input\",\n      name: \"share-item-email-input\",\n      placeholder: language.get(this.state.lang, \"receiverEmail\")\n    }],\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: inputs => {\n        let email = inputs['share-item-email-input'];\n        this.shareItemWithEmail(email, item.uuid, item.type, err => {\n          if (err) {\n            console.log(err);\n            return this.spawnToast(err.toString());\n          }\n\n          return this.spawnToast(language.get(this.state.lang, \"itemShared\", true, [\"__NAME__\", \"__WITH__\"], [item.name, email]));\n        });\n      }\n    }]\n  });\n  await alert.present();\n  setTimeout(() => {\n    try {\n      document.querySelector(\"ion-alert input\").focus();\n    } catch (e) {}\n  }, 500);\n  return true;\n}\nexport async function openPublicLinkModal(item) {\n  if (item.uuid == \"default\") {\n    return this.spawnToast(language.get(this.state.lang, \"cannotCreatePublicLinkFolder\"));\n  }\n\n  let loading = await loadingController.create({\n    message: \"\"\n  });\n  loading.present();\n\n  if (item.type == \"file\") {\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/link/status\", {\n        apiKey: this.state.userAPIKey,\n        fileUUID: item.uuid\n      });\n    } catch (e) {\n      console.log(e);\n      loading.dismiss();\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (!res.status) {\n      console.log(res.message);\n      loading.dismiss();\n      return this.spawnToast(res.message);\n    }\n\n    loading.dismiss();\n    let appLang = this.state.lang;\n    let appDarkMode = this.state.darkMode;\n    let modalId = \"public-link-modal-\" + utils.generateRandomClassName();\n    customElements.define(modalId, class ModalContent extends HTMLElement {\n      connectedCallback() {\n        this.innerHTML = `\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\n\t\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\n\t\t\t\t\t\t<div id=\"enable-public-link-content\" ` + (res.data.enabled && `style=\"display: none;\"`) + `>\n\t\t\t\t\t\t\t<div style=\"position: absolute; left: 50%; top: 32%; transform: translate(-50%, -50%); width: 100%;\"> \n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t\t<ion-icon icon=\"` + Ionicons.link + `\" style=\"font-size: 65pt; color: ` + (appDarkMode ? \"white\" : \"gray\") + `;\"></ion-icon>\n\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t<ion-button color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', false)\">` + language.get(appLang, \"enablePublicLink\") + `</ion-button>\t\n\t\t\t\t\t\t\t\t</center>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id=\"public-link-enabled-content\" ` + (!res.data.enabled && `style=\"display: none;\"`) + `>\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnabled\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enabled-toggle\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'disable', false)\" checked></ion-toggle>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-input type=\"text\" id=\"public-link-input\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\" value=\"https://filen.io/d/` + res.data.uuid + `#!` + item.key + `\" disabled></ion-input>\n\t\t\t\t\t\t\t\t<ion-buttons slot=\"end\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\">\n\t\t\t\t\t\t\t\t\t<ion-button fill=\"solid\" color=\"` + (appDarkMode ? `dark` : `light`) + `\">\n\t\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"copy\") + `\n\t\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<ion-item lines=\"none\" style=\"margin-top: 30px;\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkExpire\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-select id=\"public-link-expires-select\" value=\"` + (typeof res.data.expirationText == \"string\" ? res.data.expirationText : `never`) + `\" ok-text=\"` + language.get(appLang, \"alertOkButton\") + `\" cancel-text=\"` + language.get(appLang, \"close\") + `\">\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"never\">` + language.get(appLang, \"publicLinkExpiresNever\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1h\">1 ` + language.get(appLang, \"publicLinkExpiresHour\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"6h\">6 ` + language.get(appLang, \"publicLinkExpiresHours\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1d\">1 ` + language.get(appLang, \"publicLinkExpiresDay\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"3d\">3 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"7d\">7 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"14d\">14 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"30d\">30 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t</ion-select>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkPassword\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-input slot=\"end\" id=\"public-link-password-input\" type=\"password\" placeholder=\"` + language.get(appLang, \"publicLinkPasswordPlaceholder\") + `\" ` + (res.data.password !== null ? `value=\"` + res.data.password + `\"` : ``) + `></ion-input>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnableDownloadBtn\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enable-download-btn-toggle\" ` + (res.data.downloadBtn == 1 ? `checked` : ``) + `></ion-toggle>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<section style=\"padding-left: 15px; padding-right: 15px; margin-top: 30px;\">\n\t\t\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', true, '` + (typeof res.data.uuid !== \"undefined\" ? res.data.uuid : ``) + `')\">` + language.get(appLang, \"savePublicLink\") + `</ion-button>\n\t\t\t\t\t\t\t</section>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      }\n\n    });\n    let modal = await modalController.create({\n      component: modalId,\n      swipeToClose: false,\n      showBackdrop: false,\n      backdropDismiss: false,\n      cssClass: \"modal-fullscreen\"\n    });\n    return modal.present();\n  } else {\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/dir/link/status\", {\n        apiKey: this.state.userAPIKey,\n        uuid: item.uuid\n      });\n    } catch (e) {\n      console.log(e);\n      loading.dismiss();\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (!res.status) {\n      console.log(res.message);\n      loading.dismiss();\n      return this.spawnToast(res.message);\n    }\n\n    loading.dismiss();\n    let appLang = this.state.lang;\n    let appDarkMode = this.state.darkMode;\n    let appUserMasterKeys = this.state.userMasterKeys;\n    let modalId = \"public-link-modal-\" + utils.generateRandomClassName();\n    customElements.define(modalId, class ModalContent extends HTMLElement {\n      connectedCallback() {\n        this.innerHTML = `\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\n\t\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\n\t\t\t\t\t\t<div id=\"enable-public-link-content\" ` + (res.data.exists && `style=\"display: none;\"`) + `>\n\t\t\t\t\t\t\t<div style=\"position: absolute; left: 50%; top: 32%; transform: translate(-50%, -50%); width: 100%;\"> \n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t\t<ion-icon icon=\"` + Ionicons.link + `\" style=\"font-size: 65pt; color: ` + (appDarkMode ? \"white\" : \"gray\") + `;\"></ion-icon>\n\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t<ion-button color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', false)\">` + language.get(appLang, \"enablePublicLink\") + `</ion-button>\t\n\t\t\t\t\t\t\t\t</center>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id=\"public-link-enabled-content\" ` + (!res.data.exists && `style=\"display: none;\"`) + `>\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnabled\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enabled-toggle\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'disable', true, '` + (typeof res.data.uuid !== \"undefined\" ? res.data.uuid : ``) + `')\" checked></ion-toggle>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-input type=\"text\" id=\"public-link-input\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\" value=\"https://filen.io/f/` + res.data.uuid + `#!` + utils.decryptFolderLinkKey(res.data.key, appUserMasterKeys) + `\" disabled></ion-input>\n\t\t\t\t\t\t\t\t<ion-buttons slot=\"end\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\">\n\t\t\t\t\t\t\t\t\t<ion-button fill=\"solid\" color=\"` + (appDarkMode ? `dark` : `light`) + `\">\n\t\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"copy\") + `\n\t\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<ion-item lines=\"none\" style=\"margin-top: 30px;\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkExpire\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-select id=\"public-link-expires-select\" value=\"` + (typeof res.data.expirationText == \"string\" ? res.data.expirationText : `never`) + `\" ok-text=\"` + language.get(appLang, \"alertOkButton\") + `\" cancel-text=\"` + language.get(appLang, \"close\") + `\">\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"never\">` + language.get(appLang, \"publicLinkExpiresNever\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1h\">1 ` + language.get(appLang, \"publicLinkExpiresHour\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"6h\">6 ` + language.get(appLang, \"publicLinkExpiresHours\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1d\">1 ` + language.get(appLang, \"publicLinkExpiresDay\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"3d\">3 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"7d\">7 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"14d\">14 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"30d\">30 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\n\t\t\t\t\t\t\t\t</ion-select>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkPassword\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-input slot=\"end\" id=\"public-link-password-input\" type=\"password\" placeholder=\"` + language.get(appLang, \"publicLinkPasswordPlaceholder\") + `\" ` + (typeof res.data.password !== \"undefined\" ? res.data.password !== null ? `value=\"` + res.data.password + `\"` : `` : ``) + `></ion-input>\n\t\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t\t<!--<ion-item lines=\"none\">\n\t\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnableDownloadBtn\") + `\n\t\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enable-download-btn-toggle\" ` + (typeof res.data.downloadBtn !== \"undefined\" ? res.data.downloadBtn == 1 ? `checked` : `` : ``) + `></ion-toggle>\n\t\t\t\t\t\t\t</ion-item>-->\n\t\t\t\t\t\t\t<section style=\"padding-left: 15px; padding-right: 15px; margin-top: 30px;\">\n\t\t\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', true, '` + (typeof res.data.uuid !== \"undefined\" ? res.data.uuid : ``) + `')\">` + language.get(appLang, \"savePublicLink\") + `</ion-button>\n\t\t\t\t\t\t\t</section>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      }\n\n    });\n    let modal = await modalController.create({\n      component: modalId,\n      swipeToClose: false,\n      showBackdrop: false,\n      backdropDismiss: false,\n      cssClass: \"modal-fullscreen\"\n    });\n    return modal.present();\n  }\n}\nexport function makeItemAvailableOffline(offline, item) {\n  if (!offline) {\n    this.getDownloadDir(true, item.uuid, async (err, dirObj) => {\n      if (err) {\n        console.log(err);\n        return this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"));\n      }\n\n      try {\n        await Plugins.Filesystem.rmdir({\n          path: dirObj.path,\n          directory: dirObj.directory,\n          recursive: true\n        });\n        delete window.customVariables.offlineSavedFiles[item.uuid];\n      } catch (e) {\n        console.log(e);\n        return this.spawnToast(language.get(this.state.lang, \"couldNotDeleteDownloadedFile\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      let items = this.state.itemList;\n      let windowItems = window.customVariables.itemList;\n\n      for (let i = 0; i < items.length; i++) {\n        if (items[i].uuid == item.uuid) {\n          items[i].offline = false;\n        }\n      }\n\n      for (let i = 0; i < windowItems.length; i++) {\n        if (windowItems[i].uuid == item.uuid) {\n          windowItems[i].offline = false;\n        }\n      }\n\n      this.setState({\n        itemList: items\n      });\n      window.customVariables.itemList = windowItems;\n\n      if (typeof window.customVariables.cachedFiles[item.uuid] !== \"undefined\") {\n        window.customVariables.cachedFiles[item.uuid].offline = false;\n      }\n\n      this.spawnToast(language.get(this.state.lang, \"fileDeletedFromOfflineStorage\", true, [\"__NAME__\"], [item.name]));\n      window.customFunctions.saveOfflineSavedFiles();\n      return this.forceUpdate();\n    });\n  } else {\n    let nItem = item;\n    nItem.makeOffline = true;\n    return this.queueFileDownload(nItem);\n  }\n}\nexport async function removeSharedInItem(item, showLoader) {\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/in/remove\", {\n      apiKey: this.state.userAPIKey,\n      uuid: item.uuid,\n      receiverId: 0\n    });\n  } catch (e) {\n    console.log(e);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n  }\n\n  if (!res.status) {\n    console.log(res.message);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(res.message);\n  }\n\n  if (showLoader) {\n    loading.dismiss();\n  }\n\n  clearTimeout(window.customVariables.reloadAfterActionTimeout);\n  window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n    this.updateItemList();\n  }, 500);\n  return this.spawnToast(language.get(this.state.lang, \"itemRemovedFromSharedIn\", true, [\"__NAME__\"], [item.name]));\n}\nexport async function stopSharingItem(item, showLoader) {\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/out/remove\", {\n      apiKey: this.state.userAPIKey,\n      uuid: item.uuid,\n      receiverId: item.receiverId\n    });\n  } catch (e) {\n    console.log(e);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n  }\n\n  if (!res.status) {\n    console.log(res.message);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(res.message);\n  }\n\n  if (showLoader) {\n    loading.dismiss();\n  }\n\n  clearTimeout(window.customVariables.reloadAfterActionTimeout);\n  window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n    this.updateItemList();\n  }, 500);\n  return this.spawnToast(language.get(this.state.lang, \"itemStoppedSharing\", true, [\"__NAME__\"], [item.name]));\n}\nexport async function removeSelectedItemsFromSharedIn() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n    this.removeSharedInItem(item, false);\n  }\n\n  return true;\n}\nexport async function stopSharingSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n    this.stopSharingItem(item, false);\n  }\n\n  return true;\n}\nexport async function downloadSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n\n    if (item.type == \"file\") {\n      this.queueFileDownload(item);\n    }\n  }\n\n  return true;\n}\nexport async function storeSelectedItemsOffline() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n\n    if (item.type == \"file\") {\n      item.makeOffline = true;\n      this.queueFileDownload(item);\n    }\n  }\n\n  return true;\n}\nexport async function colorItem(item) {\n  if (item.uuid == \"default\") {\n    return this.spawnToast(language.get(this.state.lang, \"thisFolderCannotBeColored\"));\n  }\n\n  let appLang = this.state.lang;\n  let appDarkMode = this.state.darkMode;\n  let modalId = \"color-item-modal-\" + utils.generateRandomClassName();\n  customElements.define(modalId, class ModalContent extends HTMLElement {\n    connectedCallback() {\n      this.innerHTML = `\n\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\n\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t` + language.get(appLang, \"colorItemLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\n\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t</ion-toolbar>\n\t\t\t\t</ion-header>\n\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\n\t\t\t\t\t<section style=\"padding: 15px;\">\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'default')\" style=\"--background: #F6C358;\">` + language.get(appLang, \"colorItemDefault\") + `</ion-button>\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'blue')\" style=\"--background: #2992E5; margin-top: 10px;\">` + language.get(appLang, \"colorItemBlue\") + `</ion-button>\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'green')\" style=\"--background: #57A15B; margin-top: 10px;\">` + language.get(appLang, \"colorItemGreen\") + `</ion-button>\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'purple')\" style=\"--background: #8E3A9D; margin-top: 10px;\">` + language.get(appLang, \"colorItemPurple\") + `</ion-button>\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'red')\" style=\"--background: #CB2E35; margin-top: 10px;\">` + language.get(appLang, \"colorItemRed\") + `</ion-button>\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'gray')\" style=\"--background: gray; margin-top: 10px;\">` + language.get(appLang, \"colorItemGray\") + `</ion-button>\n\t\t\t\t\t</section>\n\t\t\t\t</ion-content>\n\t\t\t`;\n    }\n\n  });\n  let modal = await modalController.create({\n    component: modalId,\n    swipeToClose: false,\n    showBackdrop: false,\n    backdropDismiss: false,\n    cssClass: \"modal-fullscreen\"\n  });\n  return modal.present();\n}\nexport async function spawnItemActionSheet(item) {\n  let buttons = undefined;\n\n  if (item.type == \"folder\") {\n    if (window.location.href.indexOf(\"shared-in\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"removeFromShared\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.removeSharedInItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"shared-out\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"stopSharing\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.stopSharingItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"trash\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"restoreItem\"),\n        icon: Ionicons.bagAdd,\n        handler: () => {\n          return this.restoreItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"links\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"itemPublicLink\"),\n        icon: Ionicons.link,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.openPublicLinkModal(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else {\n      buttons = [{\n        text: language.get(this.state.lang, \"shareItem\"),\n        icon: Ionicons.shareSocial,\n        handler: () => {\n          return this.shareItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"itemPublicLink\"),\n        icon: Ionicons.link,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.openPublicLinkModal(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"moveItem\"),\n        icon: Ionicons.move,\n        handler: () => {\n          return this.moveItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"renameItem\"),\n        icon: Ionicons.text,\n        handler: () => {\n          return this.renameItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"colorItem\"),\n        icon: Ionicons.colorFill,\n        handler: () => {\n          return this.colorItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"trashItem\"),\n        icon: Ionicons.trash,\n        handler: () => {\n          return this.trashItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    }\n  } else {\n    if (window.location.href.indexOf(\"shared-in\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\n        icon: Ionicons.save,\n        handler: () => {\n          window.customFunctions.dismissModal();\n\n          if (item.offline) {\n            return this.makeItemAvailableOffline(false, item);\n          } else {\n            return this.makeItemAvailableOffline(true, item);\n          }\n        }\n      }, {\n        text: language.get(this.state.lang, \"removeFromShared\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.removeSharedInItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"shared-out\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\n        icon: Ionicons.save,\n        handler: () => {\n          window.customFunctions.dismissModal();\n\n          if (item.offline) {\n            return this.makeItemAvailableOffline(false, item);\n          } else {\n            return this.makeItemAvailableOffline(true, item);\n          }\n        }\n      }, {\n        text: language.get(this.state.lang, \"stopSharing\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.stopSharingItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"trash\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"restoreItem\"),\n        icon: Ionicons.bagAdd,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.restoreItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"links\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"itemPublicLink\"),\n        icon: Ionicons.link,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.openPublicLinkModal(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\n        icon: Ionicons.save,\n        handler: () => {\n          window.customFunctions.dismissModal();\n\n          if (item.offline) {\n            return this.makeItemAvailableOffline(false, item);\n          } else {\n            return this.makeItemAvailableOffline(true, item);\n          }\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else {\n      buttons = [{\n        text: language.get(this.state.lang, \"shareItem\"),\n        icon: Ionicons.shareSocial,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.shareItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"itemPublicLink\"),\n        icon: Ionicons.link,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.openPublicLinkModal(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\n        icon: Ionicons.save,\n        handler: () => {\n          window.customFunctions.dismissModal();\n\n          if (item.offline) {\n            return this.makeItemAvailableOffline(false, item);\n          } else {\n            return this.makeItemAvailableOffline(true, item);\n          }\n        }\n      }, {\n        text: language.get(this.state.lang, \"moveItem\"),\n        icon: Ionicons.move,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.moveItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"renameItem\"),\n        icon: Ionicons.text,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.renameItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"trashItem\"),\n        icon: Ionicons.trash,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.trashItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    }\n  }\n\n  let headerName = item.name;\n\n  if (headerName.length >= 32) {\n    headerName = headerName.substring(0, 32) + \"...\";\n  }\n\n  let actionSheet = await actionSheetController.create({\n    header: headerName,\n    buttons\n  });\n  await actionSheet.present();\n\n  if (Capacitor.isNative) {\n    setTimeout(() => {\n      Capacitor.Plugins.Keyboard.hide();\n    }, 500);\n  }\n\n  return true;\n}","map":{"version":3,"sources":["/Users/jan/Documents/filen/app/src/components/items.js"],"names":["language","loadingController","modalController","popoverController","alertController","actionSheetController","Ionicons","Capacitor","HapticsImpactStyle","Plugins","FileOpener","utils","require","safeAreaInsets","updateItemList","showLoader","state","isLoggedIn","showLogin","userAPIKey","length","isNative","Keyboard","hide","SplashScreen","setState","searchbarOpen","mainSearchTerm","routeEx","window","location","hash","split","parent","loading","create","message","present","customVariables","currentThumbnailURL","href","items","res","apiRequest","apiKey","e","console","log","customFunctions","dismissLoader","alert","header","subHeader","get","lang","buttons","toUpperCase","status","push","type","uuid","name","date","timestamp","Date","receiverId","receiverEmail","sharerId","sharerEmail","color","i","data","folders","folder","folderName","decryptCryptoJSFolderName","userMasterKeys","uploadDate","toString","item","sanitizeHTML","cachedFolders","iItems","toLowerCase","usrPrivKey","crypto","subtle","importKey","_base64ToArrayBuffer","userPrivateKey","JSON","stringify","page","app","decryptFolderNamePrivateKey","metadata","uploads","file","decryptedMetadata","decryptFileMetadataPrivateKey","offline","offlineSavedFiles","mime","size","parseInt","key","bucket","region","rm","chunks","thumbnail","thumbnailBlobCache","undefined","cachedFiles","currentReceiverId","decryptFileMetadata","orderItemsByType","orderBy","itemList","scrollTo","scrollToIndex","forceUpdate","getFileThumbnail","saveCachedItems","saveThumbnailCache","thumbURL","index","indexOf","getThumbnailErrors","intervalTimer","getRandomArbitrary","document","getElementById","onScreenInterval","setInterval","clearInterval","ext","canShowThumbnail","getThumbnail","saveGetThumbnailErrors","updateItemsSemaphore","acquire","newItems","release","refreshMainList","event","detail","complete","selectItem","selectedItems","selected","Haptics","impact","Light","clearSelectedItems","selectItemsAction","persist","appLang","customElementId","generateRandomClassName","selectedItemsDoesNotContainFolder","inner","customElements","define","ModalContent","HTMLElement","connectedCallback","innerHTML","popover","component","previewItem","lastModalPreviewType","settings","onlyWifi","networkStatus","Network","getStatus","connectionType","spawnToast","getDownloadDir","err","dirObj","open","uri","then","catch","nameEx","previewType","getFilePreviewType","dismissModal","spawnItemActionSheet","gotPreviewData","dataArray","blob","Blob","currentPreviewURL","urlCreator","revokeObjectURL","createObjectURL","previewModalContent","isPlatform","top","arrowBack","btoa","ellipsisVertical","text","TextDecoder","decode","join","setupBars","setupStatusbar","modal","getTop","onDidDismiss","setupSlider","lastPreviewType","slider","getPrevOrNextItem","step","max","tries","getItemRecursive","listIndex","thisNameEx","thisPreviewType","options","freeMode","offset","offsetY","xDown","yDown","addEventListener","firstTouch","getTouch","clientX","clientY","xUp","yUp","xDiff","yDiff","xDiffAbs","Math","abs","yDiffAbs","nextItem","prevItem","changedTouches","loadPdf","canvasContainer","pdfjsLib","GlobalWorkerOptions","workerSrc","loader","renderPage","viewport","getViewport","scale","canvas","createElement","ctx","getContext","renderContext","canvasContext","height","width","appendChild","render","renderPages","pdfDoc","dismiss","numPages","getPage","loadingTask","getDocument","promise","currentModal","querySelectorAll","childNodes","modalId","swipeToClose","showBackdrop","backdropDismiss","cssClass","style","backgroundColor","stopGettingPreviewData","isGettingPreviewData","downloadPreview","chunksDone","dirExists","callback","nameHashed","hashFn","exists","moveFolder","destination","currentParentFolder","existsUUID","folderUUID","checkIfItemParentIsBeingShared","clearTimeout","reloadAfterActionTimeout","setTimeout","moveFile","fileExists","fileUUID","moveItem","spawnMoveToast","cancelled","renameItem","spawnRenamePrompt","newName","removeIllegalCharsFromString","nameRegex","checkIfNameIsBanned","fileNameValidationRegex","fileExt","renameWithDot","cryptoJSEncrypt","metaData","checkIfItemIsBeingSharedForRename","Filesystem","rename","from","to","directory","folderNameRegex","moveSelectedItems","getSelectedItems","dismissPopover","unselectAllItems","trashSelectedItems","role","handler","forEach","trashItem","restoreSelectedItems","restoreItem","Promise","resolve","reject","filter","shareItemWithEmail","email","userEmail","userPubKey","publicKey","usrPubKey","fileName","fileSize","fileMime","fileKey","encrypted","encrypt","TextEncoder","encode","base64ArrayBuffer","shareItems","files","dirName","itemsShared","erroredItems","isAlreadyShared","shareItemRequest","maxTries","cb","shareItemSemaphore","itemMetadata","shareSelectedItems","inputs","id","placeholder","querySelector","focus","shareItem","openPublicLinkModal","appDarkMode","darkMode","enabled","link","expirationText","password","downloadBtn","appUserMasterKeys","decryptFolderLinkKey","makeItemAvailableOffline","rmdir","path","recursive","windowItems","saveOfflineSavedFiles","nItem","makeOffline","queueFileDownload","removeSharedInItem","stopSharingItem","removeSelectedItemsFromSharedIn","stopSharingSelectedItems","downloadSelectedItems","storeSelectedItemsOffline","colorItem","icon","stopCircle","close","actionSheet","bagAdd","shareSocial","move","colorFill","trash","download","save","headerName","substring"],"mappings":"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","sourcesContent":["import * as language from \"../utils/language\"\r\nimport { loadingController, modalController, popoverController, alertController, actionSheetController } from \"@ionic/core\"\r\nimport * as Ionicons from 'ionicons/icons'\r\nimport { Capacitor, HapticsImpactStyle, Plugins } from \"@capacitor/core\"\r\nimport { FileOpener } from \"@ionic-native/file-opener\"\r\n\r\nconst utils = require(\"../utils/utils\")\r\nconst safeAreaInsets = require('safe-area-insets')\r\n\r\nexport async function updateItemList(showLoader = true){\r\n\tif(!this.state.isLoggedIn){\r\n\t\treturn this.showLogin()\r\n\t}\r\n\t\r\n\tif(this.state.userAPIKey.length <= 16){\r\n\t\treturn this.showLogin()\r\n\t}\r\n\r\n\tif(Capacitor.isNative){\r\n\t\tCapacitor.Plugins.Keyboard.hide()\r\n\t\tPlugins.SplashScreen.hide()\r\n\t}\r\n\r\n\tthis.setState({\r\n        searchbarOpen: false,\r\n        mainSearchTerm: \"\"\r\n    })\r\n\r\n\tlet routeEx = window.location.hash.split(\"/\")\r\n\tlet parent = routeEx[routeEx.length - 1]\r\n\r\n    if(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\twindow.customVariables.currentThumbnailURL = window.location.href\r\n\r\n\tlet items = []\r\n\t\r\n\tif(parent == \"base\"){\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/baseFolders\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tconsole.log(e)\r\n\t\r\n\t\t\twindow.customFunctions.dismissLoader()\r\n\t\r\n\t\t\tlet alert = await alertController.create({\r\n\t\t\t\theader: \"\",\r\n\t\t\t\tsubHeader: \"\",\r\n\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t})\r\n\t\r\n\t\t\treturn alert.present()\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\tconsole.log(res.message)\r\n\t\r\n\t\t\twindow.customFunctions.dismissLoader()\r\n\t\r\n\t\t\tlet alert = await alertController.create({\r\n\t\t\t\theader: \"\",\r\n\t\t\t\tsubHeader: \"\",\r\n\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t})\r\n\t\r\n\t\t\treturn alert.present()\r\n\t\t}\r\n\r\n\t\titems.push({\r\n\t\t\ttype: \"folder\",\r\n\t\t\tuuid: \"default\",\r\n\t\t\tname: \"Default\",\r\n\t\t\tdate: language.get(this.state.lang, \"defaultFolder\"),\r\n\t\t\ttimestamp: (((+new Date()) / 1000) - (86400 * 3650)),\r\n\t\t\tparent: \"base\",\r\n\t\t\treceiverId: 0,\r\n\t\t\treceiverEmail: \"\",\r\n\t\t\tsharerId: 0,\r\n\t\t\tsharerEmail: \"\",\r\n\t\t\tcolor: null\r\n\t\t})\r\n\r\n\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\tlet folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid)\r\n\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\tlet item = {\r\n\t\t\t\ttype: \"folder\",\r\n\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\tparent: \"base\",\r\n\t\t\t\treceiverId: 0,\r\n\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\tsharerId: 0,\r\n\t\t\t\tsharerEmail: \"\",\r\n\t\t\t\tcolor: folder.color || null\r\n\t\t\t}\r\n\r\n\t\t\titems.push(item)\r\n\r\n\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t}\r\n\r\n\t\tlet iItems = []\r\n\r\n\t\tiItems.push(items[0])\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tif(items[i].name.toLowerCase() == \"filen sync\" && items[i].uuid !== \"default\"){\r\n\t\t\t\tiItems.push(items[i])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tif(items[i].name.toLowerCase() !== \"filen sync\" && items[i].uuid !== \"default\"){\r\n\t\t\t\tiItems.push(items[i])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\titems = iItems\r\n\t}\r\n\telse{\r\n\t\tif(routeEx[1] == \"shared-in\"){\r\n\t\t\ttry{\r\n\t\t\t\tvar usrPrivKey = await window.crypto.subtle.importKey(\"pkcs8\", utils._base64ToArrayBuffer(this.state.userPrivateKey), {\r\n\t\t\t\t\tname: \"RSA-OAEP\",\r\n\t\t\t\t\thash: \"SHA-512\"\r\n\t\t\t\t}, true, [\"decrypt\"])\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"unknownDeviceError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/in\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: parent,\r\n\t\t\t\t\tfolders: JSON.stringify([\"shred-in\"]),\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tapp: \"true\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tif(!res.status){\r\n\t\t\t\tconsole.log(res.message)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\t\tlet folderName = await utils.decryptFolderNamePrivateKey(folder.metadata, usrPrivKey, folder.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\t\tparent: folder.parent,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: folder.sharerId,\r\n\t\t\t\t\tsharerEmail: folder.sharerEmail,\r\n\t\t\t\t\tcolor: folder.color || null\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.uploads.length; i++){\r\n\t\t\t\tlet file = res.data.uploads[i]\r\n\r\n\t\t\t\tlet decryptedMetadata = await utils.decryptFileMetadataPrivateKey(file.metadata, usrPrivKey, file.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(file.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet offline = false\r\n\r\n\t\t\t\tif(typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\toffline = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tuuid: file.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(decryptedMetadata.name),\r\n\t\t\t\t\tmime: utils.sanitizeHTML(decryptedMetadata.mime),\r\n\t\t\t\t\tsize: parseInt(decryptedMetadata.size),\r\n\t\t\t\t\tkey: utils.sanitizeHTML(decryptedMetadata.key),\r\n\t\t\t\t\tbucket: file.bucket,\r\n\t\t\t\t\tregion: file.region,\r\n\t\t\t\t\tparent: file.parent,\r\n\t\t\t\t\trm: file.rm,\r\n\t\t\t\t\tchunks: file.chunks,\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: file.timestamp,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: file.sharerId,\r\n\t\t\t\t\tsharerEmail: file.sharerEmail,\r\n\t\t\t\t\toffline: offline,\r\n\t\t\t\t\tthumbnail: (typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined)\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFiles[file.uuid] = item\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(routeEx[1] == \"shared-out\"){\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/out\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: parent,\r\n\t\t\t\t\tfolders: JSON.stringify([\"default\"]),\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tapp: \"true\",\r\n\t\t\t\t\treceiverId: this.state.currentReceiverId\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tif(!res.status){\r\n\t\t\t\tconsole.log(res.message)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\t\tlet folderName = utils.decryptCryptoJSFolderName(folder.metadata, this.state.userMasterKeys, folder.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\t\tparent: folder.parent,\r\n\t\t\t\t\treceiverId: folder.receiverId,\r\n\t\t\t\t\treceiverEmail: folder.receiverEmail,\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\",\r\n\t\t\t\t\tcolor: folder.color || null\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.uploads.length; i++){\r\n\t\t\t\tlet file = res.data.uploads[i]\r\n\r\n\t\t\t\tlet metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(file.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet offline = false\r\n\r\n\t\t\t\tif(typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\toffline = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tuuid: file.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(metadata.name),\r\n\t\t\t\t\tmime: utils.sanitizeHTML(metadata.mime),\r\n\t\t\t\t\tsize: parseInt(metadata.size),\r\n\t\t\t\t\tkey: utils.sanitizeHTML(metadata.key),\r\n\t\t\t\t\tbucket: file.bucket,\r\n\t\t\t\t\tregion: file.region,\r\n\t\t\t\t\tparent: file.parent,\r\n\t\t\t\t\trm: file.rm,\r\n\t\t\t\t\tchunks: file.chunks,\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: file.timestamp,\r\n\t\t\t\t\treceiverId: file.receiverId,\r\n\t\t\t\t\treceiverEmail: file.receiverEmail,\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\",\r\n\t\t\t\t\toffline: offline,\r\n\t\t\t\t\tthumbnail: (typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined)\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFiles[file.uuid] = item\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/content\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: parent,\r\n\t\t\t\t\tfolders: JSON.stringify([\"default\"]),\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tapp: \"true\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tif(!res.status){\r\n\t\t\t\tconsole.log(res.message)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\t\tlet folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\t\tparent: folder.parent,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\",\r\n\t\t\t\t\tcolor: folder.color || null\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.uploads.length; i++){\r\n\t\t\t\tlet file = res.data.uploads[i]\r\n\r\n\t\t\t\tlet metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(file.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet offline = false\r\n\r\n\t\t\t\tif(typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\toffline = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tuuid: file.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(metadata.name),\r\n\t\t\t\t\tmime: utils.sanitizeHTML(metadata.mime),\r\n\t\t\t\t\tsize: parseInt(metadata.size),\r\n\t\t\t\t\tkey: utils.sanitizeHTML(metadata.key),\r\n\t\t\t\t\tbucket: file.bucket,\r\n\t\t\t\t\tregion: file.region,\r\n\t\t\t\t\tparent: file.parent,\r\n\t\t\t\t\trm: file.rm,\r\n\t\t\t\t\tchunks: file.chunks,\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: file.timestamp,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\",\r\n\t\t\t\t\toffline: offline,\r\n\t\t\t\t\tthumbnail: (typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined)\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFiles[file.uuid] = item\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\titems = utils.orderItemsByType(items, window.customVariables.orderBy)\r\n\r\n\twindow.customVariables.itemList = items\r\n\r\n\tlet scrollTo = 0\r\n\r\n\tif(typeof window.customVariables.scrollToIndex[parent] !== \"undefined\"){\r\n\t\tscrollTo = window.customVariables.scrollToIndex[parent]\r\n\r\n\t\tdelete window.customVariables.scrollToIndex[parent]\r\n\t}\r\n\r\n\treturn this.setState({\r\n\t\titemList: items,\r\n\t\tscrollToIndex: scrollTo\r\n\t}, () => {\r\n\t\twindow.customFunctions.dismissLoader()\r\n\r\n\t\tthis.forceUpdate()\r\n\r\n\t\twindow.customVariables.currentThumbnailURL = window.location.href\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tthis.getFileThumbnail(items[i], window.customVariables.currentThumbnailURL, i)\r\n\t\t}\r\n\r\n\t\twindow.customFunctions.saveCachedItems()\r\n\t\twindow.customFunctions.saveThumbnailCache()\r\n\t})\r\n}\r\n\r\nexport function getFileThumbnail(file, thumbURL, index){\r\n\tif(file.type !== \"file\" || file.name.indexOf(\".\") == -1 || typeof file.thumbnail !== \"undefined\"){\r\n\t\treturn false\r\n\t}\r\n\r\n\tif(typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\"){\r\n\t\tif(window.customVariables.getThumbnailErrors[file.uuid] >= 16){\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tlet intervalTimer = utils.getRandomArbitrary(10, 50)\r\n\r\n\tif(document.getElementById(\"item-thumbnail-\" + file.uuid) !== null){\r\n\t\tintervalTimer = 1\r\n\t}\r\n\r\n\tlet onScreenInterval = setInterval(async () => {\r\n\t\tif(thumbURL !== window.location.href){\r\n\t\t\treturn clearInterval(onScreenInterval)\r\n\t\t}\r\n\t\telse{\r\n\t\t\tif(document.getElementById(\"item-thumbnail-\" + file.uuid) !== null){\r\n\t\t\t\tclearInterval(onScreenInterval)\r\n\r\n\t\t\t\tlet ext = file.name.split(\".\")\r\n\t\t\t\text = ext[ext.length - 1]\r\n\r\n\t\t\t\tlet thumbnail = undefined\r\n\t\t\r\n\t\t\t\tif(utils.canShowThumbnail(ext)){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tthumbnail = await this.getThumbnail(file, thumbURL, ext)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\tconsole.log(e)\r\n\r\n\t\t\t\t\t\tif(e.indexOf(\"url changed\") == -1){\r\n\t\t\t\t\t\t\tif(typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\t\t\t\twindow.customVariables.getThumbnailErrors[file.uuid] = window.customVariables.getThumbnailErrors[file.uuid] + 1\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\twindow.customVariables.getThumbnailErrors[file.uuid] = 1\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\twindow.customFunctions.saveGetThumbnailErrors()\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(typeof thumbnail !== \"undefined\"){\r\n\t\t\t\t\tawait window.customVariables.updateItemsSemaphore.acquire()\r\n\r\n\t\t\t\t\tlet newItems = this.state.itemList\r\n\r\n\t\t\t\t\tfor(let i = 0; i < newItems.length; i++){\r\n\t\t\t\t\t\tif(newItems[i].uuid == file.uuid){\r\n\t\t\t\t\t\t\tnewItems[i].thumbnail = thumbnail\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.customVariables.itemList = newItems\r\n\r\n\t\t\t\t\tif(thumbURL == window.location.href){\r\n\t\t\t\t\t\treturn this.setState({\r\n\t\t\t\t\t\t\titemList: newItems\r\n\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\tthis.forceUpdate()\r\n\r\n\t\t\t\t\t\t\twindow.customVariables.updateItemsSemaphore.release()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\twindow.customVariables.updateItemsSemaphore.release()\r\n\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}, intervalTimer)\r\n}\r\n\r\nexport async function refreshMainList(event){\r\n    await this.updateItemList()\r\n\r\n    return event.detail.complete()\r\n}\r\n\r\nexport function selectItem(type, index){\r\n    let items = this.state.itemList\r\n    let selectedItems = this.state.selectedItems\r\n\r\n    if(type){\r\n        if(!items[index].selected){\r\n            items[index].selected = type\r\n            selectedItems = selectedItems + 1\r\n\t\t}\r\n\t\t\r\n\t\tif(selectedItems == 1 && Capacitor.isNative){\r\n\t\t\tPlugins.Haptics.impact(HapticsImpactStyle.Light)\r\n\t\t}\r\n    }\r\n    else{\r\n        if(items[index].selected){\r\n            items[index].selected = type\r\n            selectedItems = selectedItems - 1\r\n        }\r\n    }\r\n\r\n    return this.setState({\r\n        itemList: items,\r\n        selectedItems\r\n    })\r\n}\r\n\r\nexport function clearSelectedItems(){\r\n    let items = this.state.itemList\r\n\r\n    for(let i = 0; i < items.length; i++){\r\n        items[i].selected = false\r\n    }\r\n\r\n    return this.setState({\r\n        itemList: items,\r\n        selectedItems: 0\r\n    })\r\n}\r\n\r\nexport async function selectItemsAction(event){\r\n    event.persist()\r\n\r\n\tlet appLang = this.state.lang\r\n\tlet customElementId = utils.generateRandomClassName()\r\n\tlet selectedItemsDoesNotContainFolder = utils.selectedItemsDoesNotContainFolder(this.state.itemList)\r\n\t\r\n\tlet inner = \"\"\r\n\r\n\tif(window.location.href.indexOf(\"shared-in\") !== -1){\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.removeSelectedItemsFromSharedIn()\">` + language.get(appLang, \"removeFromShared\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\telse if(window.location.href.indexOf(\"shared-out\") !== -1){\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.stopSharingSelectedItems()\">` + language.get(appLang, \"stopSharing\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\telse if(window.location.href.indexOf(\"trash\") !== -1){\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.restoreSelectedItems()\">` + language.get(appLang, \"restoreItem\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\telse{\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t` + (selectedItemsDoesNotContainFolder ? `<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.storeSelectedItemsOffline()\">` + language.get(appLang, \"storeSelectedItemsOffline\") + `</ion-item>` : ``) + `\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.moveSelectedItems()\">` + language.get(appLang, \"moveItem\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.trashSelectedItems()\">` + language.get(appLang, \"trashItem\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\r\n    window.customElements.define(customElementId, class ModalContent extends HTMLElement {\r\n        connectedCallback(){\r\n            this.innerHTML = inner\r\n        }\r\n    })\r\n\r\n    let popover = await popoverController.create({\r\n        component: customElementId,\r\n        event: event\r\n    })\r\n\r\n    return popover.present()\r\n}\r\n\r\nexport async function previewItem(item, lastModalPreviewType = undefined){\r\n    if(item.type !== \"file\"){\r\n\t\treturn false\r\n\t}\r\n\r\n\tif(Capacitor.isNative && typeof lastModalPreviewType == \"undefined\"){\r\n        if(this.state.settings.onlyWifi){\r\n            let networkStatus = await Plugins.Network.getStatus()\r\n\r\n            if(networkStatus.connectionType !== \"wifi\"){\r\n                return this.spawnToast(language.get(this.state.lang, \"onlyWifiError\"))\r\n            }\r\n        }\r\n\t}\r\n\t\r\n\tif(Capacitor.isNative){\r\n\t\tCapacitor.Plugins.Keyboard.hide()\r\n\t}\r\n\r\n\tif(typeof window.customVariables.offlineSavedFiles[item.uuid] !== \"undefined\" && typeof lastModalPreviewType == \"undefined\"){\r\n\t\tthis.getDownloadDir(true, item.uuid, (err, dirObj) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"))\r\n\t\t\t}\r\n\r\n\t\t\tFileOpener.open(dirObj.uri.uri + \"/\" + item.name, item.mime).then(() => {\r\n\t\t\t\tconsole.log(dirObj.uri.uri + \"/\" + item.name, item.mime)\r\n\t\t\t}).catch((err) => {\r\n\t\t\t\tconsole.log(err)\r\n\t\t\t\tconsole.log(dirObj.uri.uri + \"/\" + item.name, item.mime)\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"noAppFoundToOpenFile\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\telse{\r\n\t\tlet nameEx = item.name.split(\".\")\r\n\t\tlet previewType = utils.getFilePreviewType(nameEx[nameEx.length - 1])\r\n\r\n\t\tif(previewType == \"none\"){\r\n\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t}\r\n\r\n\t\tif(item.size > ((1024 * 1024) * 64)){\r\n\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t}\r\n\r\n\t\tconst gotPreviewData = async (dataArray) => {\r\n\t\t\tlet blob = new Blob([dataArray], {\r\n\t\t\t\ttype: item.mime,\r\n\t\t\t\tname: item.name\r\n\t\t\t})\r\n\r\n\t\t\tif(typeof window.customVariables.currentPreviewURL !== \"undefined\"){\r\n\t\t\t\twindow.customVariables.urlCreator.revokeObjectURL(window.customVariables.currentPreviewURL)\r\n\t\t\t}\r\n\r\n\t\t\twindow.customVariables.currentPreviewURL = window.customVariables.urlCreator.createObjectURL(blob)\r\n\r\n\t\t\tlet previewModalContent = ``\r\n\r\n\t\t\tif(previewType == \"image\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow preview-header-hidden\" style=\"position: absolute; display: none; margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\" onClick=\"window.customFunctions.togglePreviewHeader(true)\">\r\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\r\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\r\n\t\t\t\t\t\t\t<ion-slide>\r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t\t\t<img id=\"preview-img\" src=\"` + window.customVariables.currentPreviewURL + `\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh;\">\r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t</ion-slide>\r\n\t\t\t\t\t\t</ion-slides>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"video\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute; margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\r\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\r\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\r\n\t\t\t\t\t\t\t<ion-slide>\r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t\t\t<video id=\"preview-video\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh; margin-top: 56px;\" src=\"` + window.customVariables.currentPreviewURL + `\" autoplay preload controls></video>\r\n\t\t\t\t\t\t\t\t</center>\r\n\t\t\t\t\t\t\t</ion-slide>\r\n\t\t\t\t\t\t</ion-slides>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"audio\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute; margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\r\n\t\t\t\t\t\t<ion-toolbar style=\"--background: transparent; color: white;\">\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\r\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\r\n\t\t\t\t\t\t\t<ion-slide>\r\n\t\t\t\t\t\t\t\t<audio autoplay preload controls>\r\n\t\t\t\t\t\t\t\t\t<source src=\"` + window.customVariables.currentPreviewURL + `\" type=\"audio/mpeg\">\r\n\t\t\t\t\t\t\t\t</audio>\r\n\t\t\t\t\t\t\t</ion-slide>\r\n\t\t\t\t\t\t</ion-slides>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"code\" || previewType == \"text\"){\r\n\t\t\t\tlet text = new TextDecoder().decode(dataArray).split(\"<\").join(\"&lt;\")\r\n\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\r\n\t\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content fullscreen style=\"-webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">\r\n\t\t\t\t\t\t<pre style=\"width: 100vw; height: 100%; margin-top: 0px; padding: 10px; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">` + text + `</pre>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"pdf\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\r\n\t\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content fullscreen>\r\n\t\t\t\t\t\t<div id=\"pdf-viewer\" style=\"width: 100%; height: 100%; overflow: scroll;\"></div>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\r\n\t\t\tif(previewModalContent.length <= 8){\r\n\t\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t\t}\r\n\r\n\t\t\tconst setupBars = async () => {\r\n\t\t\t\tif(previewType == \"image\" || previewType == \"video\" || previewType == \"audio\"){\r\n\t\t\t\t\tthis.setupStatusbar(\"image/video\")\r\n\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tlet modal = await modalController.getTop()\r\n\t\r\n\t\t\t\t\t\tmodal.onDidDismiss().then(() => {\r\n\t\t\t\t\t\t\tthis.setupStatusbar()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst setupSlider = (lastPreviewType) => {\r\n\t\t\t\tlet slider = document.getElementById(\"slider\")\r\n\r\n\t\t\t\tif(slider == null){\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet itemList = this.state.itemList\r\n\r\n\t\t\t\tconst getPrevOrNextItem = (type) => {\r\n\t\t\t\t\tlet step = 1\r\n\t\t\t\t\tlet max = 128\r\n\t\t\t\t\tlet tries = 0\r\n\r\n\t\t\t\t\tconst getItemRecursive = (type) => {\r\n\t\t\t\t\t\tif(tries > max){\r\n\t\t\t\t\t\t\treturn undefined\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttries += 1\r\n\r\n\t\t\t\t\t\tfor(let i = 0; i < itemList.length; i++){\r\n\t\t\t\t\t\t\tif(itemList[i].uuid == item.uuid){\r\n\t\t\t\t\t\t\t\tlet item = undefined\r\n\t\t\t\t\t\t\t\tlet listIndex = undefined\r\n\r\n\t\t\t\t\t\t\t\tif(type == \"prev\"){\r\n\t\t\t\t\t\t\t\t\tlistIndex = (i - step)\r\n\r\n\t\t\t\t\t\t\t\t\titem = itemList[listIndex]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\tlistIndex = (i + step)\r\n\r\n\t\t\t\t\t\t\t\t\titem = itemList[listIndex]\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif(typeof item == \"undefined\"){\r\n\t\t\t\t\t\t\t\t\tstep += 1\r\n\r\n\t\t\t\t\t\t\t\t\treturn getItemRecursive(type)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\tlet thisNameEx = item.name.split(\".\")\r\n\t\t\t\t\t\t\t\t\tlet thisPreviewType = utils.getFilePreviewType(thisNameEx[thisNameEx.length - 1])\r\n\r\n\t\t\t\t\t\t\t\t\tif(thisPreviewType == lastPreviewType){\r\n\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\titem,\r\n\t\t\t\t\t\t\t\t\t\t\tlistIndex\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\tstep += 1\r\n\r\n\t\t\t\t\t\t\t\t\t\treturn getItemRecursive(type)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn getItemRecursive(type)\r\n\t\t\t\t}\r\n        \r\n\t\t\t\tslider.options = {\r\n\t\t\t\t\tfreeMode: false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet offset = 75\r\n\t\t\t\tlet offsetY = 150\r\n\t\t\t\tlet xDown, yDown\r\n\r\n\t\t\t\tslider.addEventListener(\"touchstart\", (e) => {\r\n\t\t\t\t\tlet firstTouch = getTouch(e)\r\n\r\n\t\t\t\t\txDown = firstTouch.clientX\r\n\t\t\t\t\tyDown = firstTouch.clientY\r\n\t\t\t\t})\r\n\r\n\t\t\t\tslider.addEventListener(\"touchend\", (e) => {\r\n\t\t\t\t\tif(!xDown || !yDown){\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet {\r\n\t\t\t\t\t\tclientX: xUp,\r\n\t\t\t\t\t\tclientY: yUp\r\n\t\t\t\t\t} = getTouch(e)\r\n\r\n\t\t\t\t\tlet xDiff = xDown - xUp\r\n\t\t\t\t\tlet yDiff = yDown - yUp\r\n\t\t\t\t\tlet xDiffAbs = Math.abs(xDown - xUp)\r\n\t\t\t\t\tlet yDiffAbs = Math.abs(yDown - yUp)\r\n\r\n\t\t\t\t\tif(Math.max(xDiffAbs, yDiffAbs) < offset){\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(xDiffAbs > yDiffAbs){\r\n\t\t\t\t\t\tif(xDiff > 0){\r\n\t\t\t\t\t\t\tlet nextItem = getPrevOrNextItem(\"next\")\r\n\r\n\t\t\t\t\t\t\tif(typeof nextItem == \"undefined\"){\r\n\t\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\t\tscrollToIndex: nextItem.listIndex\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\treturn this.previewItem(nextItem.item, lastPreviewType)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tlet prevItem = getPrevOrNextItem(\"prev\")\r\n\r\n\t\t\t\t\t\t\tif(typeof prevItem == \"undefined\"){\r\n\t\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\t\tscrollToIndex: prevItem.listIndex\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\treturn this.previewItem(prevItem.item, lastPreviewType)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif(xDiffAbs < yDiffAbs && Math.max(xDiffAbs, yDiffAbs) > offsetY){\r\n\t\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false\r\n\t\t\t\t})\r\n\r\n\t\t\t\tconst getTouch = (e) => {\r\n\t\t\t\t\treturn e.changedTouches[0]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst loadPdf = async () => {\r\n\t\t\t\tlet canvasContainer = document.getElementById(\"pdf-viewer\")\r\n\r\n\t\t\t\tif(typeof window.pdfjsLib == \"undefined\"){\r\n\t\t\t\t\treturn window.customFunctions.dismissModal()\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.pdfjsLib.GlobalWorkerOptions.workerSrc = \"assets/pdf/build/pdf.worker.js\"\r\n\r\n\t\t\t\tlet loader = await loadingController.create({\r\n\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t})\r\n\r\n\t\t\t\tloader.present()\r\n        \r\n\t\t\t\tfunction renderPage(page){\r\n\t\t\t\t\tlet viewport = page.getViewport({\r\n\t\t\t\t\t\tscale: 2\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tlet canvas = document.createElement('canvas')\r\n\t\t\t\t\tlet ctx = canvas.getContext('2d')\r\n\r\n\t\t\t\t\tlet renderContext = {\r\n\t\t\t\t\t\tcanvasContext: ctx,\r\n\t\t\t\t\t\tviewport: viewport\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcanvas.height = viewport.height\r\n\t\t\t\t\tcanvas.width = viewport.width\r\n\r\n\t\t\t\t\tcanvasContainer.appendChild(canvas)\r\n\t\t\t\t\t\r\n\t\t\t\t\tpage.render(renderContext)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction renderPages(pdfDoc){\r\n\t\t\t\t\tif(typeof loader !== \"undefined\"){\r\n\t\t\t\t\t\tloader.dismiss()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(let i = 1; i <= pdfDoc.numPages; i++){\r\n\t\t\t\t\t\tpdfDoc.getPage(i).then(renderPage)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet loadingTask = window.pdfjsLib.getDocument({\r\n\t\t\t\t\tdata: dataArray\r\n\t\t\t\t})\r\n\r\n\t\t\t\tloadingTask.promise.then(renderPages).catch((err) => {\r\n\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\treturn window.customFunctions.dismissModal()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar currentModal = document.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0]\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e){\r\n\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\r\n\t\t\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrentModal.innerHTML = previewModalContent\r\n\r\n\t\t\t\tif(previewType == \"pdf\"){\r\n\t\t\t\t\tloadPdf()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetupBars()\r\n\t\t\t\tsetupSlider(previewType)\r\n\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tlet modalId = \"preview-modal-\" + utils.generateRandomClassName()\r\n\r\n\t\t\t\tcustomElements.define(modalId, class ModalContent extends HTMLElement {\r\n\t\t\t\t\tconnectedCallback() {\r\n\t\t\t\t\t\tthis.innerHTML = previewModalContent\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tvar modal = await modalController.create({\r\n\t\t\t\t\tcomponent: modalId,\r\n\t\t\t\t\tswipeToClose: true,\r\n\t\t\t\t\tshowBackdrop: false,\r\n\t\t\t\t\tbackdropDismiss: false,\r\n\t\t\t\t\tcssClass: \"modal-fullscreen\"\r\n\t\t\t\t})\r\n\r\n\t\t\t\tawait modal.present()\r\n\r\n\t\t\t\tif(Capacitor.isNative){\r\n\t\t\t\t\tCapacitor.Plugins.Keyboard.hide()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(previewType == \"image\" || previewType == \"video\" || previewType == \"audio\"){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tdocument.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0].style.backgroundColor = \"black\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(previewType == \"pdf\"){\r\n\t\t\t\t\tloadPdf()\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tsetupBars()\r\n\t\t\t\tsetupSlider(previewType)\r\n\t\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet loading = await loadingController.create({\r\n\t\t\tmessage: \"\", //language.get(this.state.lang, \"loadingPreview\")\r\n\t\t\tbackdropDismiss: true\r\n\t\t})\r\n\r\n\t\tloading.present()\r\n\r\n\t\ttry{\r\n\t\t\tloading.onDidDismiss().then(() => {\r\n\t\t\t\twindow.customVariables.stopGettingPreviewData = true\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tconsole.log(e)\r\n\t\t}\r\n\r\n\t\twindow.customVariables.isGettingPreviewData = true\r\n\t\twindow.customVariables.stopGettingPreviewData = false\r\n\r\n\t\tthis.downloadPreview(item, (chunksDone) => {\r\n\t\t\t//console.log(chunksDone)\r\n\t\t}, (err, dataArray) => {\r\n\t\t\twindow.customVariables.isGettingPreviewData = false\r\n\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\tif(err){\r\n\t\t\t\tif(err !== \"stopped\"){\r\n\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileNoPreviewAvailable\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn gotPreviewData(dataArray)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport async function dirExists(name, parent, callback){\r\n\tif(parent == null){\r\n\t\tparent = \"base\"\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/exists\", {\r\n\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\tparent,\r\n\t\t\tnameHashed: utils.hashFn(name.toLowerCase())\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\treturn callback(e)\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\treturn callback(res.message)\r\n\t}\r\n\r\n\treturn callback(null, res.data.exists, res.data.uuid)\r\n}\r\n\r\nexport async function moveFolder(folder, destination, showLoader){\r\n\tif(folder.parent == destination){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"))\r\n\t}\r\n\r\n\tif(utils.currentParentFolder() == \"base\"){\r\n\t\tif(folder.uuid == \"default\" || folder.name.toLowerCase() == \"filen sync\"){\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"thisFolderCannotBeMoved\")) \r\n\t\t}\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\tthis.dirExists(folder.name, destination, async (err, exists, existsUUID) => {\r\n\t\tif(err){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(exists){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"folderMoveAlreadyExistsHere\", true, [\"__NAME__\"], [folder.name]))\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/move\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\tfolderUUID: destination\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\treturn this.spawnToast(res.message)\r\n\t\t}\r\n\r\n\t\tutils.checkIfItemParentIsBeingShared(destination, \"folder\", {\r\n\t\t\tname: folder.name\r\n\t\t}, () => {\r\n\t\t\tthis.spawnToast(language.get(this.state.lang, \"folderMoved\", true, [\"__NAME__\"], [folder.name]))\r\n\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tif(utils.currentParentFolder() == destination){\r\n\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t}\r\n\t\t\t}, 500)\r\n\r\n\t\t\treturn true\r\n\t\t})\r\n\t})\r\n}\r\n\r\nexport async function moveFile(file, destination, showLoader){\r\n\tif(file.parent == destination){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"))\r\n\t}\r\n\r\n\tif(destination == \"trash\" || destination == \"base\" || destination == \"shared-in\" || destination == \"shared-out\"){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotMoveFileHere\"))\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\tthis.fileExists(file.name, destination, async (err, exists, existsUUID) => {\r\n\t\tif(err){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(exists){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileMoveAlreadyExistsHere\", true, [\"__NAME__\"], [file.name]))\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/move\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tfileUUID: file.uuid,\r\n\t\t\t\tfolderUUID: destination\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\treturn this.spawnToast(res.message)\r\n\t\t}\r\n\r\n\t\tutils.checkIfItemParentIsBeingShared(destination, \"file\", {\r\n\t\t\tuuid: file.uuid,\r\n\t\t\tname: file.name,\r\n\t\t\tsize: parseInt(file.size),\r\n\t\t\tmime: file.mime,\r\n\t\t\tkey: file.key\r\n\t\t}, () => {\r\n\t\t\tthis.spawnToast(language.get(this.state.lang, \"fileMoved\", true, [\"__NAME__\"], [file.name]))\r\n\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tif(utils.currentParentFolder() == destination){\r\n\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t}\r\n\t\t\t}, 500)\r\n\r\n\t\t\treturn true\r\n\t\t})\r\n\t})\r\n}\r\n\r\nexport function moveItem(item){\r\n\tthis.spawnMoveToast((cancelled, destination) => {\r\n\t\tif(cancelled){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\treturn this.moveFile(item, destination, true)\r\n\t\t}\r\n\t\telse{\r\n\t\t\treturn this.moveFolder(item, destination, true)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport async function renameItem(item){\r\n\tlet parent = utils.currentParentFolder()\r\n\r\n\tif(parent == \"base\"){\r\n\t\tif(item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\"){\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotRenameItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t}\r\n\t}\r\n\r\n\tthis.spawnRenamePrompt(item, async (cancelled, newName) => {\r\n\t\tif(cancelled){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tif(item.name == newName){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\tnewName = utils.removeIllegalCharsFromString(newName)\r\n\r\n\t\t\tif(utils.nameRegex(newName) || utils.checkIfNameIsBanned(newName) || utils.fileNameValidationRegex(newName)){\r\n\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"invalidFileName\"))\r\n\t\t\t}\r\n\r\n\t\t\tlet nameEx = item.name.split(\".\")\r\n\t\t\tlet fileExt = nameEx[nameEx.length - 1]\r\n\t\t\tlet renameWithDot = false\r\n\r\n\t\t\tif(item.name.indexOf(\".\") !== -1){\r\n\t\t\t\trenameWithDot = true\r\n\t\t\t}\r\n\r\n\t\t\tthis.fileExists(newName, parent, async (err, exists, existsUUID) => {\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(exists){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(renameWithDot){\r\n\t\t\t\t\tnewName = newName + \".\" + fileExt\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/rename\", {\r\n\t\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\t\tuuid: item.uuid,\r\n\t\t\t\t\t\tname: utils.cryptoJSEncrypt(newName, item.key),\r\n\t\t\t\t\t\tnameHashed: utils.hashFn(newName.toLowerCase()),\r\n\t\t\t\t\t\tmetaData: utils.cryptoJSEncrypt(JSON.stringify({\r\n\t\t\t\t\t\t\tname: newName,\r\n\t\t\t\t\t\t\tsize: parseInt(item.size),\r\n\t\t\t\t\t\t\tmime: item.mime,\r\n\t\t\t\t\t\t\tkey: item.key\r\n\t\t\t\t\t\t}), this.state.userMasterKeys[this.state.userMasterKeys.length - 1])\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e){\r\n\t\t\t\t\tconsole.log(e)\r\n\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRenameFile\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.checkIfItemIsBeingSharedForRename(\"file\", item.uuid, {\r\n\t\t\t\t\tname: newName,\r\n\t\t\t\t\tsize: parseInt(item.size),\r\n\t\t\t\t\tmime: item.mime,\r\n\t\t\t\t\tkey: item.key\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\tthis.spawnToast(language.get(this.state.lang, \"fileRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]))\r\n\r\n\t\t\t\t\tdelete window.customVariables.cachedFiles[item.uuid]\r\n\r\n\t\t\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\t\t\tif(utils.currentParentFolder() == parent){\r\n\t\t\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500)\r\n\r\n\t\t\t\t\tif(typeof window.customVariables.offlineSavedFiles !== \"undefined\" && Capacitor.isNative){\r\n\t\t\t\t\t\tthis.getDownloadDir(true, item.uuid, async (err, dirObj) => {\r\n\t\t\t\t\t\t\tif(err){\r\n\t\t\t\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"))\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\t\tawait Plugins.Filesystem.rename({\r\n\t\t\t\t\t\t\t\t\tfrom: dirObj + \"/\" + item.name,\r\n\t\t\t\t\t\t\t\t\tto: dirObj + \"/\" +  newName,\r\n\t\t\t\t\t\t\t\t\tdirectory: dirObj.directory\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRenameFileLocally\"))\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn console.log(\"File renamed locally\")\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tnewName = utils.removeIllegalCharsFromString(newName)\r\n\r\n\t\t\tif(utils.checkIfNameIsBanned(newName) || utils.folderNameRegex(newName) || utils.fileNameValidationRegex(newName)){\r\n\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"invalidFolderName\"))\r\n\t\t\t}\r\n\r\n\t\t\tthis.dirExists(newName, parent, async (err, exists, existsUUID) => {\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(exists){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"folderRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/rename\", {\r\n\t\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\t\tuuid: item.uuid,\r\n\t\t\t\t\t\tname: utils.cryptoJSEncrypt(JSON.stringify({\r\n\t\t\t\t\t\t\tname: newName,\r\n\t\t\t\t\t\t}), this.state.userMasterKeys[this.state.userMasterKeys.length - 1]),\r\n\t\t\t\t\t\tnameHashed: utils.hashFn(newName.toLowerCase())\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e){\r\n\t\t\t\t\tconsole.log(e)\r\n\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRenameFolder\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.checkIfItemIsBeingSharedForRename(\"folder\", item.uuid, {\r\n\t\t\t\t\tname: newName\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\tthis.spawnToast(language.get(this.state.lang, \"folderRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]))\r\n\r\n\t\t\t\t\tdelete window.customVariables.cachedFolders[item.uuid]\r\n\r\n\t\t\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\t\t\tif(utils.currentParentFolder() == parent){\r\n\t\t\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500)\r\n\r\n\t\t\t\t\treturn true\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport async function moveSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tthis.spawnMoveToast((cancelled, destination) => {\r\n\t\tif(cancelled){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tif(items[i].type == \"file\"){\r\n\t\t\t\tthis.moveFile(items[i], destination, true)\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis.moveFolder(items[i], destination, true)\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport async function trashSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tlet alert = await alertController.create({\r\n\t\theader: language.get(this.state.lang, \"trashItemHeader\"),\r\n\t\tmessage: language.get(this.state.lang, \"trashItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\r\n\t\tbuttons: [\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\trole: \"cancel\",\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"alertOkButton\"),\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\titems.forEach((item) => {\r\n\t\t\t\t\t\tthis.trashItem(item, false)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]\r\n\t})\r\n\r\n\treturn alert.present()\r\n}\r\n\r\nexport async function restoreSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tlet alert = await alertController.create({\r\n\t\theader: language.get(this.state.lang, \"restoreItemsHeader\"),\r\n\t\tmessage: language.get(this.state.lang, \"restoreItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\r\n\t\tbuttons: [\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\trole: \"cancel\",\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"alertOkButton\"),\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\titems.forEach((item) => {\r\n\t\t\t\t\t\tthis.restoreItem(item, false)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]\r\n\t})\r\n\r\n\treturn alert.present()\r\n}\r\n\r\nexport function getSelectedItems(){\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet items = this.state.itemList.filter((item) => {\r\n\t\t\treturn item.selected === true\r\n\t\t})\r\n\r\n\t\treturn resolve(items)\r\n\t})\r\n}\r\n\r\nexport async function restoreItem(item, showLoader){\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\tif(item.type == \"file\"){\r\n\t\tthis.fileExists(item.name, item.parent, async (err, exists, existsUUID) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\r\n\t\t\tif(exists){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/restore\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: item.uuid\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(!res.status){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\t\t\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\t\t\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tthis.updateItemList()\r\n\t\t\t}, 500)\r\n\t\t\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]))\r\n\t\t})\r\n\t}\r\n\telse{\r\n\t\tthis.dirExists(item.name, item.parent, async (err, exists, existsUUID) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\r\n\t\t\tif(exists){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"folderExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/restore\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: item.uuid\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(!res.status){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\t\t\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\t\t\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tthis.updateItemList()\r\n\t\t\t}, 500)\r\n\t\t\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]))\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport async function trashItem(item, showLoader){\r\n\tif(utils.currentParentFolder() == \"base\"){\r\n\t\tif(item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\"){\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotTrashItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t}\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\ttry{\r\n\t\tif(item.type == \"file\"){\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/trash\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: item.uuid\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/trash\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: item.uuid\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotTrashItem\", true, [\"__NAME__\"], [item.name]))\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tloading.dismiss()\r\n\t}\r\n\r\n\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\tthis.updateItemList()\r\n\t}, 500)\r\n\r\n\treturn this.spawnToast(language.get(this.state.lang, \"itemTrashed\", true, [\"__NAME__\"], [item.name]))\r\n}\r\n\r\nexport async function shareItemWithEmail(email, uuid, type, callback){\r\n\tif(email == this.state.userEmail){\r\n\t\treturn callback(language.get(this.state.lang, \"cannotShareWithSelf\"))\r\n\t}\r\n\r\n\tlet loading = await loadingController.create({\r\n\t\tmessage: \"\"\r\n\t})\r\n\r\n\tloading.present()\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/publicKey/get\", {\r\n\t\t\temail\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(e)\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(res.message)\r\n\t}\r\n\r\n\tlet userPubKey = res.data.publicKey\r\n\r\n\tif(userPubKey == null){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]))\r\n\t}\r\n\r\n\tif(userPubKey.length <= 1){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]))\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar usrPubKey = await window.crypto.subtle.importKey(\"spki\", utils._base64ToArrayBuffer(userPubKey), {\r\n\t\t\tname: \"RSA-OAEP\",\r\n\t\t  \thash: \"SHA-512\"\r\n\t  \t}, true, [\"encrypt\"])\r\n\t}\r\n\tcatch(e){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(e)\r\n\t}\r\n\r\n\tif(type == \"file\"){\r\n\t\tif(typeof window.customVariables.cachedFiles[uuid] == \"undefined\"){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(language.get(this.state.lang, \"shareItemFileNotFound\", true, [\"__NAME__\"], [uuid]))\r\n\t\t}\r\n\r\n\t\tlet fileName = window.customVariables.cachedFiles[uuid].name\r\n\t\tlet fileSize = window.customVariables.cachedFiles[uuid].size\r\n\t\tlet fileMime = window.customVariables.cachedFiles[uuid].mime\r\n\t\tlet fileKey = window.customVariables.cachedFiles[uuid].key\r\n\r\n\t\ttry{\r\n\t\t\tvar encrypted = await window.crypto.subtle.encrypt({\r\n\t\t\t\tname: \"RSA-OAEP\"\r\n\t\t\t}, usrPubKey, new TextEncoder().encode(JSON.stringify({\r\n\t\t\t\tname: fileName,\r\n\t\t\t\tsize: fileSize,\r\n\t\t\t\tmime: fileMime,\r\n\t\t\t\tkey: fileKey\r\n\t\t\t})))\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn console.log(e)\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/share\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid,\r\n\t\t\t\tparent: \"none\",\r\n\t\t\t\temail,\r\n\t\t\t\ttype: \"file\",\r\n\t\t\t\tmetadata: utils.base64ArrayBuffer(encrypted)\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(e)\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(res.message)\r\n\t\t}\r\n\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(null)\r\n\t}\r\n\telse{\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/download/dir\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(e)\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(res.message)\r\n\t\t}\r\n\r\n\t\tlet shareItems = []\r\n\r\n\t\tlet files = res.data.files\r\n\t\tlet folders = res.data.folders\r\n\r\n\t\tif((files.length + folders.length) > 1000000){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(language.get(this.state.lang, \"shareTooBigForApp\"))\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < files.length; i++){\r\n\t\t\tlet metadata = utils.decryptFileMetadata(files[i].metadata, this.state.userMasterKeys, files[i].uuid)\r\n\r\n\t\t\tif(metadata.key.length > 0){\r\n\t\t\t\tshareItems.push({\r\n\t\t\t\t\tuuid: files[i].uuid,\r\n\t\t\t\t\tparent: files[i].parent,\r\n\t\t\t\t\tmetadata: {\r\n\t\t\t\t\t\tname: metadata.name,\r\n\t\t\t\t\t\tsize: parseInt(metadata.size),\r\n\t\t\t\t\t\tmime: metadata.mime,\r\n\t\t\t\t\t\tkey: metadata.key\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttype: \"file\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < folders.length; i++){\r\n\t\t\tlet dirName = utils.decryptCryptoJSFolderName(folders[i].name, this.state.userMasterKeys, folders[i].uuid)\r\n\r\n\t\t\tif(dirName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\"){\r\n\t\t\t\tshareItems.push({\r\n\t\t\t\t\tuuid: folders[i].uuid,\r\n\t\t\t\t\tparent: (i == 0 ? \"none\" : folders[i].parent),\r\n\t\t\t\t\tmetadata: dirName,\r\n\t\t\t\t\ttype: \"folder\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet itemsShared = 0\r\n\t\tlet erroredItems = 0\r\n\t\tlet isAlreadyShared = false\r\n\r\n\t\tconst shareItemRequest = async (data, tries, maxTries, cb) => {\r\n\t\t\tif(tries >= maxTries){\r\n\t\t\t\treturn cb(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/share\", data)\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\tshareItemRequest(data, (tries + 1), maxTries, cb)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\r\n\t\t\treturn cb(null)\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < shareItems.length; i++){\r\n\t\t\tawait window.customVariables.shareItemSemaphore.acquire()\r\n\r\n\t\t\tlet item = shareItems[i]\r\n\t\t\tlet itemMetadata = \"\"\r\n\r\n\t\t\tif(item.type == \"file\"){\r\n\t\t\t\titemMetadata = JSON.stringify(item.metadata)\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\titemMetadata = JSON.stringify({\r\n\t\t\t\t\tname: item.metadata\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar encrypted = await window.crypto.subtle.encrypt({\r\n\t\t\t\t\tname: \"RSA-OAEP\"\r\n\t\t\t\t}, usrPubKey, new TextEncoder().encode(itemMetadata))\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\twindow.customVariables.shareItemSemaphore.release()\r\n\r\n\t\t\t\treturn callback(e)\r\n\t\t\t}\r\n\r\n\t\t\tshareItemRequest({\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: item.uuid,\r\n\t\t\t\tparent: item.parent,\r\n\t\t\t\temail: email,\r\n\t\t\t\ttype: item.type,\r\n\t\t\t\tmetadata: utils.base64ArrayBuffer(encrypted)\r\n\t\t\t}, 0, 32, (err) => {\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\terroredItems += 1\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.customVariables.shareItemSemaphore.release()\r\n\t\t\t\titemsShared += 1\r\n\r\n\t\t\t\tloading.message = language.get(this.state.lang, \"sharedItemsCount\", true, [\"__SHARED__\", \"__TOTAL__\"], [itemsShared, shareItems.length])\r\n\r\n\t\t\t\tif(itemsShared == shareItems.length){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn callback(null)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport async function shareSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tlet alert = await alertController.create({\r\n        header: language.get(this.state.lang, \"shareItems\"),\r\n        inputs: [\r\n            {\r\n                type: \"text\",\r\n                id: \"share-items-email-input\",\r\n\t\t\t\tname: \"share-items-email-input\",\r\n\t\t\t\tplaceholder: language.get(this.state.lang, \"receiverEmail\")\r\n            }\r\n        ],\r\n        buttons: [\r\n            {\r\n                text: language.get(this.state.lang, \"cancel\"),\r\n                role: \"cancel\",\r\n                handler: () => {\r\n                    return false\r\n                }\r\n            },\r\n            {\r\n                text: language.get(this.state.lang, \"alertOkButton\"),\r\n                handler: async (inputs) => {\r\n\t\t\t\t\tlet email = inputs['share-items-email-input']\r\n\r\n\t\t\t\t\tlet itemsShared = 0\r\n\r\n\t\t\t\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\t\t\t\tlet item = items[i]\r\n\r\n\t\t\t\t\t\tif(item.type == \"folder\" && item.uuid == \"default\"){\r\n\t\t\t\t\t\t\tthis.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tthis.shareItemWithEmail(email, item.uuid, item.type, (err) => {\r\n\t\t\t\t\t\t\t\tif(err){\r\n\t\t\t\t\t\t\t\t\tconsole.log(err)\r\n\t\r\n\t\t\t\t\t\t\t\t\tthis.spawnToast(err.toString())\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t\titemsShared += 1\r\n\t\r\n\t\t\t\t\t\t\t\tif(itemsShared >= items.length){\r\n\t\t\t\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemsShared\", true, [\"__COUNT__\", \"__EMAIL__\"], [items.length, email]))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n                }\r\n            }\r\n        ]\r\n    })\r\n\r\n    await alert.present()\r\n\r\n\tsetTimeout(() => {\r\n\t\ttry{\r\n\t\t\tdocument.querySelector(\"ion-alert input\").focus()\r\n\t\t} catch(e){ }\r\n\t}, 500)\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function shareItem(item){\r\n\tif(item.type == \"folder\" && item.uuid == \"default\"){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"))\r\n\t}\r\n\r\n\tlet alert = await alertController.create({\r\n        header: item.type == \"file\" ? language.get(this.state.lang, \"shareFile\") : language.get(this.state.lang, \"shareFolder\"),\r\n        inputs: [\r\n            {\r\n                type: \"text\",\r\n                id: \"share-item-email-input\",\r\n\t\t\t\tname: \"share-item-email-input\",\r\n\t\t\t\tplaceholder: language.get(this.state.lang, \"receiverEmail\")\r\n            }\r\n        ],\r\n        buttons: [\r\n            {\r\n                text: language.get(this.state.lang, \"cancel\"),\r\n                role: \"cancel\",\r\n                handler: () => {\r\n                    return false\r\n                }\r\n            },\r\n            {\r\n                text: language.get(this.state.lang, \"alertOkButton\"),\r\n                handler: (inputs) => {\r\n\t\t\t\t\tlet email = inputs['share-item-email-input']\r\n\r\n                    this.shareItemWithEmail(email, item.uuid, item.type, (err) => {\r\n\t\t\t\t\t\tif(err){\r\n\t\t\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\t\t\treturn this.spawnToast(err.toString())\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemShared\", true, [\"__NAME__\", \"__WITH__\"], [item.name, email]))\r\n\t\t\t\t\t})\r\n                }\r\n            }\r\n        ]\r\n    })\r\n\r\n    await alert.present()\r\n\r\n\tsetTimeout(() => {\r\n\t\ttry{\r\n\t\t\tdocument.querySelector(\"ion-alert input\").focus()\r\n\t\t} catch(e){ }\r\n\t}, 500)\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function openPublicLinkModal(item){\r\n\tif(item.uuid == \"default\"){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotCreatePublicLinkFolder\"))\r\n\t}\r\n\r\n\tlet loading = await loadingController.create({\r\n\t\tmessage: \"\"\r\n\t})\r\n\r\n\tloading.present()\r\n\r\n\tif(item.type == \"file\"){\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/link/status\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tfileUUID: item.uuid\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tconsole.log(e)\r\n\t\r\n\t\t\tloading.dismiss()\r\n\t\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\t\r\n\t\tif(!res.status){\r\n\t\t\tconsole.log(res.message)\r\n\t\r\n\t\t\tloading.dismiss()\r\n\t\r\n\t\t\treturn this.spawnToast(res.message)\r\n\t\t}\r\n\t\r\n\t\tloading.dismiss()\r\n\t\r\n\t\tlet appLang = this.state.lang\r\n\t\tlet appDarkMode = this.state.darkMode\r\n\t\tlet modalId = \"public-link-modal-\" + utils.generateRandomClassName()\r\n\t\r\n\t\tcustomElements.define(modalId, class ModalContent extends HTMLElement {\r\n\t\t\tconnectedCallback(){\r\n\t\t\t\tthis.innerHTML = `\r\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\r\n\t\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\r\n\t\t\t\t\t\t<div id=\"enable-public-link-content\" ` + (res.data.enabled && `style=\"display: none;\"`) + `>\r\n\t\t\t\t\t\t\t<div style=\"position: absolute; left: 50%; top: 32%; transform: translate(-50%, -50%); width: 100%;\"> \r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t\t\t<ion-icon icon=\"` + Ionicons.link + `\" style=\"font-size: 65pt; color: ` + (appDarkMode ? \"white\" : \"gray\") + `;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t\t<ion-button color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', false)\">` + language.get(appLang, \"enablePublicLink\") + `</ion-button>\t\r\n\t\t\t\t\t\t\t\t</center>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div id=\"public-link-enabled-content\" ` + (!res.data.enabled && `style=\"display: none;\"`) + `>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnabled\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enabled-toggle\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'disable', false)\" checked></ion-toggle>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-input type=\"text\" id=\"public-link-input\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\" value=\"https://filen.io/d/` + res.data.uuid + `#!` + item.key + `\" disabled></ion-input>\r\n\t\t\t\t\t\t\t\t<ion-buttons slot=\"end\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\">\r\n\t\t\t\t\t\t\t\t\t<ion-button fill=\"solid\" color=\"` + (appDarkMode ? `dark` : `light`) + `\">\r\n\t\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"copy\") + `\r\n\t\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\" style=\"margin-top: 30px;\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkExpire\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-select id=\"public-link-expires-select\" value=\"` + (typeof res.data.expirationText == \"string\" ? res.data.expirationText : `never`) + `\" ok-text=\"` + language.get(appLang, \"alertOkButton\") + `\" cancel-text=\"` + language.get(appLang, \"close\") + `\">\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"never\">` + language.get(appLang, \"publicLinkExpiresNever\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1h\">1 ` + language.get(appLang, \"publicLinkExpiresHour\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"6h\">6 ` + language.get(appLang, \"publicLinkExpiresHours\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1d\">1 ` + language.get(appLang, \"publicLinkExpiresDay\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"3d\">3 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"7d\">7 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"14d\">14 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"30d\">30 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t</ion-select>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkPassword\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-input slot=\"end\" id=\"public-link-password-input\" type=\"password\" placeholder=\"` + language.get(appLang, \"publicLinkPasswordPlaceholder\") + `\" ` + (res.data.password !== null ? `value=\"` + res.data.password + `\"` : ``) + `></ion-input>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnableDownloadBtn\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enable-download-btn-toggle\" ` + (res.data.downloadBtn == 1 ? `checked` : ``) + `></ion-toggle>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<section style=\"padding-left: 15px; padding-right: 15px; margin-top: 30px;\">\r\n\t\t\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', true, '` + (typeof res.data.uuid !== \"undefined\" ? res.data.uuid : ``) + `')\">` + language.get(appLang, \"savePublicLink\") + `</ion-button>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t})\r\n\t\r\n\t\tlet modal = await modalController.create({\r\n\t\t\tcomponent: modalId,\r\n\t\t\tswipeToClose: false,\r\n\t\t\tshowBackdrop: false,\r\n\t\t\tbackdropDismiss: false,\r\n\t\t\tcssClass: \"modal-fullscreen\"\r\n\t\t})\r\n\t\r\n\t\treturn modal.present()\r\n\t}\r\n\telse{\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/link/status\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: item.uuid\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tconsole.log(e)\r\n\t\r\n\t\t\tloading.dismiss()\r\n\t\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\t\r\n\t\tif(!res.status){\r\n\t\t\tconsole.log(res.message)\r\n\t\r\n\t\t\tloading.dismiss()\r\n\t\r\n\t\t\treturn this.spawnToast(res.message)\r\n\t\t}\r\n\t\r\n\t\tloading.dismiss()\r\n\t\r\n\t\tlet appLang = this.state.lang\r\n\t\tlet appDarkMode = this.state.darkMode\r\n\t\tlet appUserMasterKeys = this.state.userMasterKeys\r\n\t\tlet modalId = \"public-link-modal-\" + utils.generateRandomClassName()\r\n\t\r\n\t\tcustomElements.define(modalId, class ModalContent extends HTMLElement {\r\n\t\t\tconnectedCallback(){\r\n\t\t\t\tthis.innerHTML = `\r\n\t\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\r\n\t\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\r\n\t\t\t\t\t\t<div id=\"enable-public-link-content\" ` + (res.data.exists && `style=\"display: none;\"`) + `>\r\n\t\t\t\t\t\t\t<div style=\"position: absolute; left: 50%; top: 32%; transform: translate(-50%, -50%); width: 100%;\"> \r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t\t\t<ion-icon icon=\"` + Ionicons.link + `\" style=\"font-size: 65pt; color: ` + (appDarkMode ? \"white\" : \"gray\") + `;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t\t<ion-button color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', false)\">` + language.get(appLang, \"enablePublicLink\") + `</ion-button>\t\r\n\t\t\t\t\t\t\t\t</center>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div id=\"public-link-enabled-content\" ` + (!res.data.exists && `style=\"display: none;\"`) + `>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnabled\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enabled-toggle\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'disable', true, '` + (typeof res.data.uuid !== \"undefined\" ? res.data.uuid : ``) + `')\" checked></ion-toggle>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-input type=\"text\" id=\"public-link-input\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\" value=\"https://filen.io/f/` + res.data.uuid + `#!` + utils.decryptFolderLinkKey(res.data.key, appUserMasterKeys) + `\" disabled></ion-input>\r\n\t\t\t\t\t\t\t\t<ion-buttons slot=\"end\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\">\r\n\t\t\t\t\t\t\t\t\t<ion-button fill=\"solid\" color=\"` + (appDarkMode ? `dark` : `light`) + `\">\r\n\t\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"copy\") + `\r\n\t\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\" style=\"margin-top: 30px;\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkExpire\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-select id=\"public-link-expires-select\" value=\"` + (typeof res.data.expirationText == \"string\" ? res.data.expirationText : `never`) + `\" ok-text=\"` + language.get(appLang, \"alertOkButton\") + `\" cancel-text=\"` + language.get(appLang, \"close\") + `\">\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"never\">` + language.get(appLang, \"publicLinkExpiresNever\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1h\">1 ` + language.get(appLang, \"publicLinkExpiresHour\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"6h\">6 ` + language.get(appLang, \"publicLinkExpiresHours\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"1d\">1 ` + language.get(appLang, \"publicLinkExpiresDay\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"3d\">3 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"7d\">7 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"14d\">14 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t\t<ion-select-option value=\"30d\">30 ` + language.get(appLang, \"publicLinkExpiresDays\") + `</ion-select-option>\r\n\t\t\t\t\t\t\t\t</ion-select>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkPassword\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-input slot=\"end\" id=\"public-link-password-input\" type=\"password\" placeholder=\"` + language.get(appLang, \"publicLinkPasswordPlaceholder\") + `\" ` + (typeof res.data.password !== \"undefined\" ? (res.data.password !== null ? `value=\"` + res.data.password + `\"` : ``) : ``) + `></ion-input>\r\n\t\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t\t<!--<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnableDownloadBtn\") + `\r\n\t\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enable-download-btn-toggle\" ` + (typeof res.data.downloadBtn !== \"undefined\" ? (res.data.downloadBtn == 1 ? `checked` : ``) : ``) + `></ion-toggle>\r\n\t\t\t\t\t\t\t</ion-item>-->\r\n\t\t\t\t\t\t\t<section style=\"padding-left: 15px; padding-right: 15px; margin-top: 30px;\">\r\n\t\t\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable', true, '` + (typeof res.data.uuid !== \"undefined\" ? res.data.uuid : ``) + `')\">` + language.get(appLang, \"savePublicLink\") + `</ion-button>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t})\r\n\t\r\n\t\tlet modal = await modalController.create({\r\n\t\t\tcomponent: modalId,\r\n\t\t\tswipeToClose: false,\r\n\t\t\tshowBackdrop: false,\r\n\t\t\tbackdropDismiss: false,\r\n\t\t\tcssClass: \"modal-fullscreen\"\r\n\t\t})\r\n\t\r\n\t\treturn modal.present()\r\n\t}\r\n}\r\n\r\nexport function makeItemAvailableOffline(offline, item){\r\n\tif(!offline){\r\n\t\tthis.getDownloadDir(true, item.uuid, async (err, dirObj) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"))\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tawait Plugins.Filesystem.rmdir({\r\n\t\t\t\t\tpath: dirObj.path,\r\n\t\t\t\t\tdirectory: dirObj.directory,\r\n\t\t\t\t\trecursive: true\r\n\t\t\t\t})\r\n\r\n\t\t\t\tdelete window.customVariables.offlineSavedFiles[item.uuid]\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotDeleteDownloadedFile\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\r\n\t\t\tlet items = this.state.itemList\r\n\t\t\tlet windowItems = window.customVariables.itemList\r\n\r\n\t\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\t\tif(items[i].uuid == item.uuid){\r\n\t\t\t\t\titems[i].offline = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < windowItems.length; i++){\r\n\t\t\t\tif(windowItems[i].uuid == item.uuid){\r\n\t\t\t\t\twindowItems[i].offline = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\titemList: items\r\n\t\t\t})\r\n\r\n\t\t\twindow.customVariables.itemList = windowItems\r\n\t\t\t\r\n\t\t\tif(typeof window.customVariables.cachedFiles[item.uuid] !== \"undefined\"){\r\n\t\t\t\twindow.customVariables.cachedFiles[item.uuid].offline = false\r\n\t\t\t}\r\n\r\n\t\t\tthis.spawnToast(language.get(this.state.lang, \"fileDeletedFromOfflineStorage\", true, [\"__NAME__\"], [item.name]))\r\n\r\n\t\t\twindow.customFunctions.saveOfflineSavedFiles()\r\n\r\n\t\t\treturn this.forceUpdate()\r\n\t\t})\r\n\t}\r\n\telse{\r\n\t\tlet nItem = item\r\n\r\n\t\tnItem.makeOffline = true\r\n\r\n\t\treturn this.queueFileDownload(nItem)\r\n\t}\r\n}\r\n\r\nexport async function removeSharedInItem(item, showLoader){\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\r\n\t\tloading.present()\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/in/remove\", {\r\n\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\tuuid: item.uuid,\r\n\t\t\treceiverId: 0\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tconsole.log(res.message)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(res.message)\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tloading.dismiss()\r\n\t}\r\n\r\n\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\tthis.updateItemList()\r\n\t}, 500)\r\n\r\n\treturn this.spawnToast(language.get(this.state.lang, \"itemRemovedFromSharedIn\", true, [\"__NAME__\"], [item.name]))\r\n}\r\n\r\nexport async function stopSharingItem(item, showLoader){\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\r\n\t\tloading.present()\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/out/remove\", {\r\n\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\tuuid: item.uuid,\r\n\t\t\treceiverId: item.receiverId\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tconsole.log(res.message)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(res.message)\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tloading.dismiss()\r\n\t}\r\n\r\n\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\tthis.updateItemList()\r\n\t}, 500)\r\n\r\n\treturn this.spawnToast(language.get(this.state.lang, \"itemStoppedSharing\", true, [\"__NAME__\"], [item.name]))\r\n}\r\n\r\nexport async function removeSelectedItemsFromSharedIn(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tthis.removeSharedInItem(item, false)\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function stopSharingSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tthis.stopSharingItem(item, false)\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function downloadSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\tthis.queueFileDownload(item)\r\n\t\t}\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function storeSelectedItemsOffline(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\titem.makeOffline = true\r\n\r\n\t\t\tthis.queueFileDownload(item)\r\n\t\t}\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function colorItem(item){\r\n\tif(item.uuid == \"default\"){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"thisFolderCannotBeColored\")) \r\n\t}\r\n\r\n\tlet appLang = this.state.lang\r\n\tlet appDarkMode = this.state.darkMode\r\n\tlet modalId = \"color-item-modal-\" + utils.generateRandomClassName()\r\n\r\n\tcustomElements.define(modalId, class ModalContent extends HTMLElement {\r\n\t\tconnectedCallback(){\r\n\t\t\tthis.innerHTML = `\r\n\t\t\t\t<ion-header style=\"margin-top: ` + (isPlatform(\"ipad\") ? safeAreaInsets.top : 0) + `px;\">\r\n\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t` + language.get(appLang, \"colorItemLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\r\n\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t</ion-header>\r\n\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\r\n\t\t\t\t\t<section style=\"padding: 15px;\">\r\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'default')\" style=\"--background: #F6C358;\">` + language.get(appLang, \"colorItemDefault\") + `</ion-button>\r\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'blue')\" style=\"--background: #2992E5; margin-top: 10px;\">` + language.get(appLang, \"colorItemBlue\") + `</ion-button>\r\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'green')\" style=\"--background: #57A15B; margin-top: 10px;\">` + language.get(appLang, \"colorItemGreen\") + `</ion-button>\r\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'purple')\" style=\"--background: #8E3A9D; margin-top: 10px;\">` + language.get(appLang, \"colorItemPurple\") + `</ion-button>\r\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'red')\" style=\"--background: #CB2E35; margin-top: 10px;\">` + language.get(appLang, \"colorItemRed\") + `</ion-button>\r\n\t\t\t\t\t\t<ion-button expand=\"block\" size=\"small\" onClick=\"window.customFunctions.changeItemColor('` + window.btoa(JSON.stringify(item)) + `', 'gray')\" style=\"--background: gray; margin-top: 10px;\">` + language.get(appLang, \"colorItemGray\") + `</ion-button>\r\n\t\t\t\t\t</section>\r\n\t\t\t\t</ion-content>\r\n\t\t\t`\r\n\t\t}\r\n\t})\r\n\r\n\tlet modal = await modalController.create({\r\n\t\tcomponent: modalId,\r\n\t\tswipeToClose: false,\r\n\t\tshowBackdrop: false,\r\n\t\tbackdropDismiss: false,\r\n\t\tcssClass: \"modal-fullscreen\"\r\n\t})\r\n\r\n\treturn modal.present()\r\n}\r\n\r\nexport async function spawnItemActionSheet(item){\r\n\tlet buttons = undefined\r\n\r\n\tif(item.type == \"folder\"){\r\n\t\tif(window.location.href.indexOf(\"shared-in\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"removeFromShared\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.removeSharedInItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"shared-out\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"stopSharing\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.stopSharingItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"trash\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"restoreItem\"),\r\n\t\t\t\t\ticon: Ionicons.bagAdd,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.restoreItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"links\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"itemPublicLink\"),\r\n\t\t\t\t\ticon: Ionicons.link,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.openPublicLinkModal(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse{\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"shareItem\"),\r\n\t\t\t\t\ticon: Ionicons.shareSocial,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.shareItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"itemPublicLink\"),\r\n\t\t\t\t\ticon: Ionicons.link,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.openPublicLinkModal(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"moveItem\"),\r\n\t\t\t\t\ticon: Ionicons.move,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.moveItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"renameItem\"),\r\n\t\t\t\t\ticon: Ionicons.text,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.renameItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"colorItem\"),\r\n\t\t\t\t\ticon: Ionicons.colorFill,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.colorItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"trashItem\"),\r\n\t\t\t\t\ticon: Ionicons.trash,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.trashItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t}\r\n\telse{\r\n\t\tif(window.location.href.indexOf(\"shared-in\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\r\n\t\t\t\t\ticon: Ionicons.save,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\tif(item.offline){\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(false, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(true, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"removeFromShared\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.removeSharedInItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"shared-out\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\r\n\t\t\t\t\ticon: Ionicons.save,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\tif(item.offline){\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(false, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(true, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"stopSharing\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.stopSharingItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"trash\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"restoreItem\"),\r\n\t\t\t\t\ticon: Ionicons.bagAdd,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.restoreItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"links\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"itemPublicLink\"),\r\n\t\t\t\t\ticon: Ionicons.link,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.openPublicLinkModal(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\r\n\t\t\t\t\ticon: Ionicons.save,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\tif(item.offline){\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(false, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(true, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse{\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"shareItem\"),\r\n\t\t\t\t\ticon: Ionicons.shareSocial,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.shareItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"itemPublicLink\"),\r\n\t\t\t\t\ticon: Ionicons.link,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.openPublicLinkModal(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\r\n\t\t\t\t\ticon: Ionicons.save,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\tif(item.offline){\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(false, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(true, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"moveItem\"),\r\n\t\t\t\t\ticon: Ionicons.move,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.moveItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"renameItem\"),\r\n\t\t\t\t\ticon: Ionicons.text,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.renameItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"trashItem\"),\r\n\t\t\t\t\ticon: Ionicons.trash,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.trashItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t}\r\n\r\n\tlet headerName = item.name\r\n\r\n\tif(headerName.length >= 32){\r\n\t\theaderName = headerName.substring(0, 32) + \"...\"\r\n\t}\r\n\r\n    let actionSheet = await actionSheetController.create({\r\n        header: headerName,\r\n        buttons\r\n    })\r\n\r\n\tawait actionSheet.present()\r\n\t\r\n\tif(Capacitor.isNative){\r\n\t\tsetTimeout(() => {\r\n\t\t\tCapacitor.Plugins.Keyboard.hide()\r\n\t\t}, 500)\r\n\t}\r\n\r\n\treturn true\r\n}"]},"metadata":{},"sourceType":"module"}