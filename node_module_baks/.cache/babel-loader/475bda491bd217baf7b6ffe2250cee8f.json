{"ast":null,"code":"import * as language from \"../utils/language\";\nimport { loadingController, modalController, popoverController, alertController, actionSheetController } from \"@ionic/core\";\nimport * as Ionicons from 'ionicons/icons';\nimport { Capacitor, HapticsImpactStyle, Plugins } from \"@capacitor/core\";\nimport { FileOpener } from \"@ionic-native/file-opener\";\n\nconst utils = require(\"../utils/utils\");\n\nexport async function updateItemList() {\n  if (!this.state.isLoggedIn) {\n    return this.showLogin();\n  }\n\n  if (this.state.userAPIKey.length <= 16) {\n    return this.showLogin();\n  }\n\n  if (Capacitor.isNative) {\n    Capacitor.Plugins.Keyboard.hide();\n    Plugins.SplashScreen.hide();\n  }\n\n  this.setState({\n    searchbarOpen: false,\n    mainSearchTerm: \"\"\n  });\n  let routeEx = window.location.hash.split(\"/\");\n  let parent = routeEx[routeEx.length - 1];\n  let loading = await loadingController.create({\n    message: \"\"\n  });\n  loading.present();\n  window.customVariables.currentThumbnailURL = window.location.href;\n  let items = [];\n\n  if (parent == \"base\") {\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/user/baseFolders\", {\n        apiKey: this.state.userAPIKey\n      });\n    } catch (e) {\n      console.log(e);\n      window.customFunctions.dismissLoader();\n      let alert = await alertController.create({\n        header: \"\",\n        subHeader: \"\",\n        message: language.get(this.state.lang, \"apiRequestError\"),\n        buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n      });\n      return alert.present();\n    }\n\n    if (!res.status) {\n      console.log(res.message);\n      window.customFunctions.dismissLoader();\n      let alert = await alertController.create({\n        header: \"\",\n        subHeader: \"\",\n        message: language.get(this.state.lang, \"apiRequestError\"),\n        buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n      });\n      return alert.present();\n    }\n\n    items.push({\n      type: \"folder\",\n      uuid: \"default\",\n      name: \"Default\",\n      date: language.get(this.state.lang, \"defaultFolder\"),\n      timestamp: +new Date() / 1000 - 86400 * 3650,\n      parent: \"base\",\n      receiverId: 0,\n      receiverEmail: \"\",\n      sharerId: 0,\n      sharerEmail: \"\"\n    });\n\n    for (let i = 0; i < res.data.folders.length; i++) {\n      let folder = res.data.folders[i];\n      let folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid);\n      let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n      let item = {\n        type: \"folder\",\n        uuid: folder.uuid,\n        name: utils.sanitizeHTML(folderName),\n        date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n        timestamp: folder.timestamp,\n        parent: \"base\",\n        receiverId: 0,\n        receiverEmail: \"\",\n        sharerId: 0,\n        sharerEmail: \"\"\n      };\n      items.push(item);\n      window.customVariables.cachedFolders[folder.uuid] = item;\n    }\n\n    let iItems = [];\n    iItems.push(items[0]);\n\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].name.toLowerCase() == \"filen sync\" && items[i].uuid !== \"default\") {\n        iItems.push(items[i]);\n      }\n    }\n\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].name.toLowerCase() !== \"filen sync\" && items[i].uuid !== \"default\") {\n        iItems.push(items[i]);\n      }\n    }\n\n    items = iItems;\n  } else {\n    if (routeEx[1] == \"shared-in\") {\n      try {\n        var usrPrivKey = await window.crypto.subtle.importKey(\"pkcs8\", utils._base64ToArrayBuffer(this.state.userPrivateKey), {\n          name: \"RSA-OAEP\",\n          hash: \"SHA-512\"\n        }, true, [\"decrypt\"]);\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"unknownDeviceError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/in\", {\n          apiKey: this.state.userAPIKey,\n          uuid: parent,\n          folders: JSON.stringify([\"shred-in\"]),\n          page: 1,\n          app: \"true\"\n        });\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      if (!res.status) {\n        console.log(res.message);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      for (let i = 0; i < res.data.folders.length; i++) {\n        let folder = res.data.folders[i];\n        let folderName = await utils.decryptFolderNamePrivateKey(folder.metadata, usrPrivKey, folder.uuid);\n        let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n        let item = {\n          type: \"folder\",\n          uuid: folder.uuid,\n          name: utils.sanitizeHTML(folderName),\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: folder.timestamp,\n          parent: folder.parent,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: folder.sharerId,\n          sharerEmail: folder.sharerEmail\n        };\n        items.push(item);\n        window.customVariables.cachedFolders[folder.uuid] = item;\n      }\n\n      for (let i = 0; i < res.data.uploads.length; i++) {\n        let file = res.data.uploads[i];\n        let decryptedMetadata = await utils.decryptFileMetadataPrivateKey(file.metadata, usrPrivKey, file.uuid);\n        let uploadDate = new Date(file.timestamp * 1000).toString().split(\" \");\n        let offline = false;\n\n        if (typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\") {\n          offline = true;\n        }\n\n        let item = {\n          type: \"file\",\n          uuid: file.uuid,\n          name: utils.sanitizeHTML(decryptedMetadata.name),\n          mime: utils.sanitizeHTML(decryptedMetadata.mime),\n          size: parseInt(decryptedMetadata.size),\n          key: utils.sanitizeHTML(decryptedMetadata.key),\n          bucket: file.bucket,\n          region: file.region,\n          parent: file.parent,\n          rm: file.rm,\n          chunks: file.chunks,\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: file.timestamp,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: file.sharerId,\n          sharerEmail: file.sharerEmail,\n          offline: offline,\n          thumbnail: typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined\n        };\n        items.push(item);\n        window.customVariables.cachedFiles[file.uuid] = item;\n      }\n    } else if (routeEx[1] == \"shared-out\") {\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/out\", {\n          apiKey: this.state.userAPIKey,\n          uuid: parent,\n          folders: JSON.stringify([\"default\"]),\n          page: 1,\n          app: \"true\",\n          receiverId: this.state.currentReceiverId\n        });\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      if (!res.status) {\n        console.log(res.message);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      for (let i = 0; i < res.data.folders.length; i++) {\n        let folder = res.data.folders[i];\n        let folderName = utils.decryptCryptoJSFolderName(folder.metadata, this.state.userMasterKeys, folder.uuid);\n        let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n        let item = {\n          type: \"folder\",\n          uuid: folder.uuid,\n          name: utils.sanitizeHTML(folderName),\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: folder.timestamp,\n          parent: folder.parent,\n          receiverId: folder.receiverId,\n          receiverEmail: folder.receiverEmail,\n          sharerId: 0,\n          sharerEmail: \"\"\n        };\n        items.push(item);\n        window.customVariables.cachedFolders[folder.uuid] = item;\n      }\n\n      for (let i = 0; i < res.data.uploads.length; i++) {\n        let file = res.data.uploads[i];\n        let metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid);\n        let uploadDate = new Date(file.timestamp * 1000).toString().split(\" \");\n        let offline = false;\n\n        if (typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\") {\n          offline = true;\n        }\n\n        let item = {\n          type: \"file\",\n          uuid: file.uuid,\n          name: utils.sanitizeHTML(metadata.name),\n          mime: utils.sanitizeHTML(metadata.mime),\n          size: parseInt(metadata.size),\n          key: utils.sanitizeHTML(metadata.key),\n          bucket: file.bucket,\n          region: file.region,\n          parent: file.parent,\n          rm: file.rm,\n          chunks: file.chunks,\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: file.timestamp,\n          receiverId: file.receiverId,\n          receiverEmail: file.receiverEmail,\n          sharerId: 0,\n          sharerEmail: \"\",\n          offline: offline,\n          thumbnail: typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined\n        };\n        items.push(item);\n        window.customVariables.cachedFiles[file.uuid] = item;\n      }\n    } else {\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/dir/content\", {\n          apiKey: this.state.userAPIKey,\n          uuid: parent,\n          folders: JSON.stringify([\"default\"]),\n          page: 1,\n          app: \"true\"\n        });\n      } catch (e) {\n        console.log(e);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      if (!res.status) {\n        console.log(res.message);\n        window.customFunctions.dismissLoader();\n        let alert = await alertController.create({\n          header: \"\",\n          subHeader: \"\",\n          message: language.get(this.state.lang, \"apiRequestError\"),\n          buttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\n        });\n        return alert.present();\n      }\n\n      for (let i = 0; i < res.data.folders.length; i++) {\n        let folder = res.data.folders[i];\n        let folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid);\n        let uploadDate = new Date(folder.timestamp * 1000).toString().split(\" \");\n        let item = {\n          type: \"folder\",\n          uuid: folder.uuid,\n          name: utils.sanitizeHTML(folderName),\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: folder.timestamp,\n          parent: folder.parent,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: 0,\n          sharerEmail: \"\"\n        };\n        items.push(item);\n        window.customVariables.cachedFolders[folder.uuid] = item;\n      }\n\n      for (let i = 0; i < res.data.uploads.length; i++) {\n        let file = res.data.uploads[i];\n        let metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid);\n        let uploadDate = new Date(file.timestamp * 1000).toString().split(\" \");\n        let offline = false;\n\n        if (typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\") {\n          offline = true;\n        }\n\n        let item = {\n          type: \"file\",\n          uuid: file.uuid,\n          name: utils.sanitizeHTML(metadata.name),\n          mime: utils.sanitizeHTML(metadata.mime),\n          size: parseInt(metadata.size),\n          key: utils.sanitizeHTML(metadata.key),\n          bucket: file.bucket,\n          region: file.region,\n          parent: file.parent,\n          rm: file.rm,\n          chunks: file.chunks,\n          date: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\n          timestamp: file.timestamp,\n          receiverId: 0,\n          receiverEmail: \"\",\n          sharerId: 0,\n          sharerEmail: \"\",\n          offline: offline,\n          thumbnail: typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined\n        };\n        items.push(item);\n        window.customVariables.cachedFiles[file.uuid] = item;\n      }\n    }\n  }\n\n  items = utils.orderItemsByType(items, window.customVariables.orderBy);\n  window.customVariables.itemList = items;\n  let scrollTo = 0;\n\n  if (typeof window.customVariables.scrollToIndex[parent] !== \"undefined\") {\n    scrollTo = window.customVariables.scrollToIndex[parent];\n    delete window.customVariables.scrollToIndex[parent];\n  }\n\n  return this.setState({\n    itemList: items,\n    scrollToIndex: scrollTo\n  }, () => {\n    loading.dismiss();\n    this.forceUpdate();\n    window.customVariables.currentThumbnailURL = window.location.href;\n\n    for (let i = 0; i < items.length; i++) {\n      this.getFileThumbnail(items[i], window.customVariables.currentThumbnailURL, i);\n    }\n\n    window.customFunctions.saveCachedItems();\n    window.customFunctions.saveThumbnailCache();\n  });\n}\nexport function getFileThumbnail(file, thumbURL, index) {\n  if (file.type !== \"file\" || file.name.indexOf(\".\") == -1 || typeof file.thumbnail !== \"undefined\") {\n    return false;\n  }\n\n  if (typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\") {\n    if (window.customVariables.getThumbnailErrors[file.uuid] >= 16) {\n      return false;\n    }\n  }\n\n  let intervalTimer = utils.getRandomArbitrary(10, 50);\n\n  if (document.getElementById(\"item-thumbnail-\" + file.uuid) !== null) {\n    intervalTimer = 1;\n  }\n\n  let onScreenInterval = setInterval(async () => {\n    if (thumbURL !== window.location.href) {\n      return clearInterval(onScreenInterval);\n    } else {\n      if (document.getElementById(\"item-thumbnail-\" + file.uuid) !== null) {\n        clearInterval(onScreenInterval);\n        let ext = file.name.split(\".\");\n        ext = ext[ext.length - 1];\n        let thumbnail = undefined;\n\n        if (utils.canShowThumbnail(ext)) {\n          try {\n            thumbnail = await this.getThumbnail(file, thumbURL, ext);\n          } catch (e) {\n            console.log(e);\n\n            if (e.indexOf(\"url changed\") == -1) {\n              if (typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\") {\n                window.customVariables.getThumbnailErrors[file.uuid] = window.customVariables.getThumbnailErrors[file.uuid] + 1;\n              } else {\n                window.customVariables.getThumbnailErrors[file.uuid] = 1;\n              }\n\n              window.customFunctions.saveGetThumbnailErrors();\n            }\n\n            return false;\n          }\n        } else {\n          return false;\n        }\n\n        if (typeof thumbnail !== \"undefined\") {\n          await window.customVariables.updateItemsSemaphore.acquire();\n          let newItems = this.state.itemList;\n\n          for (let i = 0; i < newItems.length; i++) {\n            if (newItems[i].uuid == file.uuid) {\n              newItems[i].thumbnail = thumbnail;\n            }\n          }\n\n          window.customVariables.itemList = newItems;\n\n          if (thumbURL == window.location.href) {\n            return this.setState({\n              itemList: newItems\n            }, () => {\n              this.forceUpdate();\n              window.customVariables.updateItemsSemaphore.release();\n            });\n          } else {\n            window.customVariables.updateItemsSemaphore.release();\n            return false;\n          }\n        } else {\n          return false;\n        }\n      }\n    }\n  }, intervalTimer);\n}\nexport async function refreshMainList(event) {\n  await this.updateItemList();\n  return event.detail.complete();\n}\nexport function selectItem(type, index) {\n  let items = this.state.itemList;\n  let selectedItems = this.state.selectedItems;\n\n  if (type) {\n    if (!items[index].selected) {\n      items[index].selected = type;\n      selectedItems = selectedItems + 1;\n    }\n\n    if (selectedItems == 1 && Capacitor.isNative) {\n      Plugins.Haptics.impact(HapticsImpactStyle.Light);\n    }\n  } else {\n    if (items[index].selected) {\n      items[index].selected = type;\n      selectedItems = selectedItems - 1;\n    }\n  }\n\n  return this.setState({\n    itemList: items,\n    selectedItems\n  });\n}\nexport function clearSelectedItems() {\n  let items = this.state.itemList;\n\n  for (let i = 0; i < items.length; i++) {\n    items[i].selected = false;\n  }\n\n  return this.setState({\n    itemList: items,\n    selectedItems: 0\n  });\n}\nexport async function selectItemsAction(event) {\n  event.persist();\n  let appLang = this.state.lang;\n  let customElementId = utils.generateRandomClassName();\n  let selectedItemsDoesNotContainFolder = utils.selectedItemsDoesNotContainFolder(this.state.itemList);\n  let inner = \"\";\n\n  if (window.location.href.indexOf(\"shared-in\") !== -1) {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.removeSelectedItemsFromSharedIn()\">` + language.get(appLang, \"removeFromShared\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  } else if (window.location.href.indexOf(\"shared-out\") !== -1) {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.stopSharingSelectedItems()\">` + language.get(appLang, \"stopSharing\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  } else if (window.location.href.indexOf(\"trash\") !== -1) {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.restoreSelectedItems()\">` + language.get(appLang, \"restoreItem\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  } else {\n    inner = `\n\t\t\t<ion-list>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\n\t\t\t\t` + (selectedItemsDoesNotContainFolder ? `<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.storeSelectedItemsOffline()\">` + language.get(appLang, \"storeSelectedItemsOffline\") + `</ion-item>` : ``) + `\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.moveSelectedItems()\">` + language.get(appLang, \"moveItem\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.trashSelectedItems()\">` + language.get(appLang, \"trashItem\") + `</ion-item>\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\n\t\t\t</ion-list>\n\t\t`;\n  }\n\n  window.customElements.define(customElementId, class ModalContent extends HTMLElement {\n    connectedCallback() {\n      this.innerHTML = inner;\n    }\n\n  });\n  let popover = await popoverController.create({\n    component: customElementId,\n    event: event\n  });\n  return popover.present();\n}\nexport async function previewItem(item, lastModalPreviewType = undefined) {\n  if (item.type !== \"file\") {\n    return false;\n  }\n\n  if (Capacitor.isNative && typeof lastModalPreviewType == \"undefined\") {\n    if (this.state.settings.onlyWifi) {\n      let networkStatus = await Plugins.Network.getStatus();\n\n      if (networkStatus.connectionType !== \"wifi\") {\n        return this.spawnToast(language.get(this.state.lang, \"onlyWifiError\"));\n      }\n    }\n  }\n\n  if (typeof window.customVariables.offlineSavedFiles[item.uuid] !== \"undefined\" && typeof lastModalPreviewType == \"undefined\") {\n    this.getDownloadDir(true, item.uuid, (err, dirObj) => {\n      if (err) {\n        console.log(err);\n        return this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"));\n      }\n\n      FileOpener.open(dirObj.uri.uri + \"/\" + item.name, item.mime).then(() => {\n        console.log(dirObj.uri.uri + \"/\" + item.name, item.mime);\n      }).catch(err => {\n        console.log(err);\n        console.log(dirObj.uri.uri + \"/\" + item.name, item.mime);\n        return this.spawnToast(language.get(this.state.lang, \"noAppFoundToOpenFile\", true, [\"__NAME__\"], [item.name]));\n      });\n    });\n  } else {\n    let nameEx = item.name.split(\".\");\n    let previewType = utils.getFilePreviewType(nameEx[nameEx.length - 1]);\n\n    if (previewType == \"none\") {\n      if (typeof lastModalPreviewType !== \"undefined\") {\n        window.customFunctions.dismissModal();\n      }\n\n      return this.spawnItemActionSheet(item);\n    }\n\n    if (item.size > 1024 * 1024 * 64) {\n      if (typeof lastModalPreviewType !== \"undefined\") {\n        window.customFunctions.dismissModal();\n      }\n\n      return this.spawnItemActionSheet(item);\n    }\n\n    const gotPreviewData = async dataArray => {\n      let blob = new Blob([dataArray], {\n        type: item.mime,\n        name: item.name\n      });\n\n      if (typeof window.customVariables.currentPreviewURL !== \"undefined\") {\n        window.customVariables.urlCreator.revokeObjectURL(window.customVariables.currentPreviewURL);\n      }\n\n      window.customVariables.currentPreviewURL = window.customVariables.urlCreator.createObjectURL(blob);\n      let previewModalContent = ``;\n\n      if (previewType == \"image\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow preview-header-hidden\" style=\"position: absolute; display: none;\" onClick=\"window.customFunctions.togglePreviewHeader(true)\">\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\n\t\t\t\t\t\t\t<ion-slide>\n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t\t<img id=\"preview-img\" src=\"` + window.customVariables.currentPreviewURL + `\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh;\">\n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t</ion-slide>\n\t\t\t\t\t\t</ion-slides>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"video\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute;\">\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\n\t\t\t\t\t\t\t<ion-slide>\n\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t\t<video id=\"preview-video\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh; margin-top: 56px;\" src=\"` + window.customVariables.currentPreviewURL + `\" autoplay preload controls></video>\n\t\t\t\t\t\t\t\t</center>\n\t\t\t\t\t\t\t</ion-slide>\n\t\t\t\t\t\t</ion-slides>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"audio\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute;\">\n\t\t\t\t\t\t<ion-toolbar style=\"--background: transparent; color: white;\">\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\n\t\t\t\t\t\t\t<ion-slide>\n\t\t\t\t\t\t\t\t<audio autoplay preload controls>\n\t\t\t\t\t\t\t\t\t<source src=\"` + window.customVariables.currentPreviewURL + `\" type=\"audio/mpeg\">\n\t\t\t\t\t\t\t\t</audio>\n\t\t\t\t\t\t\t</ion-slide>\n\t\t\t\t\t\t</ion-slides>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"code\" || previewType == \"text\") {\n        let text = new TextDecoder().decode(dataArray).split(\"<\").join(\"&lt;\");\n        previewModalContent = `\n\t\t\t\t\t<ion-header>\n\t\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content fullscreen style=\"-webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">\n\t\t\t\t\t\t<pre style=\"width: 100vw; height: 100%; margin-top: 0px; padding: 10px; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">` + text + `</pre>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      } else if (previewType == \"pdf\") {\n        previewModalContent = `\n\t\t\t\t\t<ion-header>\n\t\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t\t` + item.name + `\n\t\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\n\t\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t</ion-toolbar>\n\t\t\t\t\t</ion-header>\n\t\t\t\t\t<ion-content fullscreen>\n\t\t\t\t\t\t<div id=\"pdf-viewer\" style=\"width: 100%; height: 100%; overflow: scroll;\"></div>\n\t\t\t\t\t</ion-content>\n\t\t\t\t`;\n      }\n\n      if (previewModalContent.length <= 8) {\n        if (typeof lastModalPreviewType !== \"undefined\") {\n          window.customFunctions.dismissModal();\n        }\n\n        return this.spawnItemActionSheet(item);\n      }\n\n      const setupBars = async () => {\n        if (previewType == \"image\" || previewType == \"video\" || previewType == \"audio\") {\n          this.setupStatusbar(\"image/video\");\n\n          try {\n            let modal = await modalController.getTop();\n            modal.onDidDismiss().then(() => {\n              this.setupStatusbar();\n            });\n          } catch (e) {\n            console.log(e);\n          }\n        }\n      };\n\n      const setupSlider = lastPreviewType => {\n        let slider = document.getElementById(\"slider\");\n\n        if (slider == null) {\n          return false;\n        }\n\n        let itemList = this.state.itemList;\n\n        const getPrevOrNextItem = type => {\n          let step = 1;\n          let max = 128;\n          let tries = 0;\n\n          const getItemRecursive = type => {\n            if (tries > max) {\n              return undefined;\n            }\n\n            tries += 1;\n\n            for (let i = 0; i < itemList.length; i++) {\n              if (itemList[i].uuid == item.uuid) {\n                let item = undefined;\n                let listIndex = undefined;\n\n                if (type == \"prev\") {\n                  listIndex = i - step;\n                  item = itemList[listIndex];\n                } else {\n                  listIndex = i + step;\n                  item = itemList[listIndex];\n                }\n\n                if (typeof item == \"undefined\") {\n                  step += 1;\n                  return getItemRecursive(type);\n                } else {\n                  let thisNameEx = item.name.split(\".\");\n                  let thisPreviewType = utils.getFilePreviewType(thisNameEx[thisNameEx.length - 1]);\n\n                  if (thisPreviewType == lastPreviewType) {\n                    return {\n                      item,\n                      listIndex\n                    };\n                  } else {\n                    step += 1;\n                    return getItemRecursive(type);\n                  }\n                }\n              }\n            }\n          };\n\n          return getItemRecursive(type);\n        };\n\n        slider.options = {\n          freeMode: false\n        };\n        let offset = 75;\n        let offsetY = 150;\n        let xDown, yDown;\n        slider.addEventListener(\"touchstart\", e => {\n          let firstTouch = getTouch(e);\n          xDown = firstTouch.clientX;\n          yDown = firstTouch.clientY;\n        });\n        slider.addEventListener(\"touchend\", e => {\n          if (!xDown || !yDown) {\n            return false;\n          }\n\n          let {\n            clientX: xUp,\n            clientY: yUp\n          } = getTouch(e);\n          let xDiff = xDown - xUp;\n          let yDiff = yDown - yUp;\n          let xDiffAbs = Math.abs(xDown - xUp);\n          let yDiffAbs = Math.abs(yDown - yUp);\n\n          if (Math.max(xDiffAbs, yDiffAbs) < offset) {\n            return false;\n          }\n\n          if (xDiffAbs > yDiffAbs) {\n            if (xDiff > 0) {\n              let nextItem = getPrevOrNextItem(\"next\");\n\n              if (typeof nextItem == \"undefined\") {\n                return false;\n              }\n\n              this.setState({\n                scrollToIndex: nextItem.listIndex\n              });\n              return this.previewItem(nextItem.item, lastPreviewType);\n            } else {\n              let prevItem = getPrevOrNextItem(\"prev\");\n\n              if (typeof prevItem == \"undefined\") {\n                return false;\n              }\n\n              this.setState({\n                scrollToIndex: prevItem.listIndex\n              });\n              return this.previewItem(prevItem.item, lastPreviewType);\n            }\n          } else {\n            if (xDiffAbs < yDiffAbs && Math.max(xDiffAbs, yDiffAbs) > offsetY) {\n              window.customFunctions.dismissModal();\n            }\n          }\n\n          return false;\n        });\n\n        const getTouch = e => {\n          return e.changedTouches[0];\n        };\n      };\n\n      const loadPdf = async () => {\n        let canvasContainer = document.getElementById(\"pdf-viewer\");\n\n        if (typeof window.pdfjsLib == \"undefined\") {\n          return window.customFunctions.dismissModal();\n        }\n\n        window.pdfjsLib.GlobalWorkerOptions.workerSrc = \"assets/pdf/build/pdf.worker.js\";\n        let loader = await loadingController.create({\n          message: \"\"\n        });\n        loader.present();\n\n        function renderPage(page) {\n          let viewport = page.getViewport({\n            scale: 2\n          });\n          let canvas = document.createElement('canvas');\n          let ctx = canvas.getContext('2d');\n          let renderContext = {\n            canvasContext: ctx,\n            viewport: viewport\n          };\n          canvas.height = viewport.height;\n          canvas.width = viewport.width;\n          canvasContainer.appendChild(canvas);\n          page.render(renderContext);\n        }\n\n        function renderPages(pdfDoc) {\n          if (typeof loader !== \"undefined\") {\n            loader.dismiss();\n          }\n\n          for (let i = 1; i <= pdfDoc.numPages; i++) {\n            pdfDoc.getPage(i).then(renderPage);\n          }\n        }\n\n        let loadingTask = window.pdfjsLib.getDocument({\n          data: dataArray\n        });\n        loadingTask.promise.then(renderPages).catch(err => {\n          console.log(err);\n          return window.customFunctions.dismissModal();\n        });\n      };\n\n      if (typeof lastModalPreviewType !== \"undefined\") {\n        try {\n          var currentModal = document.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0];\n        } catch (e) {\n          window.customFunctions.dismissModal();\n          return this.spawnItemActionSheet(item);\n        }\n\n        currentModal.innerHTML = previewModalContent;\n\n        if (previewType == \"pdf\") {\n          loadPdf();\n        }\n\n        setupBars();\n        setupSlider(previewType);\n        return true;\n      } else {\n        let modalId = \"preview-modal-\" + utils.generateRandomClassName();\n        customElements.define(modalId, class ModalContent extends HTMLElement {\n          connectedCallback() {\n            this.innerHTML = previewModalContent;\n          }\n\n        });\n        var modal = await modalController.create({\n          component: modalId,\n          swipeToClose: true,\n          showBackdrop: false,\n          backdropDismiss: false,\n          cssClass: \"modal-fullscreen\"\n        });\n        await modal.present();\n\n        if (Capacitor.isNative) {\n          Capacitor.Plugins.Keyboard.hide();\n        }\n\n        if (previewType == \"image\" || previewType == \"video\" || previewType == \"audio\") {\n          try {\n            document.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0].style.backgroundColor = \"black\";\n          } catch (e) {\n            console.log(e);\n          }\n        }\n\n        if (previewType == \"pdf\") {\n          loadPdf();\n        }\n\n        setupBars();\n        setupSlider(previewType);\n        return true;\n      }\n    };\n\n    let loading = await loadingController.create({\n      message: \"\" //language.get(this.state.lang, \"loadingPreview\")\n\n    });\n    loading.present();\n    this.downloadPreview(item, chunksDone => {//console.log(chunksDone)\n    }, (err, dataArray) => {\n      loading.dismiss();\n\n      if (err) {\n        console.log(err);\n        return this.spawnToast(language.get(this.state.lang, \"fileNoPreviewAvailable\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      return gotPreviewData(dataArray);\n    });\n  }\n}\nexport async function dirExists(name, parent, callback) {\n  if (parent == null) {\n    parent = \"base\";\n  }\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/dir/exists\", {\n      apiKey: this.state.userAPIKey,\n      parent,\n      nameHashed: utils.hashFn(name.toLowerCase())\n    });\n  } catch (e) {\n    return callback(e);\n  }\n\n  if (!res.status) {\n    return callback(res.message);\n  }\n\n  return callback(null, res.data.exists, res.data.uuid);\n}\nexport async function moveFolder(folder, destination, showLoader) {\n  if (folder.parent == destination) {\n    return this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"));\n  }\n\n  if (utils.currentParentFolder() == \"base\") {\n    if (folder.uuid == \"default\" || folder.name.toLowerCase() == \"filen sync\") {\n      return this.spawnToast(language.get(this.state.lang, \"thisFolderCannotBeMoved\"));\n    }\n  }\n\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  this.dirExists(folder.name, destination, async (err, exists, existsUUID) => {\n    if (err) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (exists) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"folderMoveAlreadyExistsHere\", true, [\"__NAME__\"], [folder.name]));\n    }\n\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/dir/move\", {\n        apiKey: this.state.userAPIKey,\n        uuid: folder.uuid,\n        folderUUID: destination\n      });\n    } catch (e) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    if (!res.status) {\n      return this.spawnToast(res.message);\n    }\n\n    utils.checkIfItemParentIsBeingShared(destination, \"folder\", {\n      name: folder.name\n    }, () => {\n      this.spawnToast(language.get(this.state.lang, \"folderMoved\", true, [\"__NAME__\"], [folder.name]));\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        if (utils.currentParentFolder() == destination) {\n          this.updateItemList();\n        }\n      }, 500);\n      return true;\n    });\n  });\n}\nexport async function moveFile(file, destination, showLoader) {\n  if (file.parent == destination) {\n    return this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"));\n  }\n\n  if (destination == \"trash\" || destination == \"base\" || destination == \"shared-in\" || destination == \"shared-out\") {\n    return this.spawnToast(language.get(this.state.lang, \"cannotMoveFileHere\"));\n  }\n\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  this.fileExists(file.name, destination, async (err, exists, existsUUID) => {\n    if (err) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (exists) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"fileMoveAlreadyExistsHere\", true, [\"__NAME__\"], [file.name]));\n    }\n\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/file/move\", {\n        apiKey: this.state.userAPIKey,\n        fileUUID: file.uuid,\n        folderUUID: destination\n      });\n    } catch (e) {\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n    }\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    if (!res.status) {\n      return this.spawnToast(res.message);\n    }\n\n    utils.checkIfItemParentIsBeingShared(destination, \"file\", {\n      uuid: file.uuid,\n      name: file.name,\n      size: parseInt(file.size),\n      mime: file.mime,\n      key: file.key\n    }, () => {\n      this.spawnToast(language.get(this.state.lang, \"fileMoved\", true, [\"__NAME__\"], [file.name]));\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        if (utils.currentParentFolder() == destination) {\n          this.updateItemList();\n        }\n      }, 500);\n      return true;\n    });\n  });\n}\nexport function moveItem(item) {\n  this.spawnMoveToast((cancelled, destination) => {\n    if (cancelled) {\n      return false;\n    }\n\n    if (item.type == \"file\") {\n      return this.moveFile(item, destination, true);\n    } else {\n      return this.moveFolder(item, destination, true);\n    }\n  });\n}\nexport async function renameItem(item) {\n  let parent = utils.currentParentFolder();\n\n  if (parent == \"base\") {\n    if (item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\") {\n      return this.spawnToast(language.get(this.state.lang, \"cannotRenameItem\", true, [\"__NAME__\"], [item.name]));\n    }\n  }\n\n  this.spawnRenamePrompt(item, async (cancelled, newName) => {\n    if (cancelled) {\n      return false;\n    }\n\n    if (item.name == newName) {\n      return false;\n    }\n\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n\n    if (item.type == \"file\") {\n      newName = utils.removeIllegalCharsFromString(newName);\n\n      if (utils.nameRegex(newName) || utils.checkIfNameIsBanned(newName) || utils.fileNameValidationRegex(newName)) {\n        loading.dismiss();\n        return this.spawnToast(language.get(this.state.lang, \"invalidFileName\"));\n      }\n\n      let nameEx = item.name.split(\".\");\n      let fileExt = nameEx[nameEx.length - 1];\n      let renameWithDot = false;\n\n      if (item.name.indexOf(\".\") !== -1) {\n        renameWithDot = true;\n      }\n\n      this.fileExists(newName, parent, async (err, exists, existsUUID) => {\n        if (err) {\n          console.log(err);\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (exists) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"fileRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]));\n        }\n\n        if (renameWithDot) {\n          newName = newName + \".\" + fileExt;\n        }\n\n        try {\n          var res = await utils.apiRequest(\"POST\", \"/v1/file/rename\", {\n            apiKey: this.state.userAPIKey,\n            uuid: item.uuid,\n            name: utils.cryptoJSEncrypt(newName, item.key),\n            nameHashed: utils.hashFn(newName.toLowerCase()),\n            metaData: utils.cryptoJSEncrypt(JSON.stringify({\n              name: newName,\n              size: parseInt(item.size),\n              mime: item.mime,\n              key: item.key\n            }), this.state.userMasterKeys[this.state.userMasterKeys.length - 1])\n          });\n        } catch (e) {\n          console.log(e);\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (!res.status) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"couldNotRenameFile\"));\n        }\n\n        utils.checkIfItemIsBeingSharedForRename(\"file\", parent, {\n          name: newName,\n          size: parseInt(item.size),\n          mime: item.mime,\n          key: item.key\n        }, () => {\n          loading.dismiss();\n          this.spawnToast(language.get(this.state.lang, \"fileRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]));\n          delete window.customVariables.cachedFiles[item.uuid];\n          clearTimeout(window.customVariables.reloadAfterActionTimeout);\n          window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n            if (utils.currentParentFolder() == parent) {\n              this.updateItemList();\n            }\n          }, 500);\n\n          if (typeof window.customVariables.offlineSavedFiles !== \"undefined\" && Capacitor.isNative) {\n            this.getDownloadDir(true, item.uuid, async (err, dirObj) => {\n              if (err) {\n                console.log(err);\n                return this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"));\n              }\n\n              try {\n                await Plugins.Filesystem.rename({\n                  from: dirObj + \"/\" + item.name,\n                  to: dirObj + \"/\" + newName,\n                  directory: dirObj.directory\n                });\n              } catch (e) {\n                console.log(err);\n                return this.spawnToast(language.get(this.state.lang, \"couldNotRenameFileLocally\"));\n              }\n\n              return console.log(\"File renamed locally\");\n            });\n          }\n\n          return true;\n        });\n      });\n    } else {\n      newName = utils.removeIllegalCharsFromString(newName);\n\n      if (utils.checkIfNameIsBanned(newName) || utils.folderNameRegex(newName) || utils.fileNameValidationRegex(newName)) {\n        loading.dismiss();\n        return this.spawnToast(language.get(this.state.lang, \"invalidFolderName\"));\n      }\n\n      this.dirExists(newName, parent, async (err, exists, existsUUID) => {\n        if (err) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (exists) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"folderRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]));\n        }\n\n        try {\n          var res = await utils.apiRequest(\"POST\", \"/v1/dir/rename\", {\n            apiKey: this.state.userAPIKey,\n            uuid: item.uuid,\n            name: utils.cryptoJSEncrypt(JSON.stringify({\n              name: newName\n            }), this.state.userMasterKeys[this.state.userMasterKeys.length - 1]),\n            nameHashed: utils.hashFn(newName.toLowerCase())\n          });\n        } catch (e) {\n          console.log(e);\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n        }\n\n        if (!res.status) {\n          loading.dismiss();\n          return this.spawnToast(language.get(this.state.lang, \"couldNotRenameFolder\"));\n        }\n\n        utils.checkIfItemIsBeingSharedForRename(\"folder\", parent, {\n          name: newName\n        }, () => {\n          loading.dismiss();\n          this.spawnToast(language.get(this.state.lang, \"folderRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]));\n          delete window.customVariables.cachedFolders[item.uuid];\n          clearTimeout(window.customVariables.reloadAfterActionTimeout);\n          window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n            if (utils.currentParentFolder() == parent) {\n              this.updateItemList();\n            }\n          }, 500);\n          return true;\n        });\n      });\n    }\n  });\n}\nexport async function moveSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  this.spawnMoveToast((cancelled, destination) => {\n    if (cancelled) {\n      return false;\n    }\n\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].type == \"file\") {\n        this.moveFile(items[i], destination, true);\n      } else {\n        this.moveFolder(items[i], destination, true);\n      }\n    }\n  });\n}\nexport async function trashSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  let alert = await alertController.create({\n    header: language.get(this.state.lang, \"trashItemHeader\"),\n    message: language.get(this.state.lang, \"trashItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: () => {\n        items.forEach(item => {\n          this.trashItem(item, false);\n        });\n      }\n    }]\n  });\n  return alert.present();\n}\nexport async function restoreSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  let alert = await alertController.create({\n    header: language.get(this.state.lang, \"restoreItemsHeader\"),\n    message: language.get(this.state.lang, \"restoreItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: () => {\n        items.forEach(item => {\n          this.restoreItem(item, false);\n        });\n      }\n    }]\n  });\n  return alert.present();\n}\nexport function getSelectedItems() {\n  return new Promise((resolve, reject) => {\n    let items = this.state.itemList.filter(item => {\n      return item.selected === true;\n    });\n    return resolve(items);\n  });\n}\nexport async function restoreItem(item, showLoader) {\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  if (item.type == \"file\") {\n    this.fileExists(item.name, item.parent, async (err, exists, existsUUID) => {\n      if (err) {\n        console.log(err);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (exists) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"fileExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/file/restore\", {\n          apiKey: this.state.userAPIKey,\n          uuid: item.uuid\n        });\n      } catch (e) {\n        console.log(e);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (!res.status) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        this.updateItemList();\n      }, 500);\n      return this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]));\n    });\n  } else {\n    this.dirExists(item.name, item.parent, async (err, exists, existsUUID) => {\n      if (err) {\n        console.log(err);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (exists) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"folderExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/dir/restore\", {\n          apiKey: this.state.userAPIKey,\n          uuid: item.uuid\n        });\n      } catch (e) {\n        console.log(e);\n\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n      }\n\n      if (!res.status) {\n        if (showLoader) {\n          loading.dismiss();\n        }\n\n        return this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      if (showLoader) {\n        loading.dismiss();\n      }\n\n      clearTimeout(window.customVariables.reloadAfterActionTimeout);\n      window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n        this.updateItemList();\n      }, 500);\n      return this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]));\n    });\n  }\n}\nexport async function trashItem(item, showLoader) {\n  if (utils.currentParentFolder() == \"base\") {\n    if (item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\") {\n      return this.spawnToast(language.get(this.state.lang, \"cannotTrashItem\", true, [\"__NAME__\"], [item.name]));\n    }\n  }\n\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  try {\n    if (item.type == \"file\") {\n      var res = await utils.apiRequest(\"POST\", \"/v1/file/trash\", {\n        apiKey: this.state.userAPIKey,\n        uuid: item.uuid\n      });\n    } else {\n      var res = await utils.apiRequest(\"POST\", \"/v1/dir/trash\", {\n        apiKey: this.state.userAPIKey,\n        uuid: item.uuid\n      });\n    }\n  } catch (e) {\n    console.log(e);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n  }\n\n  if (!res.status) {\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"couldNotTrashItem\", true, [\"__NAME__\"], [item.name]));\n  }\n\n  if (showLoader) {\n    loading.dismiss();\n  }\n\n  clearTimeout(window.customVariables.reloadAfterActionTimeout);\n  window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n    this.updateItemList();\n  }, 500);\n  return this.spawnToast(language.get(this.state.lang, \"itemTrashed\", true, [\"__NAME__\"], [item.name]));\n}\nexport async function shareItemWithEmail(email, uuid, type, callback) {\n  if (email == this.state.userEmail) {\n    return callback(language.get(this.state.lang, \"cannotShareWithSelf\"));\n  }\n\n  let loading = await loadingController.create({\n    message: \"\"\n  });\n  loading.present();\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/user/publicKey/get\", {\n      email\n    });\n  } catch (e) {\n    loading.dismiss();\n    return callback(e);\n  }\n\n  if (!res.status) {\n    loading.dismiss();\n    return callback(res.message);\n  }\n\n  let userPubKey = res.data.publicKey;\n\n  if (userPubKey == null) {\n    loading.dismiss();\n    return callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]));\n  }\n\n  if (userPubKey.length <= 1) {\n    loading.dismiss();\n    return callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]));\n  }\n\n  try {\n    var usrPubKey = await window.crypto.subtle.importKey(\"spki\", utils._base64ToArrayBuffer(userPubKey), {\n      name: \"RSA-OAEP\",\n      hash: \"SHA-512\"\n    }, true, [\"encrypt\"]);\n  } catch (e) {\n    loading.dismiss();\n    return callback(e);\n  }\n\n  if (type == \"file\") {\n    if (typeof window.customVariables.cachedFiles[uuid] == \"undefined\") {\n      loading.dismiss();\n      return callback(language.get(this.state.lang, \"shareItemFileNotFound\", true, [\"__NAME__\"], [uuid]));\n    }\n\n    let fileName = window.customVariables.cachedFiles[uuid].name;\n    let fileSize = window.customVariables.cachedFiles[uuid].size;\n    let fileMime = window.customVariables.cachedFiles[uuid].mime;\n    let fileKey = window.customVariables.cachedFiles[uuid].key;\n\n    try {\n      var encrypted = await window.crypto.subtle.encrypt({\n        name: \"RSA-OAEP\"\n      }, usrPubKey, new TextEncoder().encode(JSON.stringify({\n        name: fileName,\n        size: fileSize,\n        mime: fileMime,\n        key: fileKey\n      })));\n    } catch (e) {\n      loading.dismiss();\n      return console.log(e);\n    }\n\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/share\", {\n        apiKey: this.state.userAPIKey,\n        uuid,\n        parent: \"none\",\n        email,\n        type: \"file\",\n        metadata: utils.base64ArrayBuffer(encrypted)\n      });\n    } catch (e) {\n      loading.dismiss();\n      return callback(e);\n    }\n\n    if (!res.status) {\n      loading.dismiss();\n      return callback(res.message);\n    }\n\n    loading.dismiss();\n    return callback(null);\n  } else {\n    try {\n      var res = await utils.apiRequest(\"POST\", \"/v1/download/dir\", {\n        apiKey: this.state.userAPIKey,\n        uuid\n      });\n    } catch (e) {\n      loading.dismiss();\n      return callback(e);\n    }\n\n    if (!res.status) {\n      loading.dismiss();\n      return callback(res.message);\n    }\n\n    let shareItems = [];\n    let files = res.data.files;\n    let folders = res.data.folders;\n\n    if (files.length + folders.length > 1000) {\n      loading.dismiss();\n      return callback(language.get(this.state.lang, \"shareTooBigForApp\"));\n    }\n\n    for (let i = 0; i < files.length; i++) {\n      let metadata = utils.decryptFileMetadata(files[i].metadata, this.state.userMasterKeys, files[i].uuid);\n\n      if (metadata.key.length > 0) {\n        shareItems.push({\n          uuid: files[i].uuid,\n          parent: files[i].parent,\n          metadata: {\n            name: metadata.name,\n            size: parseInt(metadata.size),\n            mime: metadata.mime,\n            key: metadata.key\n          },\n          type: \"file\"\n        });\n      }\n    }\n\n    for (let i = 0; i < folders.length; i++) {\n      let dirName = utils.decryptCryptoJSFolderName(folders[i].name, this.state.userMasterKeys, folders[i].uuid);\n\n      if (dirName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\") {\n        shareItems.push({\n          uuid: folders[i].uuid,\n          parent: i == 0 ? \"none\" : folders[i].parent,\n          metadata: dirName,\n          type: \"folder\"\n        });\n      }\n    }\n\n    let itemsShared = 0;\n\n    for (let i = 0; i < shareItems.length; i++) {\n      let item = shareItems[i];\n      let itemMetadata = \"\";\n\n      if (item.type == \"file\") {\n        itemMetadata = JSON.stringify(item.metadata);\n      } else {\n        itemMetadata = JSON.stringify({\n          name: item.metadata\n        });\n      }\n\n      try {\n        var encrypted = await window.crypto.subtle.encrypt({\n          name: \"RSA-OAEP\"\n        }, usrPubKey, new TextEncoder().encode(itemMetadata));\n      } catch (e) {\n        loading.dismiss();\n        return callback(e);\n      }\n\n      try {\n        var res = await utils.apiRequest(\"POST\", \"/v1/share\", {\n          apiKey: this.state.userAPIKey,\n          uuid: item.uuid,\n          parent: item.parent,\n          email: email,\n          type: item.type,\n          metadata: utils.base64ArrayBuffer(encrypted)\n        });\n      } catch (e) {\n        console.log(e);\n      }\n\n      if (!res.status) {\n        console.log(res.message);\n      }\n\n      itemsShared += 1;\n\n      if (itemsShared == shareItems.length) {\n        loading.dismiss();\n        return callback(null);\n      }\n    }\n  }\n}\nexport async function shareSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n  let alert = await alertController.create({\n    header: language.get(this.state.lang, \"shareItems\"),\n    inputs: [{\n      type: \"text\",\n      id: \"share-items-email-input\",\n      name: \"share-items-email-input\",\n      placeholder: language.get(this.state.lang, \"receiverEmail\")\n    }],\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: async inputs => {\n        let email = inputs['share-items-email-input'];\n        let itemsShared = 0;\n\n        for (let i = 0; i < items.length; i++) {\n          let item = items[i];\n\n          if (item.type == \"folder\" && item.uuid == \"default\") {\n            this.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"));\n          } else {\n            this.shareItemWithEmail(email, item.uuid, item.type, err => {\n              if (err) {\n                console.log(err);\n                this.spawnToast(err.toString());\n              }\n\n              itemsShared += 1;\n\n              if (itemsShared >= items.length) {\n                return this.spawnToast(language.get(this.state.lang, \"itemsShared\", true, [\"__COUNT__\", \"__EMAIL__\"], [items.length, email]));\n              }\n            });\n          }\n        }\n      }\n    }]\n  });\n  await alert.present();\n  setTimeout(() => {\n    try {\n      document.querySelector(\"ion-alert input\").focus();\n    } catch (e) {}\n  }, 500);\n  return true;\n}\nexport async function shareItem(item) {\n  if (item.type == \"folder\" && item.uuid == \"default\") {\n    return this.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"));\n  }\n\n  let alert = await alertController.create({\n    header: item.type == \"file\" ? language.get(this.state.lang, \"shareFile\") : language.get(this.state.lang, \"shareFolder\"),\n    inputs: [{\n      type: \"text\",\n      id: \"share-item-email-input\",\n      name: \"share-item-email-input\",\n      placeholder: language.get(this.state.lang, \"receiverEmail\")\n    }],\n    buttons: [{\n      text: language.get(this.state.lang, \"cancel\"),\n      role: \"cancel\",\n      handler: () => {\n        return false;\n      }\n    }, {\n      text: language.get(this.state.lang, \"alertOkButton\"),\n      handler: inputs => {\n        let email = inputs['share-item-email-input'];\n        this.shareItemWithEmail(email, item.uuid, item.type, err => {\n          if (err) {\n            console.log(err);\n            return this.spawnToast(err.toString());\n          }\n\n          return this.spawnToast(language.get(this.state.lang, \"itemShared\", true, [\"__NAME__\", \"__WITH__\"], [item.name, email]));\n        });\n      }\n    }]\n  });\n  await alert.present();\n  setTimeout(() => {\n    try {\n      document.querySelector(\"ion-alert input\").focus();\n    } catch (e) {}\n  }, 500);\n  return true;\n}\nexport async function openPublicLinkModal(item) {\n  let loading = await loadingController.create({\n    message: \"\"\n  });\n  loading.present();\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/link/status\", {\n      apiKey: this.state.userAPIKey,\n      fileUUID: item.uuid\n    });\n  } catch (e) {\n    console.log(e);\n    loading.dismiss();\n    return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n  }\n\n  if (!res.status) {\n    console.log(res.message);\n    loading.dismiss();\n    return this.spawnToast(res.message);\n  }\n\n  loading.dismiss();\n  let appLang = this.state.lang;\n  let appDarkMode = this.state.darkMode;\n  let modalId = \"public-link-modal-\" + utils.generateRandomClassName();\n  customElements.define(modalId, class ModalContent extends HTMLElement {\n    connectedCallback() {\n      this.innerHTML = `\n\t\t\t\t<ion-header>\n\t\t\t\t\t<ion-toolbar>\n\t\t\t\t\t\t<ion-buttons slot=\"start\">\n\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\n\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\n\t\t\t\t\t\t\t</ion-button>\n\t\t\t\t\t\t</ion-buttons>\n\t\t\t\t\t\t<ion-title>\n\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\n\t\t\t\t\t\t</ion-title>\n\t\t\t\t\t</ion-toolbar>\n\t\t\t\t</ion-header>\n\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\n\t\t\t\t\t<div id=\"enable-public-link-content\" ` + (res.data.enabled && `style=\"display: none;\"`) + `>\n\t\t\t\t\t\t<div style=\"position: absolute; left: 50%; top: 32%; transform: translate(-50%, -50%); width: 100%;\"> \n\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t<ion-icon icon=\"` + Ionicons.link + `\" style=\"font-size: 65pt; color: ` + (appDarkMode ? \"white\" : \"gray\") + `;\"></ion-icon>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<ion-button color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable')\">` + language.get(appLang, \"enablePublicLink\") + `</ion-button>\t\n\t\t\t\t\t\t\t</center>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\"public-link-enabled-content\" ` + (!res.data.enabled && `style=\"display: none;\"`) + `>\n\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t<ion-label>\n\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnabled\") + `\n\t\t\t\t\t\t\t</ion-label>\n\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enabled-toggle\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'disable')\" checked></ion-toggle>\n\t\t\t\t\t\t</ion-item>\n\t\t\t\t\t\t<ion-item lines=\"none\">\n\t\t\t\t\t\t\t<ion-input type=\"text\" id=\"public-link-input\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\" value=\"https://filen.io/d/` + res.data.uuid + `#!` + item.key + `\" disabled></ion-input>\n                            <ion-buttons slot=\"end\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\">\n                                <ion-button fill=\"solid\" color=\"` + (appDarkMode ? `dark` : `light`) + `\">\n                                    ` + language.get(appLang, \"copy\") + `\n                                </ion-button>\n                            </ion-buttons>\n                        </ion-item>\n\t\t\t\t\t</div>\n\t\t\t\t</ion-content>\n\t\t\t`;\n    }\n\n  });\n  let modal = await modalController.create({\n    component: modalId,\n    swipeToClose: false,\n    showBackdrop: false,\n    backdropDismiss: false,\n    cssClass: \"modal-fullscreen\"\n  });\n  return modal.present();\n}\nexport function makeItemAvailableOffline(offline, item) {\n  if (!offline) {\n    this.getDownloadDir(true, item.uuid, async (err, dirObj) => {\n      if (err) {\n        console.log(err);\n        return this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"));\n      }\n\n      try {\n        await Plugins.Filesystem.rmdir({\n          path: dirObj.path,\n          directory: dirObj.directory,\n          recursive: true\n        });\n        delete window.customVariables.offlineSavedFiles[item.uuid];\n      } catch (e) {\n        console.log(e);\n        return this.spawnToast(language.get(this.state.lang, \"couldNotDeleteDownloadedFile\", true, [\"__NAME__\"], [item.name]));\n      }\n\n      let items = this.state.itemList;\n      let windowItems = window.customVariables.itemList;\n\n      for (let i = 0; i < items.length; i++) {\n        if (items[i].uuid == item.uuid) {\n          items[i].offline = false;\n        }\n      }\n\n      for (let i = 0; i < windowItems.length; i++) {\n        if (windowItems[i].uuid == item.uuid) {\n          windowItems[i].offline = false;\n        }\n      }\n\n      this.setState({\n        itemList: items\n      });\n      window.customVariables.itemList = windowItems;\n\n      if (typeof window.customVariables.cachedFiles[item.uuid] !== \"undefined\") {\n        window.customVariables.cachedFiles[item.uuid].offline = false;\n      }\n\n      this.spawnToast(language.get(this.state.lang, \"fileDeletedFromOfflineStorage\", true, [\"__NAME__\"], [item.name]));\n      window.customFunctions.saveOfflineSavedFiles();\n      return this.forceUpdate();\n    });\n  } else {\n    let nItem = item;\n    nItem.makeOffline = true;\n    return this.queueFileDownload(nItem);\n  }\n}\nexport async function removeSharedInItem(item, showLoader) {\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/in/remove\", {\n      apiKey: this.state.userAPIKey,\n      uuid: item.uuid,\n      receiverId: 0\n    });\n  } catch (e) {\n    console.log(e);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n  }\n\n  if (!res.status) {\n    console.log(res.message);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(res.message);\n  }\n\n  if (showLoader) {\n    loading.dismiss();\n  }\n\n  clearTimeout(window.customVariables.reloadAfterActionTimeout);\n  window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n    this.updateItemList();\n  }, 500);\n  return this.spawnToast(language.get(this.state.lang, \"itemRemovedFromSharedIn\", true, [\"__NAME__\"], [item.name]));\n}\nexport async function stopSharingItem(item, showLoader) {\n  if (showLoader) {\n    var loading = await loadingController.create({\n      message: \"\"\n    });\n    loading.present();\n  }\n\n  try {\n    var res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/out/remove\", {\n      apiKey: this.state.userAPIKey,\n      uuid: item.uuid,\n      receiverId: item.receiverId\n    });\n  } catch (e) {\n    console.log(e);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(language.get(this.state.lang, \"apiRequestError\"));\n  }\n\n  if (!res.status) {\n    console.log(res.message);\n\n    if (showLoader) {\n      loading.dismiss();\n    }\n\n    return this.spawnToast(res.message);\n  }\n\n  if (showLoader) {\n    loading.dismiss();\n  }\n\n  clearTimeout(window.customVariables.reloadAfterActionTimeout);\n  window.customVariables.reloadAfterActionTimeout = setTimeout(() => {\n    this.updateItemList();\n  }, 500);\n  return this.spawnToast(language.get(this.state.lang, \"itemStoppedSharing\", true, [\"__NAME__\"], [item.name]));\n}\nexport async function removeSelectedItemsFromSharedIn() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n    this.removeSharedInItem(item, false);\n  }\n\n  return true;\n}\nexport async function stopSharingSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n    this.stopSharingItem(item, false);\n  }\n\n  return true;\n}\nexport async function downloadSelectedItems() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n\n    if (item.type == \"file\") {\n      this.queueFileDownload(item);\n    }\n  }\n\n  return true;\n}\nexport async function storeSelectedItemsOffline() {\n  let items = await this.getSelectedItems();\n  window.customFunctions.dismissPopover();\n  window.customFunctions.unselectAllItems();\n\n  for (let i = 0; i < items.length; i++) {\n    let item = items[i];\n\n    if (item.type == \"file\") {\n      item.makeOffline = true;\n      this.queueFileDownload(item);\n    }\n  }\n\n  return true;\n}\nexport async function spawnItemActionSheet(item) {\n  let buttons = undefined;\n\n  if (item.type == \"folder\") {\n    if (window.location.href.indexOf(\"shared-in\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"removeFromShared\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.removeSharedInItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"shared-out\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"stopSharing\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.stopSharingItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"trash\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"restoreItem\"),\n        icon: Ionicons.bagAdd,\n        handler: () => {\n          return this.restoreItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else {\n      buttons = [{\n        text: language.get(this.state.lang, \"shareItem\"),\n        icon: Ionicons.shareSocial,\n        handler: () => {\n          return this.shareItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"moveItem\"),\n        icon: Ionicons.move,\n        handler: () => {\n          return this.moveItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"renameItem\"),\n        icon: Ionicons.text,\n        handler: () => {\n          return this.renameItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"trashItem\"),\n        icon: Ionicons.trash,\n        handler: () => {\n          return this.trashItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    }\n  } else {\n    if (window.location.href.indexOf(\"shared-in\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\n        icon: Ionicons.save,\n        handler: () => {\n          window.customFunctions.dismissModal();\n\n          if (item.offline) {\n            return this.makeItemAvailableOffline(false, item);\n          } else {\n            return this.makeItemAvailableOffline(true, item);\n          }\n        }\n      }, {\n        text: language.get(this.state.lang, \"removeFromShared\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.removeSharedInItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"shared-out\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\n        icon: Ionicons.save,\n        handler: () => {\n          window.customFunctions.dismissModal();\n\n          if (item.offline) {\n            return this.makeItemAvailableOffline(false, item);\n          } else {\n            return this.makeItemAvailableOffline(true, item);\n          }\n        }\n      }, {\n        text: language.get(this.state.lang, \"stopSharing\"),\n        icon: Ionicons.stopCircle,\n        handler: () => {\n          this.stopSharingItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else if (window.location.href.indexOf(\"trash\") !== -1) {\n      buttons = [{\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"restoreItem\"),\n        icon: Ionicons.bagAdd,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.restoreItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    } else {\n      buttons = [{\n        text: language.get(this.state.lang, \"shareItem\"),\n        icon: Ionicons.shareSocial,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.shareItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"itemPublicLink\"),\n        icon: Ionicons.link,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.openPublicLinkModal(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"downloadItem\"),\n        icon: Ionicons.download,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.queueFileDownload(item);\n        }\n      }, {\n        text: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\n        icon: Ionicons.save,\n        handler: () => {\n          window.customFunctions.dismissModal();\n\n          if (item.offline) {\n            return this.makeItemAvailableOffline(false, item);\n          } else {\n            return this.makeItemAvailableOffline(true, item);\n          }\n        }\n      }, {\n        text: language.get(this.state.lang, \"moveItem\"),\n        icon: Ionicons.move,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.moveItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"renameItem\"),\n        icon: Ionicons.text,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.renameItem(item);\n        }\n      }, {\n        text: language.get(this.state.lang, \"trashItem\"),\n        icon: Ionicons.trash,\n        handler: () => {\n          window.customFunctions.dismissModal();\n          return this.trashItem(item, false);\n        }\n      }, {\n        text: language.get(this.state.lang, \"cancel\"),\n        icon: Ionicons.close,\n        handler: () => {\n          return actionSheet.dismiss();\n        }\n      }];\n    }\n  }\n\n  let headerName = item.name;\n\n  if (headerName.length >= 32) {\n    headerName = headerName.substring(0, 32) + \"...\";\n  }\n\n  let actionSheet = await actionSheetController.create({\n    header: headerName,\n    buttons\n  });\n  await actionSheet.present();\n\n  if (Capacitor.isNative) {\n    setTimeout(() => {\n      Capacitor.Plugins.Keyboard.hide();\n    }, 500);\n  }\n\n  return true;\n}","map":{"version":3,"sources":["/Users/jan/Documents/filen/app/src/components/items.js"],"names":["language","loadingController","modalController","popoverController","alertController","actionSheetController","Ionicons","Capacitor","HapticsImpactStyle","Plugins","FileOpener","utils","require","updateItemList","state","isLoggedIn","showLogin","userAPIKey","length","isNative","Keyboard","hide","SplashScreen","setState","searchbarOpen","mainSearchTerm","routeEx","window","location","hash","split","parent","loading","create","message","present","customVariables","currentThumbnailURL","href","items","res","apiRequest","apiKey","e","console","log","customFunctions","dismissLoader","alert","header","subHeader","get","lang","buttons","toUpperCase","status","push","type","uuid","name","date","timestamp","Date","receiverId","receiverEmail","sharerId","sharerEmail","i","data","folders","folder","folderName","decryptCryptoJSFolderName","userMasterKeys","uploadDate","toString","item","sanitizeHTML","cachedFolders","iItems","toLowerCase","usrPrivKey","crypto","subtle","importKey","_base64ToArrayBuffer","userPrivateKey","JSON","stringify","page","app","decryptFolderNamePrivateKey","metadata","uploads","file","decryptedMetadata","decryptFileMetadataPrivateKey","offline","offlineSavedFiles","mime","size","parseInt","key","bucket","region","rm","chunks","thumbnail","thumbnailBlobCache","undefined","cachedFiles","currentReceiverId","decryptFileMetadata","orderItemsByType","orderBy","itemList","scrollTo","scrollToIndex","dismiss","forceUpdate","getFileThumbnail","saveCachedItems","saveThumbnailCache","thumbURL","index","indexOf","getThumbnailErrors","intervalTimer","getRandomArbitrary","document","getElementById","onScreenInterval","setInterval","clearInterval","ext","canShowThumbnail","getThumbnail","saveGetThumbnailErrors","updateItemsSemaphore","acquire","newItems","release","refreshMainList","event","detail","complete","selectItem","selectedItems","selected","Haptics","impact","Light","clearSelectedItems","selectItemsAction","persist","appLang","customElementId","generateRandomClassName","selectedItemsDoesNotContainFolder","inner","customElements","define","ModalContent","HTMLElement","connectedCallback","innerHTML","popover","component","previewItem","lastModalPreviewType","settings","onlyWifi","networkStatus","Network","getStatus","connectionType","spawnToast","getDownloadDir","err","dirObj","open","uri","then","catch","nameEx","previewType","getFilePreviewType","dismissModal","spawnItemActionSheet","gotPreviewData","dataArray","blob","Blob","currentPreviewURL","urlCreator","revokeObjectURL","createObjectURL","previewModalContent","arrowBack","btoa","ellipsisVertical","text","TextDecoder","decode","join","setupBars","setupStatusbar","modal","getTop","onDidDismiss","setupSlider","lastPreviewType","slider","getPrevOrNextItem","step","max","tries","getItemRecursive","listIndex","thisNameEx","thisPreviewType","options","freeMode","offset","offsetY","xDown","yDown","addEventListener","firstTouch","getTouch","clientX","clientY","xUp","yUp","xDiff","yDiff","xDiffAbs","Math","abs","yDiffAbs","nextItem","prevItem","changedTouches","loadPdf","canvasContainer","pdfjsLib","GlobalWorkerOptions","workerSrc","loader","renderPage","viewport","getViewport","scale","canvas","createElement","ctx","getContext","renderContext","canvasContext","height","width","appendChild","render","renderPages","pdfDoc","numPages","getPage","loadingTask","getDocument","promise","currentModal","querySelectorAll","childNodes","modalId","swipeToClose","showBackdrop","backdropDismiss","cssClass","style","backgroundColor","downloadPreview","chunksDone","dirExists","callback","nameHashed","hashFn","exists","moveFolder","destination","showLoader","currentParentFolder","existsUUID","folderUUID","checkIfItemParentIsBeingShared","clearTimeout","reloadAfterActionTimeout","setTimeout","moveFile","fileExists","fileUUID","moveItem","spawnMoveToast","cancelled","renameItem","spawnRenamePrompt","newName","removeIllegalCharsFromString","nameRegex","checkIfNameIsBanned","fileNameValidationRegex","fileExt","renameWithDot","cryptoJSEncrypt","metaData","checkIfItemIsBeingSharedForRename","Filesystem","rename","from","to","directory","folderNameRegex","moveSelectedItems","getSelectedItems","dismissPopover","unselectAllItems","trashSelectedItems","role","handler","forEach","trashItem","restoreSelectedItems","restoreItem","Promise","resolve","reject","filter","shareItemWithEmail","email","userEmail","userPubKey","publicKey","usrPubKey","fileName","fileSize","fileMime","fileKey","encrypted","encrypt","TextEncoder","encode","base64ArrayBuffer","shareItems","files","dirName","itemsShared","itemMetadata","shareSelectedItems","inputs","id","placeholder","querySelector","focus","shareItem","openPublicLinkModal","appDarkMode","darkMode","enabled","link","makeItemAvailableOffline","rmdir","path","recursive","windowItems","saveOfflineSavedFiles","nItem","makeOffline","queueFileDownload","removeSharedInItem","stopSharingItem","removeSelectedItemsFromSharedIn","stopSharingSelectedItems","downloadSelectedItems","storeSelectedItemsOffline","icon","stopCircle","close","actionSheet","bagAdd","shareSocial","move","trash","download","save","headerName","substring"],"mappings":"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","sourcesContent":["import * as language from \"../utils/language\"\r\nimport { loadingController, modalController, popoverController, alertController, actionSheetController } from \"@ionic/core\"\r\nimport * as Ionicons from 'ionicons/icons'\r\nimport { Capacitor, HapticsImpactStyle, Plugins } from \"@capacitor/core\"\r\nimport { FileOpener } from \"@ionic-native/file-opener\"\r\n\r\nconst utils = require(\"../utils/utils\")\r\n\r\nexport async function updateItemList(){\r\n\tif(!this.state.isLoggedIn){\r\n\t\treturn this.showLogin()\r\n\t}\r\n\t\r\n\tif(this.state.userAPIKey.length <= 16){\r\n\t\treturn this.showLogin()\r\n\t}\r\n\r\n\tif(Capacitor.isNative){\r\n\t\tCapacitor.Plugins.Keyboard.hide()\r\n\t\tPlugins.SplashScreen.hide()\r\n\t}\r\n\r\n\tthis.setState({\r\n        searchbarOpen: false,\r\n        mainSearchTerm: \"\"\r\n    })\r\n\r\n\tlet routeEx = window.location.hash.split(\"/\")\r\n\tlet parent = routeEx[routeEx.length - 1]\r\n\r\n    let loading = await loadingController.create({\r\n        message: \"\"\r\n    })\r\n\r\n\tloading.present()\r\n\r\n\twindow.customVariables.currentThumbnailURL = window.location.href\r\n\r\n\tlet items = []\r\n\t\r\n\tif(parent == \"base\"){\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/baseFolders\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tconsole.log(e)\r\n\t\r\n\t\t\twindow.customFunctions.dismissLoader()\r\n\t\r\n\t\t\tlet alert = await alertController.create({\r\n\t\t\t\theader: \"\",\r\n\t\t\t\tsubHeader: \"\",\r\n\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t})\r\n\t\r\n\t\t\treturn alert.present()\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\tconsole.log(res.message)\r\n\t\r\n\t\t\twindow.customFunctions.dismissLoader()\r\n\t\r\n\t\t\tlet alert = await alertController.create({\r\n\t\t\t\theader: \"\",\r\n\t\t\t\tsubHeader: \"\",\r\n\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t})\r\n\t\r\n\t\t\treturn alert.present()\r\n\t\t}\r\n\r\n\t\titems.push({\r\n\t\t\ttype: \"folder\",\r\n\t\t\tuuid: \"default\",\r\n\t\t\tname: \"Default\",\r\n\t\t\tdate: language.get(this.state.lang, \"defaultFolder\"),\r\n\t\t\ttimestamp: (((+new Date()) / 1000) - (86400 * 3650)),\r\n\t\t\tparent: \"base\",\r\n\t\t\treceiverId: 0,\r\n\t\t\treceiverEmail: \"\",\r\n\t\t\tsharerId: 0,\r\n\t\t\tsharerEmail: \"\"\r\n\t\t})\r\n\r\n\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\tlet folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid)\r\n\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\tlet item = {\r\n\t\t\t\ttype: \"folder\",\r\n\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\tparent: \"base\",\r\n\t\t\t\treceiverId: 0,\r\n\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\tsharerId: 0,\r\n\t\t\t\tsharerEmail: \"\"\r\n\t\t\t}\r\n\r\n\t\t\titems.push(item)\r\n\r\n\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t}\r\n\r\n\t\tlet iItems = []\r\n\r\n\t\tiItems.push(items[0])\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tif(items[i].name.toLowerCase() == \"filen sync\" && items[i].uuid !== \"default\"){\r\n\t\t\t\tiItems.push(items[i])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tif(items[i].name.toLowerCase() !== \"filen sync\" && items[i].uuid !== \"default\"){\r\n\t\t\t\tiItems.push(items[i])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\titems = iItems\r\n\t}\r\n\telse{\r\n\t\tif(routeEx[1] == \"shared-in\"){\r\n\t\t\ttry{\r\n\t\t\t\tvar usrPrivKey = await window.crypto.subtle.importKey(\"pkcs8\", utils._base64ToArrayBuffer(this.state.userPrivateKey), {\r\n\t\t\t\t\tname: \"RSA-OAEP\",\r\n\t\t\t\t\thash: \"SHA-512\"\r\n\t\t\t\t}, true, [\"decrypt\"])\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"unknownDeviceError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/in\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: parent,\r\n\t\t\t\t\tfolders: JSON.stringify([\"shred-in\"]),\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tapp: \"true\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tif(!res.status){\r\n\t\t\t\tconsole.log(res.message)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\t\tlet folderName = await utils.decryptFolderNamePrivateKey(folder.metadata, usrPrivKey, folder.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\t\tparent: folder.parent,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: folder.sharerId,\r\n\t\t\t\t\tsharerEmail: folder.sharerEmail\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.uploads.length; i++){\r\n\t\t\t\tlet file = res.data.uploads[i]\r\n\r\n\t\t\t\tlet decryptedMetadata = await utils.decryptFileMetadataPrivateKey(file.metadata, usrPrivKey, file.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(file.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet offline = false\r\n\r\n\t\t\t\tif(typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\toffline = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tuuid: file.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(decryptedMetadata.name),\r\n\t\t\t\t\tmime: utils.sanitizeHTML(decryptedMetadata.mime),\r\n\t\t\t\t\tsize: parseInt(decryptedMetadata.size),\r\n\t\t\t\t\tkey: utils.sanitizeHTML(decryptedMetadata.key),\r\n\t\t\t\t\tbucket: file.bucket,\r\n\t\t\t\t\tregion: file.region,\r\n\t\t\t\t\tparent: file.parent,\r\n\t\t\t\t\trm: file.rm,\r\n\t\t\t\t\tchunks: file.chunks,\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: file.timestamp,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: file.sharerId,\r\n\t\t\t\t\tsharerEmail: file.sharerEmail,\r\n\t\t\t\t\toffline: offline,\r\n\t\t\t\t\tthumbnail: (typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined)\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFiles[file.uuid] = item\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(routeEx[1] == \"shared-out\"){\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/out\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: parent,\r\n\t\t\t\t\tfolders: JSON.stringify([\"default\"]),\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tapp: \"true\",\r\n\t\t\t\t\treceiverId: this.state.currentReceiverId\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tif(!res.status){\r\n\t\t\t\tconsole.log(res.message)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\t\tlet folderName = utils.decryptCryptoJSFolderName(folder.metadata, this.state.userMasterKeys, folder.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\t\tparent: folder.parent,\r\n\t\t\t\t\treceiverId: folder.receiverId,\r\n\t\t\t\t\treceiverEmail: folder.receiverEmail,\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\"\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.uploads.length; i++){\r\n\t\t\t\tlet file = res.data.uploads[i]\r\n\r\n\t\t\t\tlet metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(file.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet offline = false\r\n\r\n\t\t\t\tif(typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\toffline = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tuuid: file.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(metadata.name),\r\n\t\t\t\t\tmime: utils.sanitizeHTML(metadata.mime),\r\n\t\t\t\t\tsize: parseInt(metadata.size),\r\n\t\t\t\t\tkey: utils.sanitizeHTML(metadata.key),\r\n\t\t\t\t\tbucket: file.bucket,\r\n\t\t\t\t\tregion: file.region,\r\n\t\t\t\t\tparent: file.parent,\r\n\t\t\t\t\trm: file.rm,\r\n\t\t\t\t\tchunks: file.chunks,\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: file.timestamp,\r\n\t\t\t\t\treceiverId: file.receiverId,\r\n\t\t\t\t\treceiverEmail: file.receiverEmail,\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\",\r\n\t\t\t\t\toffline: offline,\r\n\t\t\t\t\tthumbnail: (typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined)\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFiles[file.uuid] = item\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/content\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: parent,\r\n\t\t\t\t\tfolders: JSON.stringify([\"default\"]),\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tapp: \"true\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tif(!res.status){\r\n\t\t\t\tconsole.log(res.message)\r\n\t\t\r\n\t\t\t\twindow.customFunctions.dismissLoader()\r\n\t\t\r\n\t\t\t\tlet alert = await alertController.create({\r\n\t\t\t\t\theader: \"\",\r\n\t\t\t\t\tsubHeader: \"\",\r\n\t\t\t\t\tmessage: language.get(this.state.lang, \"apiRequestError\"),\r\n\t\t\t\t\tbuttons: [language.get(this.state.lang, \"alertOkButton\").toUpperCase()]\r\n\t\t\t\t})\r\n\t\t\r\n\t\t\t\treturn alert.present()\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.folders.length; i++){\r\n\t\t\t\tlet folder = res.data.folders[i]\r\n\r\n\t\t\t\tlet folderName = utils.decryptCryptoJSFolderName(folder.name, this.state.userMasterKeys, folder.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(folder.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"folder\",\r\n\t\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(folderName),\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: folder.timestamp,\r\n\t\t\t\t\tparent: folder.parent,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\"\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFolders[folder.uuid] = item\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < res.data.uploads.length; i++){\r\n\t\t\t\tlet file = res.data.uploads[i]\r\n\r\n\t\t\t\tlet metadata = utils.decryptFileMetadata(file.metadata, this.state.userMasterKeys, file.uuid)\r\n\t\t\t\tlet uploadDate = (new Date(file.timestamp * 1000)).toString().split(\" \")\r\n\r\n\t\t\t\tlet offline = false\r\n\r\n\t\t\t\tif(typeof window.customVariables.offlineSavedFiles[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\toffline = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet item = {\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tuuid: file.uuid,\r\n\t\t\t\t\tname: utils.sanitizeHTML(metadata.name),\r\n\t\t\t\t\tmime: utils.sanitizeHTML(metadata.mime),\r\n\t\t\t\t\tsize: parseInt(metadata.size),\r\n\t\t\t\t\tkey: utils.sanitizeHTML(metadata.key),\r\n\t\t\t\t\tbucket: file.bucket,\r\n\t\t\t\t\tregion: file.region,\r\n\t\t\t\t\tparent: file.parent,\r\n\t\t\t\t\trm: file.rm,\r\n\t\t\t\t\tchunks: file.chunks,\r\n\t\t\t\t\tdate: uploadDate[1] + \" \" + uploadDate[2] + \" \" + uploadDate[3] + \" \" + uploadDate[4],\r\n\t\t\t\t\ttimestamp: file.timestamp,\r\n\t\t\t\t\treceiverId: 0,\r\n\t\t\t\t\treceiverEmail: \"\",\r\n\t\t\t\t\tsharerId: 0,\r\n\t\t\t\t\tsharerEmail: \"\",\r\n\t\t\t\t\toffline: offline,\r\n\t\t\t\t\tthumbnail: (typeof window.customVariables.thumbnailBlobCache[file.uuid] !== \"undefined\" ? window.customVariables.thumbnailBlobCache[file.uuid] : undefined)\r\n\t\t\t\t}\r\n\r\n\t\t\t\titems.push(item)\r\n\r\n\t\t\t\twindow.customVariables.cachedFiles[file.uuid] = item\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\titems = utils.orderItemsByType(items, window.customVariables.orderBy)\r\n\r\n\twindow.customVariables.itemList = items\r\n\r\n\tlet scrollTo = 0\r\n\r\n\tif(typeof window.customVariables.scrollToIndex[parent] !== \"undefined\"){\r\n\t\tscrollTo = window.customVariables.scrollToIndex[parent]\r\n\r\n\t\tdelete window.customVariables.scrollToIndex[parent]\r\n\t}\r\n\r\n\treturn this.setState({\r\n\t\titemList: items,\r\n\t\tscrollToIndex: scrollTo\r\n\t}, () => {\r\n\t\tloading.dismiss()\r\n\r\n\t\tthis.forceUpdate()\r\n\r\n\t\twindow.customVariables.currentThumbnailURL = window.location.href\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tthis.getFileThumbnail(items[i], window.customVariables.currentThumbnailURL, i)\r\n\t\t}\r\n\r\n\t\twindow.customFunctions.saveCachedItems()\r\n\t\twindow.customFunctions.saveThumbnailCache()\r\n\t})\r\n}\r\n\r\nexport function getFileThumbnail(file, thumbURL, index){\r\n\tif(file.type !== \"file\" || file.name.indexOf(\".\") == -1 || typeof file.thumbnail !== \"undefined\"){\r\n\t\treturn false\r\n\t}\r\n\r\n\tif(typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\"){\r\n\t\tif(window.customVariables.getThumbnailErrors[file.uuid] >= 16){\r\n\t\t\treturn false\r\n\t\t}\r\n\t}\r\n\r\n\tlet intervalTimer = utils.getRandomArbitrary(10, 50)\r\n\r\n\tif(document.getElementById(\"item-thumbnail-\" + file.uuid) !== null){\r\n\t\tintervalTimer = 1\r\n\t}\r\n\r\n\tlet onScreenInterval = setInterval(async () => {\r\n\t\tif(thumbURL !== window.location.href){\r\n\t\t\treturn clearInterval(onScreenInterval)\r\n\t\t}\r\n\t\telse{\r\n\t\t\tif(document.getElementById(\"item-thumbnail-\" + file.uuid) !== null){\r\n\t\t\t\tclearInterval(onScreenInterval)\r\n\r\n\t\t\t\tlet ext = file.name.split(\".\")\r\n\t\t\t\text = ext[ext.length - 1]\r\n\r\n\t\t\t\tlet thumbnail = undefined\r\n\t\t\r\n\t\t\t\tif(utils.canShowThumbnail(ext)){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tthumbnail = await this.getThumbnail(file, thumbURL, ext)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\tconsole.log(e)\r\n\r\n\t\t\t\t\t\tif(e.indexOf(\"url changed\") == -1){\r\n\t\t\t\t\t\t\tif(typeof window.customVariables.getThumbnailErrors[file.uuid] !== \"undefined\"){\r\n\t\t\t\t\t\t\t\twindow.customVariables.getThumbnailErrors[file.uuid] = window.customVariables.getThumbnailErrors[file.uuid] + 1\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\twindow.customVariables.getThumbnailErrors[file.uuid] = 1\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\twindow.customFunctions.saveGetThumbnailErrors()\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(typeof thumbnail !== \"undefined\"){\r\n\t\t\t\t\tawait window.customVariables.updateItemsSemaphore.acquire()\r\n\r\n\t\t\t\t\tlet newItems = this.state.itemList\r\n\r\n\t\t\t\t\tfor(let i = 0; i < newItems.length; i++){\r\n\t\t\t\t\t\tif(newItems[i].uuid == file.uuid){\r\n\t\t\t\t\t\t\tnewItems[i].thumbnail = thumbnail\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.customVariables.itemList = newItems\r\n\r\n\t\t\t\t\tif(thumbURL == window.location.href){\r\n\t\t\t\t\t\treturn this.setState({\r\n\t\t\t\t\t\t\titemList: newItems\r\n\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\tthis.forceUpdate()\r\n\r\n\t\t\t\t\t\t\twindow.customVariables.updateItemsSemaphore.release()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\twindow.customVariables.updateItemsSemaphore.release()\r\n\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}, intervalTimer)\r\n}\r\n\r\nexport async function refreshMainList(event){\r\n    await this.updateItemList()\r\n\r\n    return event.detail.complete()\r\n}\r\n\r\nexport function selectItem(type, index){\r\n    let items = this.state.itemList\r\n    let selectedItems = this.state.selectedItems\r\n\r\n    if(type){\r\n        if(!items[index].selected){\r\n            items[index].selected = type\r\n            selectedItems = selectedItems + 1\r\n\t\t}\r\n\t\t\r\n\t\tif(selectedItems == 1 && Capacitor.isNative){\r\n\t\t\tPlugins.Haptics.impact(HapticsImpactStyle.Light)\r\n\t\t}\r\n    }\r\n    else{\r\n        if(items[index].selected){\r\n            items[index].selected = type\r\n            selectedItems = selectedItems - 1\r\n        }\r\n    }\r\n\r\n    return this.setState({\r\n        itemList: items,\r\n        selectedItems\r\n    })\r\n}\r\n\r\nexport function clearSelectedItems(){\r\n    let items = this.state.itemList\r\n\r\n    for(let i = 0; i < items.length; i++){\r\n        items[i].selected = false\r\n    }\r\n\r\n    return this.setState({\r\n        itemList: items,\r\n        selectedItems: 0\r\n    })\r\n}\r\n\r\nexport async function selectItemsAction(event){\r\n    event.persist()\r\n\r\n\tlet appLang = this.state.lang\r\n\tlet customElementId = utils.generateRandomClassName()\r\n\tlet selectedItemsDoesNotContainFolder = utils.selectedItemsDoesNotContainFolder(this.state.itemList)\r\n\t\r\n\tlet inner = \"\"\r\n\r\n\tif(window.location.href.indexOf(\"shared-in\") !== -1){\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.removeSelectedItemsFromSharedIn()\">` + language.get(appLang, \"removeFromShared\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\telse if(window.location.href.indexOf(\"shared-out\") !== -1){\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.stopSharingSelectedItems()\">` + language.get(appLang, \"stopSharing\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\telse if(window.location.href.indexOf(\"trash\") !== -1){\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.restoreSelectedItems()\">` + language.get(appLang, \"restoreItem\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\telse{\r\n\t\tinner = `\r\n\t\t\t<ion-list>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.selectAllItems()\">` + language.get(appLang, \"selectAll\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.unselectAllItems()\">` + language.get(appLang, \"unselectAll\") + `</ion-item>\r\n\t\t\t\t` + (selectedItemsDoesNotContainFolder ? `<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.storeSelectedItemsOffline()\">` + language.get(appLang, \"storeSelectedItemsOffline\") + `</ion-item>` : ``) + `\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.moveSelectedItems()\">` + language.get(appLang, \"moveItem\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.trashSelectedItems()\">` + language.get(appLang, \"trashItem\") + `</ion-item>\r\n\t\t\t\t<ion-item lines=\"none\" detail=\"false\" button onClick=\"window.customFunctions.dismissPopover()\">` + language.get(appLang, \"close\") + `</ion-item>\r\n\t\t\t</ion-list>\r\n\t\t`\r\n\t}\r\n\r\n    window.customElements.define(customElementId, class ModalContent extends HTMLElement {\r\n        connectedCallback(){\r\n            this.innerHTML = inner\r\n        }\r\n    })\r\n\r\n    let popover = await popoverController.create({\r\n        component: customElementId,\r\n        event: event\r\n    })\r\n\r\n    return popover.present()\r\n}\r\n\r\nexport async function previewItem(item, lastModalPreviewType = undefined){\r\n    if(item.type !== \"file\"){\r\n\t\treturn false\r\n\t}\r\n\r\n\tif(Capacitor.isNative && typeof lastModalPreviewType == \"undefined\"){\r\n        if(this.state.settings.onlyWifi){\r\n            let networkStatus = await Plugins.Network.getStatus()\r\n\r\n            if(networkStatus.connectionType !== \"wifi\"){\r\n                return this.spawnToast(language.get(this.state.lang, \"onlyWifiError\"))\r\n            }\r\n        }\r\n    }\r\n\r\n\tif(typeof window.customVariables.offlineSavedFiles[item.uuid] !== \"undefined\" && typeof lastModalPreviewType == \"undefined\"){\r\n\t\tthis.getDownloadDir(true, item.uuid, (err, dirObj) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"))\r\n\t\t\t}\r\n\r\n\t\t\tFileOpener.open(dirObj.uri.uri + \"/\" + item.name, item.mime).then(() => {\r\n\t\t\t\tconsole.log(dirObj.uri.uri + \"/\" + item.name, item.mime)\r\n\t\t\t}).catch((err) => {\r\n\t\t\t\tconsole.log(err)\r\n\t\t\t\tconsole.log(dirObj.uri.uri + \"/\" + item.name, item.mime)\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"noAppFoundToOpenFile\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\telse{\r\n\t\tlet nameEx = item.name.split(\".\")\r\n\t\tlet previewType = utils.getFilePreviewType(nameEx[nameEx.length - 1])\r\n\r\n\t\tif(previewType == \"none\"){\r\n\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t}\r\n\r\n\t\tif(item.size > ((1024 * 1024) * 64)){\r\n\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t}\r\n\r\n\t\tconst gotPreviewData = async (dataArray) => {\r\n\t\t\tlet blob = new Blob([dataArray], {\r\n\t\t\t\ttype: item.mime,\r\n\t\t\t\tname: item.name\r\n\t\t\t})\r\n\r\n\t\t\tif(typeof window.customVariables.currentPreviewURL !== \"undefined\"){\r\n\t\t\t\twindow.customVariables.urlCreator.revokeObjectURL(window.customVariables.currentPreviewURL)\r\n\t\t\t}\r\n\r\n\t\t\twindow.customVariables.currentPreviewURL = window.customVariables.urlCreator.createObjectURL(blob)\r\n\r\n\t\t\tlet previewModalContent = ``\r\n\r\n\t\t\tif(previewType == \"image\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow preview-header-hidden\" style=\"position: absolute; display: none;\" onClick=\"window.customFunctions.togglePreviewHeader(true)\">\r\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\r\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\r\n\t\t\t\t\t\t\t<ion-slide>\r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t\t\t<img id=\"preview-img\" src=\"` + window.customVariables.currentPreviewURL + `\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh;\">\r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t</ion-slide>\r\n\t\t\t\t\t\t</ion-slides>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"video\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute;\">\r\n\t\t\t\t\t\t<ion-toolbar style=\"--background: black; color: white;\">\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\r\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\r\n\t\t\t\t\t\t\t<ion-slide>\r\n\t\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t\t\t<video id=\"preview-video\" style=\"width: auto; height: auto; max-width: 100vw; max-height: 100vh; margin-top: 56px;\" src=\"` + window.customVariables.currentPreviewURL + `\" autoplay preload controls></video>\r\n\t\t\t\t\t\t\t\t</center>\r\n\t\t\t\t\t\t\t</ion-slide>\r\n\t\t\t\t\t\t</ion-slides>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"audio\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header class=\"ion-header-no-shadow\" style=\"position: absolute;\">\r\n\t\t\t\t\t\t<ion-toolbar style=\"--background: transparent; color: white;\">\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\" style=\"color: white;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content style=\"--background: black;\" fullscreen>\r\n\t\t\t\t\t\t<ion-slides pager=\"false\" style=\"height: 100%; width: 100vw;\" id=\"slider\" scrollbar=\"false\">\r\n\t\t\t\t\t\t\t<ion-slide>\r\n\t\t\t\t\t\t\t\t<audio autoplay preload controls>\r\n\t\t\t\t\t\t\t\t\t<source src=\"` + window.customVariables.currentPreviewURL + `\" type=\"audio/mpeg\">\r\n\t\t\t\t\t\t\t\t</audio>\r\n\t\t\t\t\t\t\t</ion-slide>\r\n\t\t\t\t\t\t</ion-slides>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"code\" || previewType == \"text\"){\r\n\t\t\t\tlet text = new TextDecoder().decode(dataArray).split(\"<\").join(\"&lt;\")\r\n\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header>\r\n\t\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content fullscreen style=\"-webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">\r\n\t\t\t\t\t\t<pre style=\"width: 100vw; height: 100%; margin-top: 0px; padding: 10px; -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;\">` + text + `</pre>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\t\t\telse if(previewType == \"pdf\"){\r\n\t\t\t\tpreviewModalContent = `\r\n\t\t\t\t\t<ion-header>\r\n\t\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t\t` + item.name + `\r\n\t\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t\t\t<ion-buttons slot=\"end\">\r\n\t\t\t\t\t\t\t\t<ion-button onclick=\"window.customFunctions.openItemActionSheetFromJSON('` + window.btoa(JSON.stringify(item)) + `')\">\r\n\t\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.ellipsisVertical + `\"></ion-icon>\r\n\t\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t\t</ion-header>\r\n\t\t\t\t\t<ion-content fullscreen>\r\n\t\t\t\t\t\t<div id=\"pdf-viewer\" style=\"width: 100%; height: 100%; overflow: scroll;\"></div>\r\n\t\t\t\t\t</ion-content>\r\n\t\t\t\t`\r\n\t\t\t}\r\n\r\n\t\t\tif(previewModalContent.length <= 8){\r\n\t\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t\t}\r\n\r\n\t\t\tconst setupBars = async () => {\r\n\t\t\t\tif(previewType == \"image\" || previewType == \"video\" || previewType == \"audio\"){\r\n\t\t\t\t\tthis.setupStatusbar(\"image/video\")\r\n\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tlet modal = await modalController.getTop()\r\n\t\r\n\t\t\t\t\t\tmodal.onDidDismiss().then(() => {\r\n\t\t\t\t\t\t\tthis.setupStatusbar()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst setupSlider = (lastPreviewType) => {\r\n\t\t\t\tlet slider = document.getElementById(\"slider\")\r\n\r\n\t\t\t\tif(slider == null){\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet itemList = this.state.itemList\r\n\r\n\t\t\t\tconst getPrevOrNextItem = (type) => {\r\n\t\t\t\t\tlet step = 1\r\n\t\t\t\t\tlet max = 128\r\n\t\t\t\t\tlet tries = 0\r\n\r\n\t\t\t\t\tconst getItemRecursive = (type) => {\r\n\t\t\t\t\t\tif(tries > max){\r\n\t\t\t\t\t\t\treturn undefined\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttries += 1\r\n\r\n\t\t\t\t\t\tfor(let i = 0; i < itemList.length; i++){\r\n\t\t\t\t\t\t\tif(itemList[i].uuid == item.uuid){\r\n\t\t\t\t\t\t\t\tlet item = undefined\r\n\t\t\t\t\t\t\t\tlet listIndex = undefined\r\n\r\n\t\t\t\t\t\t\t\tif(type == \"prev\"){\r\n\t\t\t\t\t\t\t\t\tlistIndex = (i - step)\r\n\r\n\t\t\t\t\t\t\t\t\titem = itemList[listIndex]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\tlistIndex = (i + step)\r\n\r\n\t\t\t\t\t\t\t\t\titem = itemList[listIndex]\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif(typeof item == \"undefined\"){\r\n\t\t\t\t\t\t\t\t\tstep += 1\r\n\r\n\t\t\t\t\t\t\t\t\treturn getItemRecursive(type)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\tlet thisNameEx = item.name.split(\".\")\r\n\t\t\t\t\t\t\t\t\tlet thisPreviewType = utils.getFilePreviewType(thisNameEx[thisNameEx.length - 1])\r\n\r\n\t\t\t\t\t\t\t\t\tif(thisPreviewType == lastPreviewType){\r\n\t\t\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t\t\titem,\r\n\t\t\t\t\t\t\t\t\t\t\tlistIndex\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\tstep += 1\r\n\r\n\t\t\t\t\t\t\t\t\t\treturn getItemRecursive(type)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn getItemRecursive(type)\r\n\t\t\t\t}\r\n        \r\n\t\t\t\tslider.options = {\r\n\t\t\t\t\tfreeMode: false\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet offset = 75\r\n\t\t\t\tlet offsetY = 150\r\n\t\t\t\tlet xDown, yDown\r\n\r\n\t\t\t\tslider.addEventListener(\"touchstart\", (e) => {\r\n\t\t\t\t\tlet firstTouch = getTouch(e)\r\n\r\n\t\t\t\t\txDown = firstTouch.clientX\r\n\t\t\t\t\tyDown = firstTouch.clientY\r\n\t\t\t\t})\r\n\r\n\t\t\t\tslider.addEventListener(\"touchend\", (e) => {\r\n\t\t\t\t\tif(!xDown || !yDown){\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet {\r\n\t\t\t\t\t\tclientX: xUp,\r\n\t\t\t\t\t\tclientY: yUp\r\n\t\t\t\t\t} = getTouch(e)\r\n\r\n\t\t\t\t\tlet xDiff = xDown - xUp\r\n\t\t\t\t\tlet yDiff = yDown - yUp\r\n\t\t\t\t\tlet xDiffAbs = Math.abs(xDown - xUp)\r\n\t\t\t\t\tlet yDiffAbs = Math.abs(yDown - yUp)\r\n\r\n\t\t\t\t\tif(Math.max(xDiffAbs, yDiffAbs) < offset){\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(xDiffAbs > yDiffAbs){\r\n\t\t\t\t\t\tif(xDiff > 0){\r\n\t\t\t\t\t\t\tlet nextItem = getPrevOrNextItem(\"next\")\r\n\r\n\t\t\t\t\t\t\tif(typeof nextItem == \"undefined\"){\r\n\t\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\t\tscrollToIndex: nextItem.listIndex\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\treturn this.previewItem(nextItem.item, lastPreviewType)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tlet prevItem = getPrevOrNextItem(\"prev\")\r\n\r\n\t\t\t\t\t\t\tif(typeof prevItem == \"undefined\"){\r\n\t\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\t\tscrollToIndex: prevItem.listIndex\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\treturn this.previewItem(prevItem.item, lastPreviewType)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif(xDiffAbs < yDiffAbs && Math.max(xDiffAbs, yDiffAbs) > offsetY){\r\n\t\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false\r\n\t\t\t\t})\r\n\r\n\t\t\t\tconst getTouch = (e) => {\r\n\t\t\t\t\treturn e.changedTouches[0]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst loadPdf = async () => {\r\n\t\t\t\tlet canvasContainer = document.getElementById(\"pdf-viewer\")\r\n\r\n\t\t\t\tif(typeof window.pdfjsLib == \"undefined\"){\r\n\t\t\t\t\treturn window.customFunctions.dismissModal()\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.pdfjsLib.GlobalWorkerOptions.workerSrc = \"assets/pdf/build/pdf.worker.js\"\r\n\r\n\t\t\t\tlet loader = await loadingController.create({\r\n\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t})\r\n\r\n\t\t\t\tloader.present()\r\n        \r\n\t\t\t\tfunction renderPage(page){\r\n\t\t\t\t\tlet viewport = page.getViewport({\r\n\t\t\t\t\t\tscale: 2\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tlet canvas = document.createElement('canvas')\r\n\t\t\t\t\tlet ctx = canvas.getContext('2d')\r\n\r\n\t\t\t\t\tlet renderContext = {\r\n\t\t\t\t\t\tcanvasContext: ctx,\r\n\t\t\t\t\t\tviewport: viewport\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcanvas.height = viewport.height\r\n\t\t\t\t\tcanvas.width = viewport.width\r\n\r\n\t\t\t\t\tcanvasContainer.appendChild(canvas)\r\n\t\t\t\t\t\r\n\t\t\t\t\tpage.render(renderContext)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction renderPages(pdfDoc){\r\n\t\t\t\t\tif(typeof loader !== \"undefined\"){\r\n\t\t\t\t\t\tloader.dismiss()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(let i = 1; i <= pdfDoc.numPages; i++){\r\n\t\t\t\t\t\tpdfDoc.getPage(i).then(renderPage)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet loadingTask = window.pdfjsLib.getDocument({\r\n\t\t\t\t\tdata: dataArray\r\n\t\t\t\t})\r\n\r\n\t\t\t\tloadingTask.promise.then(renderPages).catch((err) => {\r\n\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\treturn window.customFunctions.dismissModal()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof lastModalPreviewType !== \"undefined\"){\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar currentModal = document.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0]\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e){\r\n\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\r\n\t\t\t\t\treturn this.spawnItemActionSheet(item)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrentModal.innerHTML = previewModalContent\r\n\r\n\t\t\t\tif(previewType == \"pdf\"){\r\n\t\t\t\t\tloadPdf()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetupBars()\r\n\t\t\t\tsetupSlider(previewType)\r\n\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tlet modalId = \"preview-modal-\" + utils.generateRandomClassName()\r\n\r\n\t\t\t\tcustomElements.define(modalId, class ModalContent extends HTMLElement {\r\n\t\t\t\t\tconnectedCallback() {\r\n\t\t\t\t\t\tthis.innerHTML = previewModalContent\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tvar modal = await modalController.create({\r\n\t\t\t\t\tcomponent: modalId,\r\n\t\t\t\t\tswipeToClose: true,\r\n\t\t\t\t\tshowBackdrop: false,\r\n\t\t\t\t\tbackdropDismiss: false,\r\n\t\t\t\t\tcssClass: \"modal-fullscreen\"\r\n\t\t\t\t})\r\n\r\n\t\t\t\tawait modal.present()\r\n\r\n\t\t\t\tif(Capacitor.isNative){\r\n\t\t\t\t\tCapacitor.Plugins.Keyboard.hide()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(previewType == \"image\" || previewType == \"video\" || previewType == \"audio\"){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tdocument.querySelectorAll(\".modal-fullscreen > .modal-wrapper\")[0].childNodes[0].style.backgroundColor = \"black\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(previewType == \"pdf\"){\r\n\t\t\t\t\tloadPdf()\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tsetupBars()\r\n\t\t\t\tsetupSlider(previewType)\r\n\t\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet loading = await loadingController.create({\r\n\t\t\tmessage: \"\" //language.get(this.state.lang, \"loadingPreview\")\r\n\t\t})\r\n\r\n\t\tloading.present()\r\n\r\n\t\tthis.downloadPreview(item, (chunksDone) => {\r\n\t\t\t//console.log(chunksDone)\r\n\t\t}, (err, dataArray) => {\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileNoPreviewAvailable\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\r\n\t\t\treturn gotPreviewData(dataArray)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport async function dirExists(name, parent, callback){\r\n\tif(parent == null){\r\n\t\tparent = \"base\"\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/exists\", {\r\n\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\tparent,\r\n\t\t\tnameHashed: utils.hashFn(name.toLowerCase())\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\treturn callback(e)\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\treturn callback(res.message)\r\n\t}\r\n\r\n\treturn callback(null, res.data.exists, res.data.uuid)\r\n}\r\n\r\nexport async function moveFolder(folder, destination, showLoader){\r\n\tif(folder.parent == destination){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"))\r\n\t}\r\n\r\n\tif(utils.currentParentFolder() == \"base\"){\r\n\t\tif(folder.uuid == \"default\" || folder.name.toLowerCase() == \"filen sync\"){\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"thisFolderCannotBeMoved\")) \r\n\t\t}\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\tthis.dirExists(folder.name, destination, async (err, exists, existsUUID) => {\r\n\t\tif(err){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(exists){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"folderMoveAlreadyExistsHere\", true, [\"__NAME__\"], [folder.name]))\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/move\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: folder.uuid,\r\n\t\t\t\tfolderUUID: destination\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\treturn this.spawnToast(res.message)\r\n\t\t}\r\n\r\n\t\tutils.checkIfItemParentIsBeingShared(destination, \"folder\", {\r\n\t\t\tname: folder.name\r\n\t\t}, () => {\r\n\t\t\tthis.spawnToast(language.get(this.state.lang, \"folderMoved\", true, [\"__NAME__\"], [folder.name]))\r\n\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tif(utils.currentParentFolder() == destination){\r\n\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t}\r\n\t\t\t}, 500)\r\n\r\n\t\t\treturn true\r\n\t\t})\r\n\t})\r\n}\r\n\r\nexport async function moveFile(file, destination, showLoader){\r\n\tif(file.parent == destination){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"moveFileOrFolderSameDestination\"))\r\n\t}\r\n\r\n\tif(destination == \"trash\" || destination == \"base\" || destination == \"shared-in\" || destination == \"shared-out\"){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotMoveFileHere\"))\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\tthis.fileExists(file.name, destination, async (err, exists, existsUUID) => {\r\n\t\tif(err){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(exists){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileMoveAlreadyExistsHere\", true, [\"__NAME__\"], [file.name]))\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/move\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tfileUUID: file.uuid,\r\n\t\t\t\tfolderUUID: destination\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t}\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\treturn this.spawnToast(res.message)\r\n\t\t}\r\n\r\n\t\tutils.checkIfItemParentIsBeingShared(destination, \"file\", {\r\n\t\t\tuuid: file.uuid,\r\n\t\t\tname: file.name,\r\n\t\t\tsize: parseInt(file.size),\r\n\t\t\tmime: file.mime,\r\n\t\t\tkey: file.key\r\n\t\t}, () => {\r\n\t\t\tthis.spawnToast(language.get(this.state.lang, \"fileMoved\", true, [\"__NAME__\"], [file.name]))\r\n\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tif(utils.currentParentFolder() == destination){\r\n\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t}\r\n\t\t\t}, 500)\r\n\r\n\t\t\treturn true\r\n\t\t})\r\n\t})\r\n}\r\n\r\nexport function moveItem(item){\r\n\tthis.spawnMoveToast((cancelled, destination) => {\r\n\t\tif(cancelled){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\treturn this.moveFile(item, destination, true)\r\n\t\t}\r\n\t\telse{\r\n\t\t\treturn this.moveFolder(item, destination, true)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport async function renameItem(item){\r\n\tlet parent = utils.currentParentFolder()\r\n\r\n\tif(parent == \"base\"){\r\n\t\tif(item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\"){\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotRenameItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t}\r\n\t}\r\n\r\n\tthis.spawnRenamePrompt(item, async (cancelled, newName) => {\r\n\t\tif(cancelled){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tif(item.name == newName){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\tnewName = utils.removeIllegalCharsFromString(newName)\r\n\r\n\t\t\tif(utils.nameRegex(newName) || utils.checkIfNameIsBanned(newName) || utils.fileNameValidationRegex(newName)){\r\n\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"invalidFileName\"))\r\n\t\t\t}\r\n\r\n\t\t\tlet nameEx = item.name.split(\".\")\r\n\t\t\tlet fileExt = nameEx[nameEx.length - 1]\r\n\t\t\tlet renameWithDot = false\r\n\r\n\t\t\tif(item.name.indexOf(\".\") !== -1){\r\n\t\t\t\trenameWithDot = true\r\n\t\t\t}\r\n\r\n\t\t\tthis.fileExists(newName, parent, async (err, exists, existsUUID) => {\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(exists){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(renameWithDot){\r\n\t\t\t\t\tnewName = newName + \".\" + fileExt\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/rename\", {\r\n\t\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\t\tuuid: item.uuid,\r\n\t\t\t\t\t\tname: utils.cryptoJSEncrypt(newName, item.key),\r\n\t\t\t\t\t\tnameHashed: utils.hashFn(newName.toLowerCase()),\r\n\t\t\t\t\t\tmetaData: utils.cryptoJSEncrypt(JSON.stringify({\r\n\t\t\t\t\t\t\tname: newName,\r\n\t\t\t\t\t\t\tsize: parseInt(item.size),\r\n\t\t\t\t\t\t\tmime: item.mime,\r\n\t\t\t\t\t\t\tkey: item.key\r\n\t\t\t\t\t\t}), this.state.userMasterKeys[this.state.userMasterKeys.length - 1])\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e){\r\n\t\t\t\t\tconsole.log(e)\r\n\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRenameFile\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.checkIfItemIsBeingSharedForRename(\"file\", parent, {\r\n\t\t\t\t\tname: newName,\r\n\t\t\t\t\tsize: parseInt(item.size),\r\n\t\t\t\t\tmime: item.mime,\r\n\t\t\t\t\tkey: item.key\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\tthis.spawnToast(language.get(this.state.lang, \"fileRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]))\r\n\r\n\t\t\t\t\tdelete window.customVariables.cachedFiles[item.uuid]\r\n\r\n\t\t\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\t\t\tif(utils.currentParentFolder() == parent){\r\n\t\t\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500)\r\n\r\n\t\t\t\t\tif(typeof window.customVariables.offlineSavedFiles !== \"undefined\" && Capacitor.isNative){\r\n\t\t\t\t\t\tthis.getDownloadDir(true, item.uuid, async (err, dirObj) => {\r\n\t\t\t\t\t\t\tif(err){\r\n\t\t\t\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"))\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\t\tawait Plugins.Filesystem.rename({\r\n\t\t\t\t\t\t\t\t\tfrom: dirObj + \"/\" + item.name,\r\n\t\t\t\t\t\t\t\t\tto: dirObj + \"/\" +  newName,\r\n\t\t\t\t\t\t\t\t\tdirectory: dirObj.directory\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch(e){\r\n\t\t\t\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRenameFileLocally\"))\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn console.log(\"File renamed locally\")\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tnewName = utils.removeIllegalCharsFromString(newName)\r\n\r\n\t\t\tif(utils.checkIfNameIsBanned(newName) || utils.folderNameRegex(newName) || utils.fileNameValidationRegex(newName)){\r\n\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"invalidFolderName\"))\r\n\t\t\t}\r\n\r\n\t\t\tthis.dirExists(newName, parent, async (err, exists, existsUUID) => {\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(exists){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"folderRenameAlreadyExists\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry{\r\n\t\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/rename\", {\r\n\t\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\t\tuuid: item.uuid,\r\n\t\t\t\t\t\tname: utils.cryptoJSEncrypt(JSON.stringify({\r\n\t\t\t\t\t\t\tname: newName,\r\n\t\t\t\t\t\t}), this.state.userMasterKeys[this.state.userMasterKeys.length - 1]),\r\n\t\t\t\t\t\tnameHashed: utils.hashFn(newName.toLowerCase())\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e){\r\n\t\t\t\t\tconsole.log(e)\r\n\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRenameFolder\"))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.checkIfItemIsBeingSharedForRename(\"folder\", parent, {\r\n\t\t\t\t\tname: newName\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\t\tthis.spawnToast(language.get(this.state.lang, \"folderRenamed\", true, [\"__NAME__\", \"__TO__\"], [item.name, newName]))\r\n\r\n\t\t\t\t\tdelete window.customVariables.cachedFolders[item.uuid]\r\n\r\n\t\t\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\t\t\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\t\t\tif(utils.currentParentFolder() == parent){\r\n\t\t\t\t\t\t\tthis.updateItemList()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500)\r\n\r\n\t\t\t\t\treturn true\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport async function moveSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tthis.spawnMoveToast((cancelled, destination) => {\r\n\t\tif(cancelled){\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\tif(items[i].type == \"file\"){\r\n\t\t\t\tthis.moveFile(items[i], destination, true)\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tthis.moveFolder(items[i], destination, true)\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}\r\n\r\nexport async function trashSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tlet alert = await alertController.create({\r\n\t\theader: language.get(this.state.lang, \"trashItemHeader\"),\r\n\t\tmessage: language.get(this.state.lang, \"trashItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\r\n\t\tbuttons: [\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\trole: \"cancel\",\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"alertOkButton\"),\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\titems.forEach((item) => {\r\n\t\t\t\t\t\tthis.trashItem(item, false)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]\r\n\t})\r\n\r\n\treturn alert.present()\r\n}\r\n\r\nexport async function restoreSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tlet alert = await alertController.create({\r\n\t\theader: language.get(this.state.lang, \"restoreItemsHeader\"),\r\n\t\tmessage: language.get(this.state.lang, \"restoreItemsConfirmMessage\", true, [\"__COUNT__\"], [items.length]),\r\n\t\tbuttons: [\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\trole: \"cancel\",\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttext: language.get(this.state.lang, \"alertOkButton\"),\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\titems.forEach((item) => {\r\n\t\t\t\t\t\tthis.restoreItem(item, false)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]\r\n\t})\r\n\r\n\treturn alert.present()\r\n}\r\n\r\nexport function getSelectedItems(){\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet items = this.state.itemList.filter((item) => {\r\n\t\t\treturn item.selected === true\r\n\t\t})\r\n\r\n\t\treturn resolve(items)\r\n\t})\r\n}\r\n\r\nexport async function restoreItem(item, showLoader){\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\tif(item.type == \"file\"){\r\n\t\tthis.fileExists(item.name, item.parent, async (err, exists, existsUUID) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\r\n\t\t\tif(exists){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"fileExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/restore\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: item.uuid\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(!res.status){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\t\t\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\t\t\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tthis.updateItemList()\r\n\t\t\t}, 500)\r\n\t\t\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]))\r\n\t\t})\r\n\t}\r\n\telse{\r\n\t\tthis.dirExists(item.name, item.parent, async (err, exists, existsUUID) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\r\n\t\t\tif(exists){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"folderExistsAtRestoreDestination\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/restore\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: item.uuid\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(!res.status){\r\n\t\t\t\tif(showLoader){\r\n\t\t\t\t\tloading.dismiss()\r\n\t\t\t\t}\r\n\t\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotRestoreItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(showLoader){\r\n\t\t\t\tloading.dismiss()\r\n\t\t\t}\r\n\t\t\r\n\t\t\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\t\t\r\n\t\t\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\t\t\tthis.updateItemList()\r\n\t\t\t}, 500)\r\n\t\t\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemRestored\", true, [\"__NAME__\"], [item.name]))\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport async function trashItem(item, showLoader){\r\n\tif(utils.currentParentFolder() == \"base\"){\r\n\t\tif(item.uuid == \"default\" || item.name.toLowerCase() == \"filen sync\"){\r\n\t\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotTrashItem\", true, [\"__NAME__\"], [item.name]))\r\n\t\t}\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\t\r\n\t\tloading.present()\r\n\t}\r\n\r\n\ttry{\r\n\t\tif(item.type == \"file\"){\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/file/trash\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: item.uuid\r\n\t\t\t})\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/dir/trash\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid: item.uuid\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotTrashItem\", true, [\"__NAME__\"], [item.name]))\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tloading.dismiss()\r\n\t}\r\n\r\n\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\tthis.updateItemList()\r\n\t}, 500)\r\n\r\n\treturn this.spawnToast(language.get(this.state.lang, \"itemTrashed\", true, [\"__NAME__\"], [item.name]))\r\n}\r\n\r\nexport async function shareItemWithEmail(email, uuid, type, callback){\r\n\tif(email == this.state.userEmail){\r\n\t\treturn callback(language.get(this.state.lang, \"cannotShareWithSelf\"))\r\n\t}\r\n\r\n\tlet loading = await loadingController.create({\r\n\t\tmessage: \"\"\r\n\t})\r\n\r\n\tloading.present()\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/publicKey/get\", {\r\n\t\t\temail\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(e)\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(res.message)\r\n\t}\r\n\r\n\tlet userPubKey = res.data.publicKey\r\n\r\n\tif(userPubKey == null){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]))\r\n\t}\r\n\r\n\tif(userPubKey.length <= 1){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(language.get(this.state.lang, \"shareItemUserNotFound\", true, [\"__EMAIL__\"], [email]))\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar usrPubKey = await window.crypto.subtle.importKey(\"spki\", utils._base64ToArrayBuffer(userPubKey), {\r\n\t\t\tname: \"RSA-OAEP\",\r\n\t\t  \thash: \"SHA-512\"\r\n\t  \t}, true, [\"encrypt\"])\r\n\t}\r\n\tcatch(e){\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(e)\r\n\t}\r\n\r\n\tif(type == \"file\"){\r\n\t\tif(typeof window.customVariables.cachedFiles[uuid] == \"undefined\"){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(language.get(this.state.lang, \"shareItemFileNotFound\", true, [\"__NAME__\"], [uuid]))\r\n\t\t}\r\n\r\n\t\tlet fileName = window.customVariables.cachedFiles[uuid].name\r\n\t\tlet fileSize = window.customVariables.cachedFiles[uuid].size\r\n\t\tlet fileMime = window.customVariables.cachedFiles[uuid].mime\r\n\t\tlet fileKey = window.customVariables.cachedFiles[uuid].key\r\n\r\n\t\ttry{\r\n\t\t\tvar encrypted = await window.crypto.subtle.encrypt({\r\n\t\t\t\tname: \"RSA-OAEP\"\r\n\t\t\t}, usrPubKey, new TextEncoder().encode(JSON.stringify({\r\n\t\t\t\tname: fileName,\r\n\t\t\t\tsize: fileSize,\r\n\t\t\t\tmime: fileMime,\r\n\t\t\t\tkey: fileKey\r\n\t\t\t})))\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn console.log(e)\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/share\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid,\r\n\t\t\t\tparent: \"none\",\r\n\t\t\t\temail,\r\n\t\t\t\ttype: \"file\",\r\n\t\t\t\tmetadata: utils.base64ArrayBuffer(encrypted)\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(e)\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(res.message)\r\n\t\t}\r\n\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn callback(null)\r\n\t}\r\n\telse{\r\n\t\ttry{\r\n\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/download/dir\", {\r\n\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\tuuid\r\n\t\t\t})\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(e)\r\n\t\t}\r\n\r\n\t\tif(!res.status){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(res.message)\r\n\t\t}\r\n\r\n\t\tlet shareItems = []\r\n\r\n\t\tlet files = res.data.files\r\n\t\tlet folders = res.data.folders\r\n\r\n\t\tif((files.length + folders.length) > 1000){\r\n\t\t\tloading.dismiss()\r\n\r\n\t\t\treturn callback(language.get(this.state.lang, \"shareTooBigForApp\"))\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < files.length; i++){\r\n\t\t\tlet metadata = utils.decryptFileMetadata(files[i].metadata, this.state.userMasterKeys, files[i].uuid)\r\n\r\n\t\t\tif(metadata.key.length > 0){\r\n\t\t\t\tshareItems.push({\r\n\t\t\t\t\tuuid: files[i].uuid,\r\n\t\t\t\t\tparent: files[i].parent,\r\n\t\t\t\t\tmetadata: {\r\n\t\t\t\t\t\tname: metadata.name,\r\n\t\t\t\t\t\tsize: parseInt(metadata.size),\r\n\t\t\t\t\t\tmime: metadata.mime,\r\n\t\t\t\t\t\tkey: metadata.key\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttype: \"file\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < folders.length; i++){\r\n\t\t\tlet dirName = utils.decryptCryptoJSFolderName(folders[i].name, this.state.userMasterKeys, folders[i].uuid)\r\n\r\n\t\t\tif(dirName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\"){\r\n\t\t\t\tshareItems.push({\r\n\t\t\t\t\tuuid: folders[i].uuid,\r\n\t\t\t\t\tparent: (i == 0 ? \"none\" : folders[i].parent),\r\n\t\t\t\t\tmetadata: dirName,\r\n\t\t\t\t\ttype: \"folder\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet itemsShared = 0\r\n\r\n\t\tfor(let i = 0; i < shareItems.length; i++){\r\n\t\t\tlet item = shareItems[i]\r\n\t\t\tlet itemMetadata = \"\"\r\n\r\n\t\t\tif(item.type == \"file\"){\r\n\t\t\t\titemMetadata = JSON.stringify(item.metadata)\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\titemMetadata = JSON.stringify({\r\n\t\t\t\t\tname: item.metadata\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar encrypted = await window.crypto.subtle.encrypt({\r\n\t\t\t\t\tname: \"RSA-OAEP\"\r\n\t\t\t\t}, usrPubKey, new TextEncoder().encode(itemMetadata))\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\treturn callback(e)\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/share\", {\r\n\t\t\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\t\t\tuuid: item.uuid,\r\n\t\t\t\t\tparent: item.parent,\r\n\t\t\t\t\temail: email,\r\n\t\t\t\t\ttype: item.type,\r\n\t\t\t\t\tmetadata: utils.base64ArrayBuffer(encrypted)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t}\r\n\t\r\n\t\t\tif(!res.status){\r\n\t\t\t\tconsole.log(res.message)\r\n\t\t\t}\r\n\r\n\t\t\titemsShared += 1\r\n\r\n\t\t\tif(itemsShared == shareItems.length){\r\n\t\t\t\tloading.dismiss()\r\n\r\n\t\t\t\treturn callback(null)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport async function shareSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tlet alert = await alertController.create({\r\n        header: language.get(this.state.lang, \"shareItems\"),\r\n        inputs: [\r\n            {\r\n                type: \"text\",\r\n                id: \"share-items-email-input\",\r\n\t\t\t\tname: \"share-items-email-input\",\r\n\t\t\t\tplaceholder: language.get(this.state.lang, \"receiverEmail\")\r\n            }\r\n        ],\r\n        buttons: [\r\n            {\r\n                text: language.get(this.state.lang, \"cancel\"),\r\n                role: \"cancel\",\r\n                handler: () => {\r\n                    return false\r\n                }\r\n            },\r\n            {\r\n                text: language.get(this.state.lang, \"alertOkButton\"),\r\n                handler: async (inputs) => {\r\n\t\t\t\t\tlet email = inputs['share-items-email-input']\r\n\r\n\t\t\t\t\tlet itemsShared = 0\r\n\r\n\t\t\t\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\t\t\t\tlet item = items[i]\r\n\r\n\t\t\t\t\t\tif(item.type == \"folder\" && item.uuid == \"default\"){\r\n\t\t\t\t\t\t\tthis.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tthis.shareItemWithEmail(email, item.uuid, item.type, (err) => {\r\n\t\t\t\t\t\t\t\tif(err){\r\n\t\t\t\t\t\t\t\t\tconsole.log(err)\r\n\t\r\n\t\t\t\t\t\t\t\t\tthis.spawnToast(err.toString())\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t\titemsShared += 1\r\n\t\r\n\t\t\t\t\t\t\t\tif(itemsShared >= items.length){\r\n\t\t\t\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemsShared\", true, [\"__COUNT__\", \"__EMAIL__\"], [items.length, email]))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n                }\r\n            }\r\n        ]\r\n    })\r\n\r\n    await alert.present()\r\n\r\n\tsetTimeout(() => {\r\n\t\ttry{\r\n\t\t\tdocument.querySelector(\"ion-alert input\").focus()\r\n\t\t} catch(e){ }\r\n\t}, 500)\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function shareItem(item){\r\n\tif(item.type == \"folder\" && item.uuid == \"default\"){\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"cannotShareDefaultFolder\"))\r\n\t}\r\n\r\n\tlet alert = await alertController.create({\r\n        header: item.type == \"file\" ? language.get(this.state.lang, \"shareFile\") : language.get(this.state.lang, \"shareFolder\"),\r\n        inputs: [\r\n            {\r\n                type: \"text\",\r\n                id: \"share-item-email-input\",\r\n\t\t\t\tname: \"share-item-email-input\",\r\n\t\t\t\tplaceholder: language.get(this.state.lang, \"receiverEmail\")\r\n            }\r\n        ],\r\n        buttons: [\r\n            {\r\n                text: language.get(this.state.lang, \"cancel\"),\r\n                role: \"cancel\",\r\n                handler: () => {\r\n                    return false\r\n                }\r\n            },\r\n            {\r\n                text: language.get(this.state.lang, \"alertOkButton\"),\r\n                handler: (inputs) => {\r\n\t\t\t\t\tlet email = inputs['share-item-email-input']\r\n\r\n                    this.shareItemWithEmail(email, item.uuid, item.type, (err) => {\r\n\t\t\t\t\t\tif(err){\r\n\t\t\t\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\t\t\t\treturn this.spawnToast(err.toString())\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"itemShared\", true, [\"__NAME__\", \"__WITH__\"], [item.name, email]))\r\n\t\t\t\t\t})\r\n                }\r\n            }\r\n        ]\r\n    })\r\n\r\n    await alert.present()\r\n\r\n\tsetTimeout(() => {\r\n\t\ttry{\r\n\t\t\tdocument.querySelector(\"ion-alert input\").focus()\r\n\t\t} catch(e){ }\r\n\t}, 500)\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function openPublicLinkModal(item){\r\n\tlet loading = await loadingController.create({\r\n\t\tmessage: \"\"\r\n\t})\r\n\r\n\tloading.present()\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/link/status\", {\r\n\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\tfileUUID: item.uuid\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e)\r\n\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tconsole.log(res.message)\r\n\r\n\t\tloading.dismiss()\r\n\r\n\t\treturn this.spawnToast(res.message)\r\n\t}\r\n\r\n\tloading.dismiss()\r\n\r\n\tlet appLang = this.state.lang\r\n\tlet appDarkMode = this.state.darkMode\r\n\tlet modalId = \"public-link-modal-\" + utils.generateRandomClassName()\r\n\r\n\tcustomElements.define(modalId, class ModalContent extends HTMLElement {\r\n\t\tconnectedCallback(){\r\n\t\t\tthis.innerHTML = `\r\n\t\t\t\t<ion-header>\r\n\t\t\t\t\t<ion-toolbar>\r\n\t\t\t\t\t\t<ion-buttons slot=\"start\">\r\n\t\t\t\t\t\t\t<ion-button onClick=\"window.customFunctions.dismissModal()\">\r\n\t\t\t\t\t\t\t\t<ion-icon slot=\"icon-only\" icon=\"` + Ionicons.arrowBack + `\"></ion-icon>\r\n\t\t\t\t\t\t\t</ion-button>\r\n\t\t\t\t\t\t</ion-buttons>\r\n\t\t\t\t\t\t<ion-title>\r\n\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkHeader\", true, [\"__NAME__\"], [item.name]) + `\r\n\t\t\t\t\t\t</ion-title>\r\n\t\t\t\t\t</ion-toolbar>\r\n\t\t\t\t</ion-header>\r\n\t\t\t\t<ion-content style=\"--background: ` + (appDarkMode ? \"#1E1E1E\" : \"white\") + `\" fullscreen>\r\n\t\t\t\t\t<div id=\"enable-public-link-content\" ` + (res.data.enabled && `style=\"display: none;\"`) + `>\r\n\t\t\t\t\t\t<div style=\"position: absolute; left: 50%; top: 32%; transform: translate(-50%, -50%); width: 100%;\"> \r\n\t\t\t\t\t\t\t<center>\r\n\t\t\t\t\t\t\t\t<ion-icon icon=\"` + Ionicons.link + `\" style=\"font-size: 65pt; color: ` + (appDarkMode ? \"white\" : \"gray\") + `;\"></ion-icon>\r\n\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t\t\t<ion-button color=\"primary\" fill=\"solid\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'enable')\">` + language.get(appLang, \"enablePublicLink\") + `</ion-button>\t\r\n\t\t\t\t\t\t\t</center>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div id=\"public-link-enabled-content\" ` + (!res.data.enabled && `style=\"display: none;\"`) + `>\r\n\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t<ion-label>\r\n\t\t\t\t\t\t\t\t` + language.get(appLang, \"publicLinkEnabled\") + `\r\n\t\t\t\t\t\t\t</ion-label>\r\n\t\t\t\t\t\t\t<ion-toggle slot=\"end\" id=\"public-link-enabled-toggle\" onClick=\"window.customFunctions.editItemPublicLink('` + window.btoa(JSON.stringify(item)) + `', 'disable')\" checked></ion-toggle>\r\n\t\t\t\t\t\t</ion-item>\r\n\t\t\t\t\t\t<ion-item lines=\"none\">\r\n\t\t\t\t\t\t\t<ion-input type=\"text\" id=\"public-link-input\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\" value=\"https://filen.io/d/` + res.data.uuid + `#!` + item.key + `\" disabled></ion-input>\r\n                            <ion-buttons slot=\"end\" onClick=\"window.customFunctions.copyPublicLinkToClipboard()\">\r\n                                <ion-button fill=\"solid\" color=\"` + (appDarkMode ? `dark` : `light`) + `\">\r\n                                    ` + language.get(appLang, \"copy\") + `\r\n                                </ion-button>\r\n                            </ion-buttons>\r\n                        </ion-item>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</ion-content>\r\n\t\t\t`\r\n\t\t}\r\n\t})\r\n\r\n\tlet modal = await modalController.create({\r\n\t\tcomponent: modalId,\r\n\t\tswipeToClose: false,\r\n\t\tshowBackdrop: false,\r\n\t\tbackdropDismiss: false,\r\n\t\tcssClass: \"modal-fullscreen\"\r\n\t})\r\n\r\n\treturn modal.present()\r\n}\r\n\r\nexport function makeItemAvailableOffline(offline, item){\r\n\tif(!offline){\r\n\t\tthis.getDownloadDir(true, item.uuid, async (err, dirObj) => {\r\n\t\t\tif(err){\r\n\t\t\t\tconsole.log(err)\r\n\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotGetDownloadDir\"))\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tawait Plugins.Filesystem.rmdir({\r\n\t\t\t\t\tpath: dirObj.path,\r\n\t\t\t\t\tdirectory: dirObj.directory,\r\n\t\t\t\t\trecursive: true\r\n\t\t\t\t})\r\n\r\n\t\t\t\tdelete window.customVariables.offlineSavedFiles[item.uuid]\r\n\t\t\t}\r\n\t\t\tcatch(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\r\n\t\t\t\treturn this.spawnToast(language.get(this.state.lang, \"couldNotDeleteDownloadedFile\", true, [\"__NAME__\"], [item.name]))\r\n\t\t\t}\r\n\r\n\t\t\tlet items = this.state.itemList\r\n\t\t\tlet windowItems = window.customVariables.itemList\r\n\r\n\t\t\tfor(let i = 0; i < items.length; i++){\r\n\t\t\t\tif(items[i].uuid == item.uuid){\r\n\t\t\t\t\titems[i].offline = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor(let i = 0; i < windowItems.length; i++){\r\n\t\t\t\tif(windowItems[i].uuid == item.uuid){\r\n\t\t\t\t\twindowItems[i].offline = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setState({\r\n\t\t\t\titemList: items\r\n\t\t\t})\r\n\r\n\t\t\twindow.customVariables.itemList = windowItems\r\n\t\t\t\r\n\t\t\tif(typeof window.customVariables.cachedFiles[item.uuid] !== \"undefined\"){\r\n\t\t\t\twindow.customVariables.cachedFiles[item.uuid].offline = false\r\n\t\t\t}\r\n\r\n\t\t\tthis.spawnToast(language.get(this.state.lang, \"fileDeletedFromOfflineStorage\", true, [\"__NAME__\"], [item.name]))\r\n\r\n\t\t\twindow.customFunctions.saveOfflineSavedFiles()\r\n\r\n\t\t\treturn this.forceUpdate()\r\n\t\t})\r\n\t}\r\n\telse{\r\n\t\tlet nItem = item\r\n\r\n\t\tnItem.makeOffline = true\r\n\r\n\t\treturn this.queueFileDownload(nItem)\r\n\t}\r\n}\r\n\r\nexport async function removeSharedInItem(item, showLoader){\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\r\n\t\tloading.present()\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/in/remove\", {\r\n\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\tuuid: item.uuid,\r\n\t\t\treceiverId: 0\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tconsole.log(res.message)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(res.message)\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tloading.dismiss()\r\n\t}\r\n\r\n\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\tthis.updateItemList()\r\n\t}, 500)\r\n\r\n\treturn this.spawnToast(language.get(this.state.lang, \"itemRemovedFromSharedIn\", true, [\"__NAME__\"], [item.name]))\r\n}\r\n\r\nexport async function stopSharingItem(item, showLoader){\r\n\tif(showLoader){\r\n\t\tvar loading = await loadingController.create({\r\n\t\t\tmessage: \"\"\r\n\t\t})\r\n\r\n\t\tloading.present()\r\n\t}\r\n\r\n\ttry{\r\n\t\tvar res = await utils.apiRequest(\"POST\", \"/v1/user/shared/item/out/remove\", {\r\n\t\t\tapiKey: this.state.userAPIKey,\r\n\t\t\tuuid: item.uuid,\r\n\t\t\treceiverId: item.receiverId\r\n\t\t})\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(language.get(this.state.lang, \"apiRequestError\"))\r\n\t}\r\n\r\n\tif(!res.status){\r\n\t\tconsole.log(res.message)\r\n\r\n\t\tif(showLoader){\r\n\t\t\tloading.dismiss()\r\n\t\t}\r\n\r\n\t\treturn this.spawnToast(res.message)\r\n\t}\r\n\r\n\tif(showLoader){\r\n\t\tloading.dismiss()\r\n\t}\r\n\r\n\tclearTimeout(window.customVariables.reloadAfterActionTimeout)\r\n\r\n\twindow.customVariables.reloadAfterActionTimeout = setTimeout(() => {\r\n\t\tthis.updateItemList()\r\n\t}, 500)\r\n\r\n\treturn this.spawnToast(language.get(this.state.lang, \"itemStoppedSharing\", true, [\"__NAME__\"], [item.name]))\r\n}\r\n\r\nexport async function removeSelectedItemsFromSharedIn(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tthis.removeSharedInItem(item, false)\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function stopSharingSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tthis.stopSharingItem(item, false)\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function downloadSelectedItems(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\tthis.queueFileDownload(item)\r\n\t\t}\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function storeSelectedItemsOffline(){\r\n\tlet items = await this.getSelectedItems()\r\n\r\n\twindow.customFunctions.dismissPopover()\r\n\twindow.customFunctions.unselectAllItems()\r\n\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tlet item = items[i]\r\n\r\n\t\tif(item.type == \"file\"){\r\n\t\t\titem.makeOffline = true\r\n\r\n\t\t\tthis.queueFileDownload(item)\r\n\t\t}\r\n\t}\r\n\r\n\treturn true\r\n}\r\n\r\nexport async function spawnItemActionSheet(item){\r\n\tlet buttons = undefined\r\n\r\n\tif(item.type == \"folder\"){\r\n\t\tif(window.location.href.indexOf(\"shared-in\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"removeFromShared\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.removeSharedInItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"shared-out\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"stopSharing\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.stopSharingItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"trash\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"restoreItem\"),\r\n\t\t\t\t\ticon: Ionicons.bagAdd,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.restoreItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse{\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"shareItem\"),\r\n\t\t\t\t\ticon: Ionicons.shareSocial,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.shareItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"moveItem\"),\r\n\t\t\t\t\ticon: Ionicons.move,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.moveItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"renameItem\"),\r\n\t\t\t\t\ticon: Ionicons.text,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.renameItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"trashItem\"),\r\n\t\t\t\t\ticon: Ionicons.trash,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn this.trashItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t}\r\n\telse{\r\n\t\tif(window.location.href.indexOf(\"shared-in\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\r\n\t\t\t\t\ticon: Ionicons.save,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\tif(item.offline){\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(false, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(true, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"removeFromShared\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.removeSharedInItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"shared-out\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\r\n\t\t\t\t\ticon: Ionicons.save,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\tif(item.offline){\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(false, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(true, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"stopSharing\"),\r\n\t\t\t\t\ticon: Ionicons.stopCircle,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\tthis.stopSharingItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse if(window.location.href.indexOf(\"trash\") !== -1){\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"restoreItem\"),\r\n\t\t\t\t\ticon: Ionicons.bagAdd,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.restoreItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t\telse{\r\n\t\t\tbuttons = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"shareItem\"),\r\n\t\t\t\t\ticon: Ionicons.shareSocial,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.shareItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"itemPublicLink\"),\r\n\t\t\t\t\ticon: Ionicons.link,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.openPublicLinkModal(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"downloadItem\"),\r\n\t\t\t\t\ticon: Ionicons.download,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.queueFileDownload(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: item.offline ? language.get(this.state.lang, \"removeItemFromOffline\") : language.get(this.state.lang, \"makeItemAvailableOffline\"),\r\n\t\t\t\t\ticon: Ionicons.save,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\tif(item.offline){\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(false, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\treturn this.makeItemAvailableOffline(true, item)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"moveItem\"),\r\n\t\t\t\t\ticon: Ionicons.move,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.moveItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"renameItem\"),\r\n\t\t\t\t\ticon: Ionicons.text,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.renameItem(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"trashItem\"),\r\n\t\t\t\t\ticon: Ionicons.trash,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\twindow.customFunctions.dismissModal()\r\n\t\r\n\t\t\t\t\t\treturn this.trashItem(item, false)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: language.get(this.state.lang, \"cancel\"),\r\n\t\t\t\t\ticon: Ionicons.close,\r\n\t\t\t\t\thandler: () => {\r\n\t\t\t\t\t\treturn actionSheet.dismiss()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t}\r\n\r\n\tlet headerName = item.name\r\n\r\n\tif(headerName.length >= 32){\r\n\t\theaderName = headerName.substring(0, 32) + \"...\"\r\n\t}\r\n\r\n    let actionSheet = await actionSheetController.create({\r\n        header: headerName,\r\n        buttons\r\n    })\r\n\r\n\tawait actionSheet.present()\r\n\t\r\n\tif(Capacitor.isNative){\r\n\t\tsetTimeout(() => {\r\n\t\t\tCapacitor.Plugins.Keyboard.hide()\r\n\t\t}, 500)\r\n\t}\r\n\r\n\treturn true\r\n}"]},"metadata":{},"sourceType":"module"}