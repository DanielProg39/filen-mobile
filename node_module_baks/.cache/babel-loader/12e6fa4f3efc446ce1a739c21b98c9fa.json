{"ast":null,"code":"import { Capacitor, Plugins } from \"@capacitor/core\";\n\nconst CryptoJS = require(\"crypto-js\");\n\nconst striptags = require(\"striptags\");\n\nexport function sanitizeHTML(html) {\n  return striptags(html);\n}\nexport function getRandomArbitrary(min, max) {\n  return Math.floor(Math.random() * (max - min) + min);\n}\nexport function formatBytes(bytes, decimals = 2) {\n  if (bytes === 0) return \"0 Bytes\";\n  let k = 1024;\n  let dm = decimals < 0 ? 0 : decimals;\n  let sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"];\n  let i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + \" \" + sizes[i];\n}\nexport function uuidv4() {\n  // Public Domain/MIT\n  let d = new Date().getTime(); //Timestamp\n\n  let d2 = performance && performance.now && performance.now() * 1000 || 0; //Time in microseconds since page-load or 0 if unsupported\n\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    let r = Math.random() * 16; //random number between 0 and 16\n\n    if (d > 0) {\n      //Use timestamp until depleted\n      r = (d + r) % 16 | 0;\n      d = Math.floor(d / 16);\n    } else {\n      //Use microseconds since page-load if supported\n      r = (d2 + r) % 16 | 0;\n      d2 = Math.floor(d2 / 16);\n    }\n\n    return (c === 'x' ? r : r & 0x3 | 0x8).toString(16);\n  });\n}\nexport function generateRandomString(length = 32) {\n  let result = \"\";\n  let characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * characters.length));\n  }\n\n  return result;\n}\nexport function generateRandomClassName(length = 16) {\n  let result = \"\";\n  let characters = \"abcdefghijklmnopqrstuvwxyz\";\n\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * characters.length));\n  }\n\n  return result + \"-\" + result;\n}\nexport function getAPIServer() {\n  let servers = [\"https://api.filen.io\", \"https://api.filen-1.xyz\", \"https://api.filen-2.xyz\", \"https://api.filen-3.xyz\", \"https://api.filen-4.xyz\", \"https://api.filen-5.xyz\"];\n  return servers[getRandomArbitrary(0, servers.length - 1)];\n}\nexport function fetchWithTimeout(ms, promise) {\n  return new Promise((resolve, reject) => {\n    let timer = setTimeout(() => {\n      return reject(new Error(\"Request timeout after \" + ms + \"ms\"));\n    }, ms);\n    promise.then(value => {\n      clearTimeout(timer);\n      return resolve(value);\n    }).catch(err => {\n      clearTimeout(timer);\n      return reject(err);\n    });\n  });\n}\nexport function backgroundAPIRequest(method, endpoint, data = {}) {\n  let cacheKey = method + endpoint;\n  fetchWithTimeout(60000, fetch(getAPIServer() + endpoint, {\n    method: method.toUpperCase(),\n    cache: \"no-cache\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(data)\n  })).then(response => {\n    response.json().then(obj => {\n      window.customVariables.cachedAPIItemListRequests[cacheKey] = obj;\n      return window.customFunctions.saveAPICache();\n    }).catch(err => {\n      console.log(err);\n    });\n  }).catch(err => {\n    console.log(err);\n  });\n}\nexport function apiRequest(method, endpoint, data = {}) {\n  return new Promise((resolve, reject) => {\n    let cacheKey = method + endpoint;\n    /*let useFastCache = false\r\n      if(method.toUpperCase() == \"POST\"){\r\n        if(endpoint == \"/v1/dir/content\"\r\n        || endpoint == \"/v1/user/shared/in\"\r\n        || endpoint == \"/v1/user/shared/out\"){\r\n            useFastCache = true\r\n        }\r\n    }\r\n      if(useFastCache){\r\n        if(typeof window.customVariables.cachedAPIItemListRequests[cacheKey] !== \"undefined\"){\r\n            try{\r\n                let obj = JSON.parse(window.customVariables.cachedAPIItemListRequests[cacheKey])\r\n                  delete window.customVariables.cachedAPIItemListRequests[cacheKey]\r\n                  backgroundAPIRequest(method, endpoint, data)\r\n                  return obj\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n            }\r\n        }\r\n    }*/\n\n    if (Capacitor.isNative) {\n      if (Plugins.Network.getStatus() == \"none\") {\n        if (typeof window.customVariables.apiCache[cacheKey] !== \"undefined\") {\n          return resolve(window.customVariables.apiCache[cacheKey]);\n        }\n      }\n    }\n\n    fetchWithTimeout(60000, fetch(getAPIServer() + endpoint, {\n      method: method.toUpperCase(),\n      cache: \"no-cache\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    })).then(response => {\n      response.json().then(obj => {\n        if (endpoint == \"/v1/dir/content\" || endpoint == \"/v1/user/baseFolders\" || endpoint == \"/v1/user/shared/in\" || endpoint == \"/v1/user/shared/out\" || endpoint == \"/v1/user/keyPair/info\") {\n          window.customVariables.apiCache[cacheKey] = obj;\n          window.customFunctions.saveAPICache();\n        }\n\n        return resolve(obj);\n      }).catch(err => {\n        console.log(err);\n\n        if (typeof window.customVariables.apiCache[cacheKey] !== \"undefined\") {\n          return resolve(window.customVariables.apiCache[cacheKey]);\n        }\n\n        return reject(err);\n      });\n    }).catch(err => {\n      console.log(err);\n\n      if (typeof window.customVariables.apiCache[cacheKey] !== \"undefined\") {\n        return resolve(window.customVariables.apiCache[cacheKey]);\n      }\n\n      return reject(err);\n    });\n  });\n}\nexport function getDownloadServer() {\n  let servers = [\"https://down.filen-1.xyz\", \"https://down.filen-2.xyz\", \"https://down.filen-3.xyz\", \"https://down.filen-4.xyz\", \"https://down.filen-5.xyz\"];\n  return servers[getRandomArbitrary(0, servers.length - 1)];\n}\nexport function getUploadServer() {\n  let servers = [\"https://up.filen-1.xyz\", \"https://up.filen-2.xyz\", \"https://up.filen-3.xyz\", \"https://up.filen-4.xyz\", \"https://up.filen-5.xyz\"];\n  return servers[getRandomArbitrary(0, servers.length - 1)];\n}\nexport function hashFn(val) {\n  return CryptoJS.SHA1(CryptoJS.SHA512(val).toString()).toString();\n}\nexport function cryptoJSEncrypt(val, key) {\n  return CryptoJS.AES.encrypt(val, key).toString();\n}\nexport function cryptoJSDecrypt(val, key) {\n  return CryptoJS.AES.decrypt(val, key).toString(CryptoJS.enc.Utf8);\n}\nexport function unixTimestamp() {\n  return Math.floor(+new Date() / 1000);\n}\nexport function decryptCryptoJSFolderName(str, userMasterKeys, uuid = undefined) {\n  let cacheKey = \"folder_\" + uuid + \"_\" + str;\n\n  if (window.customVariables.cachedMetadata[cacheKey]) {\n    return window.customVariables.cachedMetadata[cacheKey].name;\n  }\n\n  let folderName = \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\";\n  userMasterKeys = userMasterKeys.reverse();\n  let obj = undefined;\n  userMasterKeys.forEach(key => {\n    try {\n      obj = JSON.parse(CryptoJS.AES.decrypt(str, key).toString(CryptoJS.enc.Utf8));\n\n      if (obj && typeof obj == \"object\") {\n        folderName = obj.name;\n      }\n    } catch (e) {\n      return;\n    }\n  });\n\n  if (folderName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\") {\n    window.customVariables.cachedMetadata[cacheKey] = {\n      name: folderName\n    };\n  }\n\n  return folderName;\n}\nexport async function decryptFolderNamePrivateKey(str, usrPrivKey, uuid = undefined) {\n  let cacheKey = \"folder_\" + uuid + \"_\" + str;\n\n  if (window.customVariables.cachedMetadata[cacheKey]) {\n    return window.customVariables.cachedMetadata[cacheKey].name;\n  }\n\n  let folderName = \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\";\n\n  try {\n    let decrypted = await window.crypto.subtle.decrypt({\n      name: \"RSA-OAEP\"\n    }, usrPrivKey, _base64ToArrayBuffer(str));\n    decrypted = JSON.parse(new TextDecoder().decode(decrypted));\n\n    if (decrypted && typeof decrypted == \"object\") {\n      folderName = decrypted.name;\n    }\n  } catch (e) {\n    console.log(e);\n  }\n\n  if (folderName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\") {\n    window.customVariables.cachedMetadata[cacheKey] = {\n      name: folderName\n    };\n  }\n\n  return folderName;\n}\nexport function decryptFileMetadata(metadata, userMasterKeys, uuid = undefined) {\n  let cacheKey = \"file_\" + uuid + \"_\" + metadata;\n\n  if (window.customVariables.cachedMetadata[cacheKey]) {\n    let file = window.customVariables.cachedMetadata[cacheKey];\n    return {\n      name: file.name,\n      size: file.size,\n      mime: file.mime,\n      key: file.key\n    };\n  }\n\n  let fileName = \"\";\n  let fileSize = 0;\n  let fileMime = \"\";\n  let fileKey = \"\";\n  userMasterKeys = userMasterKeys.reverse();\n  userMasterKeys.forEach(key => {\n    try {\n      let obj = JSON.parse(CryptoJS.AES.decrypt(metadata, key).toString(CryptoJS.enc.Utf8));\n\n      if (obj && typeof obj == \"object\") {\n        fileName = obj.name;\n        fileSize = parseInt(obj.size);\n        fileMime = obj.mime;\n        fileKey = obj.key;\n      }\n    } catch (e) {\n      return;\n    }\n  });\n  let obj = {\n    name: fileName,\n    size: fileSize,\n    mime: fileMime,\n    key: fileKey\n  };\n\n  if (obj.name.length >= 1) {\n    window.customVariables.cachedMetadata[cacheKey] = obj;\n  }\n\n  return obj;\n}\nexport async function decryptFileMetadataPrivateKey(str, usrPrivKey, uuid = undefined) {\n  let cacheKey = \"file_\" + uuid + \"_\" + str;\n\n  if (window.customVariables.cachedMetadata[cacheKey]) {\n    let file = window.customVariables.cachedMetadata[cacheKey];\n    return {\n      name: file.name,\n      size: file.size,\n      mime: file.mime,\n      key: file.key\n    };\n  }\n\n  let fileName = \"\";\n  let fileSize = 0;\n  let fileMime = \"\";\n  let fileKey = \"\";\n\n  try {\n    let decrypted = await window.crypto.subtle.decrypt({\n      name: \"RSA-OAEP\"\n    }, usrPrivKey, _base64ToArrayBuffer(str));\n    decrypted = JSON.parse(new TextDecoder().decode(decrypted));\n\n    if (decrypted && typeof decrypted == \"object\") {\n      fileName = decrypted.name;\n      fileSize = parseInt(decrypted.size);\n      fileMime = decrypted.mime;\n      fileKey = decrypted.key;\n    }\n  } catch (e) {\n    return {\n      name: fileName,\n      size: fileSize,\n      mime: fileMime,\n      key: fileKey\n    };\n  }\n\n  let obj = {\n    name: fileName,\n    size: fileSize,\n    mime: fileMime,\n    key: fileKey\n  };\n\n  if (obj.name.length >= 1) {\n    window.customVariables.cachedMetadata[cacheKey] = obj;\n  }\n\n  return obj;\n}\nexport function base64ArrayBuffer(arrayBuffer) {\n  var base64 = '';\n  var encodings = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n  var bytes = new Uint8Array(arrayBuffer);\n  var byteLength = bytes.byteLength;\n  var byteRemainder = byteLength % 3;\n  var mainLength = byteLength - byteRemainder;\n  var a, b, c, d;\n  var chunk; // Main loop deals with bytes in chunks of 3\n\n  for (var i = 0; i < mainLength; i = i + 3) {\n    // Combine the three bytes into a single integer\n    chunk = bytes[i] << 16 | bytes[i + 1] << 8 | bytes[i + 2]; // Use bitmasks to extract 6-bit segments from the triplet\n\n    a = (chunk & 16515072) >> 18; // 16515072 = (2^6 - 1) << 18\n\n    b = (chunk & 258048) >> 12; // 258048   = (2^6 - 1) << 12\n\n    c = (chunk & 4032) >> 6; // 4032     = (2^6 - 1) << 6\n\n    d = chunk & 63; // 63       = 2^6 - 1\n    // Convert the raw binary segments to the appropriate ASCII encoding\n\n    base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d];\n  } // Deal with the remaining bytes and padding\n\n\n  if (byteRemainder == 1) {\n    chunk = bytes[mainLength];\n    a = (chunk & 252) >> 2; // 252 = (2^6 - 1) << 2\n    // Set the 4 least significant bits to zero\n\n    b = (chunk & 3) << 4; // 3   = 2^2 - 1\n\n    base64 += encodings[a] + encodings[b] + '==';\n  } else if (byteRemainder == 2) {\n    chunk = bytes[mainLength] << 8 | bytes[mainLength + 1];\n    a = (chunk & 64512) >> 10; // 64512 = (2^6 - 1) << 10\n\n    b = (chunk & 1008) >> 4; // 1008  = (2^6 - 1) << 4\n    // Set the 2 least significant bits to zero\n\n    c = (chunk & 15) << 2; // 15    = 2^4 - 1\n\n    base64 += encodings[a] + encodings[b] + encodings[c] + '=';\n  }\n\n  return base64;\n}\nexport function selectedItemsDoesNotContainFolder(items) {\n  for (let i = 0; i < items.length; i++) {\n    if (items[i].type == \"folder\" && items[i].selected) {\n      return false;\n    }\n  }\n\n  return true;\n}\nexport function selectedItemsContainsFolder(items) {\n  for (let i = 0; i < items.length; i++) {\n    if (items[i].type == \"folder\" && items[i].selected) {\n      return true;\n    }\n  }\n\n  return false;\n}\nexport function _base64ToArrayBuffer(base64) {\n  var binary_string = window.atob(base64);\n  var len = binary_string.length;\n  var bytes = new Uint8Array(len);\n\n  for (var i = 0; i < len; i++) {\n    bytes[i] = binary_string.charCodeAt(i);\n  }\n\n  return bytes.buffer;\n}\nexport function fileNameValidationRegex(name) {\n  if (/^(con|prn|aux|nul|com[0-9]|lpt[0-9])$|([<>:\"\\/\\\\|?*])|(\\.|\\s)$/ig.test(name)) {\n    return true;\n  }\n\n  return false;\n}\nexport function checkIfNameIsBanned(name) {\n  let banned = [\"/\", \"\\\\\", \"?\", \"@\", \"$\", \"%\", \"[\", \"]\", \"{\", \"}\", \"&\", '\"', \"'\", \"`\", \"*\", \"=\", \"´\", \"<\", \">\", \":\", \";\", \"|\", \"§\", \"CON\", \"PRN\", \"AUX\", \"NUL\", \"COM1\", \"COM2\", \"COM3\", \"COM4\", \"COM5\", \"COM6\", \"COM7\", \"COM8\", \"COM9\", \"LPT1\", \"LPT2\", \"LPT3\", \"LPT4\", \"LPT5\", \"LPT6\", \"LPT7\", \"LPT8\", \"LPT9\"];\n  let isBanned = false;\n  banned.forEach(ban => {\n    if (name.indexOf(ban) !== -1) {\n      isBanned = true;\n    }\n  });\n  return isBanned;\n}\nexport function removeIllegalCharsFromString(str) {\n  str = str.split(\"'\").join(\"\");\n  str = str.split('\"').join(\"\");\n  str = str.split(\"´\").join(\"\");\n  str = str.split(\"`\").join(\"\");\n  str = str.split(\"<\").join(\"\");\n  str = str.split(\">\").join(\"\");\n  str = str.split(\"!\").join(\"\");\n  str = str.split(\"^\").join(\"\");\n  str = str.split(\":\").join(\"\");\n  str = str.replace(/(<([^>]+)>)/ig, \"\");\n  return str;\n}\nexport function folderNameRegex(name) {\n  if (name.substring(0, 1) == \".\" || name.substring(0, 2) == \"..\") {\n    return true;\n  }\n\n  return false;\n}\nexport function nameRegex(name) {\n  return false;\n}\nexport function isAlphaNumeric(str) {\n  var code, i, len;\n\n  for (i = 0, len = str.length; i < len; i++) {\n    code = str.charCodeAt(i);\n\n    if (!(code > 47 && code < 58) && // numeric (0-9)\n    !(code > 64 && code < 91) && // upper alpha (A-Z)\n    !(code > 96 && code < 123)) {\n      // lower alpha (a-z)\n      return false;\n    }\n  }\n\n  return true;\n}\nexport function convertWordArrayToUint8Array(wordArray) {\n  let arrayOfWords = wordArray.hasOwnProperty(\"words\") ? wordArray.words : [];\n  let length = wordArray.hasOwnProperty(\"sigBytes\") ? wordArray.sigBytes : arrayOfWords.length * 4;\n  let uInt8Array = new Uint8Array(length),\n      index = 0,\n      word,\n      i;\n\n  for (i = 0; i < length; i++) {\n    word = arrayOfWords[i];\n    uInt8Array[index++] = word >> 24;\n    uInt8Array[index++] = word >> 16 & 0xff;\n    uInt8Array[index++] = word >> 8 & 0xff;\n    uInt8Array[index++] = word & 0xff;\n  }\n\n  return uInt8Array;\n}\nexport function convertUint8ArrayToBinaryString(u8Array) {\n  let i,\n      len = u8Array.length,\n      b_str = \"\";\n\n  for (i = 0; i < len; i++) {\n    b_str += String.fromCharCode(u8Array[i]);\n  }\n\n  return b_str;\n}\nexport function Semaphore(max) {\n  var counter = 0;\n  var waiting = [];\n\n  var take = function () {\n    if (waiting.length > 0 && counter < max) {\n      counter++;\n      let promise = waiting.shift();\n      promise.resolve();\n    }\n  };\n\n  this.acquire = function () {\n    if (counter < max) {\n      counter++;\n      return new Promise(resolve => {\n        resolve();\n      });\n    } else {\n      return new Promise((resolve, err) => {\n        waiting.push({\n          resolve: resolve,\n          err: err\n        });\n      });\n    }\n  };\n\n  this.release = function () {\n    counter--;\n    take();\n  };\n\n  this.purge = function () {\n    let unresolved = waiting.length;\n\n    for (let i = 0; i < unresolved; i++) {\n      waiting[i].err('Task has been purged.');\n    }\n\n    counter = 0;\n    waiting = [];\n    return unresolved;\n  };\n}\n/*export function checkIfItemParentIsBeingShared(parentUUID, type, metadata){\r\n    const checkIfIsSharing = async (parent, callback) => {\r\n        if(parent == \"default\" || parent == \"base\"){\r\n            return callback(false)\r\n        }\r\n\r\n        try{\r\n            var res = await apiRequest(\"POST\", \"/v1/share/dir/status\", {\r\n                apiKey: window.customVariables.apiKey,\r\n                uuid: parent\r\n            })\r\n        }\r\n        catch(e){\r\n            console.log(e)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        if(!res.status){\r\n            console.log(res.message)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        return callback(res.data.sharing, res.data.users)\r\n    }\r\n\r\n    checkIfIsSharing(parentUUID, async (status, users) => {\r\n        if(!status){\r\n            return false\r\n        }\r\n\r\n        for(let i = 0; i < users.length; i++){\r\n            let user = users[i]\r\n\r\n            try{\r\n                var usrPubKey = await window.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\r\n                    name: \"RSA-OAEP\",\r\n                    hash: \"SHA-512\"\r\n                }, true, [\"encrypt\"])\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            let mData = \"\"\r\n\r\n            if(type == \"file\"){\r\n                mData = JSON.stringify({\r\n                    name: metadata.name,\r\n                    size: parseInt(metadata.size),\r\n                    mime: metadata.mime,\r\n                    key: metadata.key\r\n                })\r\n            }\r\n            else{\r\n                mData = JSON.stringify({\r\n                    name: metadata.name\r\n                })\r\n            }\r\n            \r\n            try{\r\n                var encrypted = await window.crypto.subtle.encrypt({\r\n                    name: \"RSA-OAEP\"\r\n                }, usrPubKey, new TextEncoder().encode(mData))\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            try{\r\n                var res = await apiRequest(\"POST\", \"/v1/share\", {\r\n                    apiKey: window.customVariables.apiKey,\r\n                    uuid: metadata.uuid,\r\n                    parent: parentUUID,\r\n                    email: user.email,\r\n                    type,\r\n                    metadata: base64ArrayBuffer(encrypted)\r\n                })\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            if(!res.status){\r\n                console.log(res.message)\r\n\r\n                return false\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nexport function checkIfItemIsBeingSharedForRename(type, uuid, metadata){\r\n    const checkIfIsSharing = async (itemUUID, callback) => {\r\n        try{\r\n            var res = await apiRequest(\"POST\", \"/v1/user/shared/item/status\", {\r\n                apiKey: window.customVariables.apiKey,\r\n                uuid: itemUUID\r\n            })\r\n        }\r\n        catch(e){\r\n            console.log(e)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        if(!res.status){\r\n            console.log(res.message)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        return callback(res.data.sharing, res.data.users)\r\n    }\r\n\r\n    checkIfIsSharing(uuid, async (sharing, users) => {\r\n        if(!sharing){\r\n            return false\r\n        }\r\n\r\n        for(let i = 0; i < users.length; i++){\r\n            let user = users[i]\r\n\r\n            try{\r\n                var usrPubKey = await window.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\r\n                    name: \"RSA-OAEP\",\r\n                    hash: \"SHA-512\"\r\n                }, true, [\"encrypt\"])\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            let mData = \"\"\r\n\r\n            if(type == \"file\"){\r\n                mData = JSON.stringify({\r\n                    name: metadata.name,\r\n                    size: parseInt(metadata.size),\r\n                    mime: metadata.mime,\r\n                    key: metadata.key\r\n                })\r\n            }\r\n            else{\r\n                mData = JSON.stringify({\r\n                    name: metadata.name\r\n                })\r\n            }\r\n            \r\n            try{\r\n                var encrypted = await window.crypto.subtle.encrypt({\r\n                    name: \"RSA-OAEP\"\r\n                }, usrPubKey, new TextEncoder().encode(mData))\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            try{\r\n                var res = await apiRequest(\"POST\", \"/v1/user/shared/item/rename\", {\r\n                    apiKey: window.customVariables.apiKey,\r\n                    uuid,\r\n                    receiverId: user.id,\r\n                    metadata: base64ArrayBuffer(encrypted)\r\n                })\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            if(!res.status){\r\n                console.log(res.message)\r\n\r\n                return false\r\n            }\r\n        }\r\n    })\r\n}*/\n\nexport function decryptFolderLinkKey(str, userMasterKeys) {\n  let link = \"\";\n\n  if (userMasterKeys.length > 1) {\n    userMasterKeys = userMasterKeys.reverse();\n  }\n\n  userMasterKeys.forEach(key => {\n    try {\n      let obj = CryptoJS.AES.decrypt(str, key).toString(CryptoJS.enc.Utf8);\n\n      if (obj && typeof obj == \"string\") {\n        if (obj.length >= 16) {\n          link = obj;\n        }\n      }\n    } catch (e) {\n      return;\n    }\n  });\n  return link;\n}\nexport function checkIfItemIsBeingSharedForRename(type, uuid, metaData, optionalCallback) {\n  let shareCheckDone = false;\n  let linkCheckDone = false;\n  let isItDoneInterval = undefined;\n  let callbackFired = false;\n\n  const isItDone = () => {\n    if (shareCheckDone && linkCheckDone) {\n      clearInterval(isItDoneInterval);\n\n      if (typeof optionalCallback == \"function\" && !callbackFired) {\n        callbackFired = true;\n        optionalCallback();\n      }\n\n      return true;\n    }\n  };\n\n  isItDoneInterval = setInterval(isItDone, 100);\n\n  const checkIfIsSharing = (itemUUID, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(false);\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/user/shared/item/status\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: JSON.stringify({\n        apiKey: window.customVariables.apiKey,\n        uuid: itemUUID\n      }),\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            checkIfIsSharing(itemUUID, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        if (!res.status) {\n          callback(false);\n          return console.log(res.message);\n        }\n\n        return callback(res.data.sharing, res.data.users);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          checkIfIsSharing(itemUUID, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  const checkIfIsInFolderLink = (itemUUID, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(false);\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/link/dir/item/status\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: JSON.stringify({\n        apiKey: window.customVariables.apiKey,\n        uuid: itemUUID\n      }),\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            checkIfIsInFolderLink(itemUUID, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        if (!res.status) {\n          callback(false);\n          return console.log(res.message);\n        }\n\n        return callback(res.data.link, res.data.links);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          checkIfIsInFolderLink(itemUUID, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  const renameItem = (data, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(new Error(\"Max requests reached\"));\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/link/dir/item/rename\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: data,\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            renameItem(data, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        return callback(null);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          renameItem(data, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  const shareItem = (data, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(new Error(\"Max requests reached\"));\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/user/shared/item/rename\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: data,\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            shareItem(data, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        return callback(null);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          shareItem(data, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  checkIfIsSharing(uuid, 0, 32, (isSharing, users) => {\n    if (!isSharing) {\n      shareCheckDone = true;\n      return isItDone();\n    }\n\n    let totalUsers = users.length;\n    let doneUsers = 0;\n\n    const doneSharingToUsers = () => {\n      doneUsers += 1;\n\n      if (doneUsers >= totalUsers) {\n        shareCheckDone = true;\n        return isItDone();\n      }\n    };\n\n    users.forEach(user => {\n      window.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\n        name: \"RSA-OAEP\",\n        hash: \"SHA-512\"\n      }, true, [\"encrypt\"]).then(usrPubKey => {\n        let mData = \"\";\n\n        if (type == \"file\") {\n          mData = JSON.stringify({\n            name: metaData.name,\n            size: parseInt(metaData.size),\n            mime: metaData.mime,\n            key: metaData.key\n          });\n        } else {\n          mData = JSON.stringify({\n            name: metaData.name\n          });\n        }\n\n        window.crypto.subtle.encrypt({\n          name: \"RSA-OAEP\"\n        }, usrPubKey, new TextEncoder().encode(mData)).then(encrypted => {\n          shareItem(JSON.stringify({\n            apiKey: window.customVariables.apiKey,\n            uuid: uuid,\n            receiverId: user.id,\n            metadata: base64ArrayBuffer(encrypted)\n          }), 0, 32, err => {\n            if (err) {\n              console.log(err);\n            }\n\n            doneSharingToUsers();\n          });\n        }).catch(err => {\n          doneSharingToUsers();\n        });\n      }).catch(err => {\n        doneSharingToUsers();\n      });\n    });\n  });\n  checkIfIsInFolderLink(uuid, 0, 32, (isLinking, links) => {\n    if (!isLinking) {\n      linkCheckDone = true;\n      return isItDone();\n    }\n\n    let userMasterKeys = window.customVariables.userMasterKeys;\n    let totalLinks = links.length;\n    let linksDone = 0;\n\n    const doneAddingToLink = () => {\n      linksDone += 1;\n\n      if (linksDone >= totalLinks) {\n        linkCheckDone = true;\n        return isItDone();\n      }\n    };\n\n    links.forEach(link => {\n      let key = decryptFolderLinkKey(link.linkKey, userMasterKeys);\n      let mData = \"\";\n\n      if (type == \"file\") {\n        mData = JSON.stringify({\n          name: metaData.name,\n          size: parseInt(metaData.size),\n          mime: metaData.mime,\n          key: metaData.key\n        });\n      } else {\n        mData = JSON.stringify({\n          name: metaData.name\n        });\n      }\n\n      mData = CryptoJS.AES.encrypt(mData, key).toString();\n      renameItem(JSON.stringify({\n        apiKey: window.customVariables.apiKey,\n        uuid: uuid,\n        linkUUID: link.linkUUID,\n        metadata: mData\n      }), 0, 32, err => {\n        if (err) {\n          console.log(err);\n        }\n\n        doneAddingToLink();\n      });\n    });\n  });\n}\nexport function checkIfItemParentIsBeingShared(parentUUID, type, metaData, optionalCallback) {\n  let shareCheckDone = false;\n  let linkCheckDone = false;\n  let isItDoneInterval = undefined;\n  let callbackFired = false;\n\n  const isItDone = () => {\n    if (shareCheckDone && linkCheckDone) {\n      clearInterval(isItDoneInterval);\n\n      if (typeof optionalCallback == \"function\" && !callbackFired) {\n        callbackFired = true;\n        optionalCallback();\n      }\n\n      return true;\n    }\n  };\n\n  isItDoneInterval = setInterval(isItDone, 100);\n\n  const checkIfIsSharing = (parent, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(false);\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/share/dir/status\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: JSON.stringify({\n        apiKey: window.customVariables.apiKey,\n        uuid: parent\n      }),\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            checkIfIsSharing(parent, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        if (!res.status) {\n          console.log(res.message);\n          return callback(false);\n        }\n\n        return callback(res.data.sharing, res.data.users);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          checkIfIsSharing(parent, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  const checkIfIsInFolderLink = (parent, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(false);\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/link/dir/status\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: JSON.stringify({\n        apiKey: window.customVariables.apiKey,\n        uuid: parent\n      }),\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            checkIfIsInFolderLink(parent, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        if (!res.status) {\n          console.log(res.message);\n          return callback(false);\n        }\n\n        return callback(res.data.link, res.data.links);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          checkIfIsInFolderLink(parent, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  const addItem = (data, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(new Error(\"Max requests reached\"));\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/dir/link/add\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: data,\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            addItem(data, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        return callback(null);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          addItem(data, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  const shareItem = (data, tries, maxTries, callback) => {\n    if (tries >= maxTries) {\n      return callback(new Error(\"Max requests reached\"));\n    }\n\n    window.$.ajax({\n      url: getAPIServer() + \"/v1/share\",\n      type: \"POST\",\n      contentType: \"application/json\",\n      data: data,\n      processData: false,\n      cache: false,\n      timeout: 300000,\n      success: res => {\n        if (!res) {\n          console.log(\"Request error\");\n          return setTimeout(() => {\n            shareItem(data, tries + 1, maxTries, callback);\n          }, 1000);\n        }\n\n        return callback(null);\n      },\n      error: err => {\n        console.log(err);\n        return setTimeout(() => {\n          shareItem(data, tries + 1, maxTries, callback);\n        }, 1000);\n      }\n    });\n  };\n\n  checkIfIsSharing(parentUUID, 0, 32, (status, users) => {\n    if (!status) {\n      shareCheckDone = true;\n      return isItDone();\n    }\n\n    let totalUsers = users.length;\n    let doneUsers = 0;\n\n    const doneSharingToUsers = () => {\n      doneUsers += 1;\n\n      if (doneUsers >= totalUsers) {\n        shareCheckDone = true;\n        return isItDone();\n      }\n    };\n\n    users.forEach(user => {\n      window.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\n        name: \"RSA-OAEP\",\n        hash: \"SHA-512\"\n      }, true, [\"encrypt\"]).then(usrPubKey => {\n        let mData = \"\";\n\n        if (type == \"file\") {\n          mData = JSON.stringify({\n            name: metaData.name,\n            size: parseInt(metaData.size),\n            mime: metaData.mime,\n            key: metaData.key\n          });\n        } else {\n          mData = JSON.stringify({\n            name: metaData.name\n          });\n        }\n\n        window.crypto.subtle.encrypt({\n          name: \"RSA-OAEP\"\n        }, usrPubKey, new TextEncoder().encode(mData)).then(encrypted => {\n          shareItem(JSON.stringify({\n            apiKey: window.customVariables.apiKey,\n            uuid: metaData.uuid,\n            parent: parentUUID,\n            email: user.email,\n            type: type,\n            metadata: base64ArrayBuffer(encrypted)\n          }), 0, 32, err => {\n            if (err) {\n              console.log(err);\n            }\n\n            doneSharingToUsers();\n          });\n        }).catch(err => {\n          doneSharingToUsers();\n        });\n      }).catch(err => {\n        doneSharingToUsers();\n      });\n    });\n  });\n  checkIfIsInFolderLink(parentUUID, 0, 32, (status, links) => {\n    if (!status) {\n      linkCheckDone = true;\n      return isItDone();\n    }\n\n    let userMasterKeys = window.customVariables.userMasterKeys;\n    let totalLinks = links.length;\n    let linksDone = 0;\n\n    const doneAddingToLink = () => {\n      linksDone += 1;\n\n      if (linksDone >= totalLinks) {\n        linkCheckDone = true;\n        return isItDone();\n      }\n    };\n\n    links.forEach(link => {\n      let key = decryptFolderLinkKey(link.linkKey, userMasterKeys);\n      let mData = \"\";\n\n      if (type == \"file\") {\n        mData = JSON.stringify({\n          name: metaData.name,\n          size: parseInt(metaData.size),\n          mime: metaData.mime,\n          key: metaData.key\n        });\n      } else {\n        mData = JSON.stringify({\n          name: metaData.name\n        });\n      }\n\n      mData = CryptoJS.AES.encrypt(mData, key).toString();\n      addItem(JSON.stringify({\n        apiKey: window.customVariables.apiKey,\n        uuid: metaData.uuid,\n        parent: parentUUID,\n        linkUUID: link.linkUUID,\n        type: type,\n        metadata: mData,\n        key: link.linkKey,\n        expiration: \"never\",\n        password: \"empty\",\n        passwordHashed: hashFn(\"empty\"),\n        downloadBtn: \"enable\"\n      }), 0, 32, err => {\n        if (err) {\n          console.log(err);\n        }\n\n        doneAddingToLink();\n      });\n    });\n  });\n}\nexport function currentParentFolder() {\n  let ex = window.location.href.split(\"/\");\n  return ex[ex.length - 1];\n}\nexport function canCompressThumbnail(ext) {\n  switch (ext.toLowerCase()) {\n    case \"jpeg\":\n    case \"jpg\":\n    case \"png\":\n    case \"gif\":\n      return true;\n      break;\n\n    default:\n      return false;\n      break;\n  }\n}\nexport function canShowThumbnail(ext) {\n  switch (ext.toLowerCase()) {\n    case \"jpeg\":\n    case \"jpg\":\n    case \"png\":\n    case \"gif\":\n    case \"svg\":\n    case \"mp4\":\n    case \"webm\":\n    case \"avi\":\n    case \"mov\":\n    case \"wmv\":\n      return true;\n      break;\n\n    default:\n      return false;\n      break;\n  }\n}\nexport function getFilePreviewType(ext) {\n  switch (ext.toLowerCase()) {\n    case \"jpeg\":\n    case \"jpg\":\n    case \"png\":\n    case \"gif\":\n    case \"svg\":\n      return \"image\";\n      break;\n\n    case \"mp3\":\n    case \"mp2\":\n    case \"wav\":\n    case \"ogg\":\n    case \"m4a\":\n    case \"aac\":\n    case \"flac\":\n    case \"midi\":\n    case \"xmf\":\n    case \"rtx\":\n    case \"ota\":\n    case \"mpa\":\n    case \"aif\":\n    case \"rtttl\":\n    case \"wma\":\n      return \"audio\";\n      break;\n\n    case \"mp4\":\n    case \"webm\":\n    case \"mkv\":\n    case \"flv\":\n    case \"mov\":\n    case \"ogv\":\n    case \"3gp\":\n    case \"avi\":\n      return \"video\";\n      break;\n\n    case \"json\":\n    case \"js\":\n    case \"md\":\n    case \"php\":\n    case \"css\":\n    case \"c\":\n    case \"perl\":\n    case \"html\":\n    case \"html5\":\n    case \"jsx\":\n    case \"php5\":\n    case \"yml\":\n    case \"md\":\n    case \"xml\":\n    case \"sql\":\n    case \"java\":\n    case \"csharp\":\n    case \"dist\":\n    case \"py\":\n    case \"cc\":\n    case \"cpp\":\n    case \"log\":\n    case \"conf\":\n    case \"cxx\":\n    case \"ini\":\n    case \"lock\":\n    case \"bat\":\n    case \"sh\":\n    case \"properties\":\n    case \"cfg\":\n    case \"ahk\":\n    case \"ts\":\n    case \"tsx\":\n      return \"code\";\n      break;\n\n    case \"txt\":\n    case \"rtf\":\n      return \"text\";\n      break;\n\n    case \"pdf\":\n      return \"pdf\";\n      break;\n\n    default:\n      return \"none\";\n      break;\n  }\n}\nexport function escapeHTML(str) {\n  if (typeof str !== \"string\") {\n    return str;\n  }\n\n  if (str.length == 0) {\n    return str;\n  }\n\n  return str.replace(/(<([^>]+)>)/ig, \"\");\n}\nexport function getFileIconFromName(name) {\n  let ex = name.split(\".\");\n  return getFileIcon(ex[ex.length - 1].toLowerCase());\n}\nexport function getFileIcon(ext) {\n  switch (ext.toLowerCase()) {\n    case \"pdf\":\n      return `assets/img/types/pdf.svg`;\n      break;\n\n    case \"doc\":\n    case \"docx\":\n      return `assets/img/types/doc.svg`;\n      break;\n\n    case \"exe\":\n      return `assets/img/types/exe.svg`;\n      break;\n\n    case \"mp3\":\n      return `assets/img/types/mp3.svg`;\n      break;\n\n    case \"json\":\n      return `assets/img/types/json-file.svg`;\n      break;\n\n    case \"png\":\n      return `assets/img/types/png.svg`;\n      break;\n\n    case \"ico\":\n      return `assets/img/types/ico.svg`;\n      break;\n\n    case \"txt\":\n      return `assets/img/types/txt.svg`;\n      break;\n\n    case \"jpg\":\n    case \"jpeg\":\n      return `assets/img/types/jpg.svg`;\n      break;\n\n    case \"iso\":\n      return `assets/img/types/iso.svg`;\n      break;\n\n    case \"js\":\n      return `assets/img/types/javascript.svg`;\n      break;\n\n    case \"html\":\n      return `assets/img/types/html.svg`;\n      break;\n\n    case \"css\":\n      return `assets/img/types/css.svg`;\n      break;\n\n    case \"csv\":\n      return `assets/img/types/csv.svg`;\n      break;\n\n    case \"avi\":\n      return `assets/img/types/avi.svg`;\n      break;\n\n    case \"mp4\":\n      return `assets/img/types/mp4.svg`;\n      break;\n\n    case \"ppt\":\n      return `assets/img/types/ppt.svg`;\n      break;\n\n    case \"zip\":\n      return `assets/img/types/zip.svg`;\n      break;\n\n    case \"rar\":\n    case \"tar\":\n    case \"tgz\":\n    case \"gz\":\n    case \"gzip\":\n      return `assets/img/types/zip-1.svg`;\n      break;\n\n    case \"txt\":\n      return `assets/img/types/txt.svg`;\n      break;\n\n    case \"svg\":\n      return `assets/img/types/svg.svg`;\n      break;\n\n    case \"xml\":\n      return `assets/img/types/xml.svg`;\n      break;\n\n    case \"dwg\":\n      return `assets/img/types/dwg.svg`;\n      break;\n\n    case \"fla\":\n      return `assets/img/types/fla.svg`;\n      break;\n\n    case \"ai\":\n      return `assets/img/types/ai.svg`;\n      break;\n\n    default:\n      return `assets/img/types/file.svg`;\n      break;\n  }\n}\nexport function uInt8ArrayConcat(arrays) {\n  // sum of individual array lengths\n  let totalLength = arrays.reduce((acc, value) => acc + value.length, 0);\n  if (!arrays.length) return null;\n  let result = new Uint8Array(totalLength); // for each array - copy it over result\n  // next array is copied right after the previous one\n\n  let length = 0;\n\n  for (let array of arrays) {\n    result.set(array, length);\n    length += array.length;\n  }\n\n  return result;\n}\nexport function orderItemsByType(items, type) {\n  let files = [];\n  let folders = [];\n\n  for (let i = 0; i < items.length; i++) {\n    if (items[i].type == \"file\") {\n      files.push(items[i]);\n    } else {\n      folders.push(items[i]);\n    }\n  }\n\n  if (type == \"nameAsc\") {\n    let sortedFiles = files.sort((a, b) => {\n      return a.name.localeCompare(b.name);\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return a.name.localeCompare(b.name);\n    });\n    return sortedFolders.concat(sortedFiles);\n  } else if (type == \"sizeAsc\") {\n    let sortedFiles = files.sort((a, b) => {\n      return a.size - b.size;\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return b.timestamp - a.timestamp;\n    });\n    return sortedFolders.concat(sortedFiles);\n  } else if (type == \"dateAsc\") {\n    let sortedFiles = files.sort((a, b) => {\n      return a.timestamp - b.timestamp;\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return a.timestamp - b.timestamp;\n    });\n    return sortedFolders.concat(sortedFiles);\n  } else if (type == \"typeAsc\") {\n    let sortedFiles = files.sort((a, b) => {\n      if (typeof a.mime == \"undefined\") {\n        a.mime = \"_\";\n      }\n\n      if (typeof b.mime == \"undefined\") {\n        b.mime = \"_\";\n      }\n\n      if (a.mime.length <= 1) {\n        a.mime = \"_\";\n      }\n\n      if (b.mime.length <= 1) {\n        b.mime = \"_\";\n      }\n\n      return a.mime.localeCompare(b.mime);\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return b.timestamp - a.timestamp;\n    });\n    return sortedFolders.concat(sortedFiles);\n  } else if (type == \"nameDesc\") {\n    let sortedFiles = files.sort((a, b) => {\n      return b.name.localeCompare(a.name);\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return b.name.localeCompare(a.name);\n    });\n    return sortedFolders.concat(sortedFiles);\n  } else if (type == \"sizeDesc\") {\n    let sortedFiles = files.sort((a, b) => {\n      return b.size - a.size;\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return b.timestamp - a.timestamp;\n    });\n    return sortedFolders.concat(sortedFiles);\n  } else if (type == \"typeDesc\") {\n    let sortedFiles = files.sort((a, b) => {\n      if (typeof a.mime == \"undefined\") {\n        a.mime = \"_\";\n      }\n\n      if (typeof b.mime == \"undefined\") {\n        b.mime = \"_\";\n      }\n\n      if (a.mime.length <= 1) {\n        a.mime = \"_\";\n      }\n\n      if (b.mime.length <= 1) {\n        b.mime = \"_\";\n      }\n\n      return b.mime.localeCompare(a.mime);\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return b.timestamp - a.timestamp;\n    });\n    return sortedFolders.concat(sortedFiles);\n  } else {\n    //default, dateDesc\n    let sortedFiles = files.sort((a, b) => {\n      return b.timestamp - a.timestamp;\n    });\n    let sortedFolders = folders.sort((a, b) => {\n      return b.timestamp - a.timestamp;\n    });\n    return sortedFolders.concat(sortedFiles);\n  }\n}\nexport function getVideoCover(file, seekTo = 0.0) {\n  return new Promise((resolve, reject) => {\n    // load the file to a video player\n    const videoPlayer = document.createElement('video');\n    videoPlayer.setAttribute('src', URL.createObjectURL(file));\n    videoPlayer.load();\n    videoPlayer.addEventListener('error', ex => {\n      reject(\"error when loading video file\", ex);\n    }); // load metadata of the video to get video duration and dimensions\n\n    videoPlayer.addEventListener('loadedmetadata', () => {\n      // seek to user defined timestamp (in seconds) if possible\n      if (videoPlayer.duration < seekTo) {\n        reject(\"video is too short.\");\n        return;\n      }\n\n      if (videoPlayer.duration >= 1) {\n        seekTo = 1.0;\n      } // delay seeking or else 'seeked' event won't fire on Safari\n\n\n      setTimeout(() => {\n        videoPlayer.currentTime = seekTo;\n      }, 200); // extract video thumbnail once seeking is complete\n\n      videoPlayer.addEventListener('seeked', () => {\n        // define a canvas to have the same dimension as the video\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = videoPlayer.videoWidth;\n        canvas.height = videoPlayer.videoHeight; // draw the video frame to canvas\n\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(videoPlayer, 0, 0, canvas.width, canvas.height); // return the canvas image as a blob\n\n        ctx.canvas.toBlob(blob => {\n          resolve(blob);\n        }, \"image/jpeg\", 0.1\n        /* quality */\n        );\n      });\n    });\n  });\n}\nexport function getLanguageSelection() {\n  return `\n        <ion-select-option value=\"en\">English</ion-select-option>\n        <ion-select-option value=\"de\">Deutsch</ion-select-option>\n        <ion-select-option value=\"nl\">Nederlands</ion-select-option>\n        <ion-select-option value=\"hi\">हिन्दी, हिंदी</ion-select-option>\n        <ion-select-option value=\"fr\">Français</ion-select-option>\n        <ion-select-option value=\"da\">Dansk</ion-select-option>\n        <ion-select-option value=\"es\">Español</ion-select-option>\n    `;\n}\nexport function getFolderColorStyle(color = null, onlyColor = false) {\n  let folderColorStyle = \"\";\n\n  switch (color) {\n    case \"default\":\n      folderColorStyle = \"style='color: #F6C358;'\";\n\n      if (onlyColor) {\n        folderColorStyle = \"#F6C358\";\n      }\n\n      break;\n\n    case \"blue\":\n      folderColorStyle = \"style='color: #2992E5;'\";\n\n      if (onlyColor) {\n        folderColorStyle = \"#2992E5\";\n      }\n\n      break;\n\n    case \"green\":\n      folderColorStyle = \"style='color: #57A15B;'\";\n\n      if (onlyColor) {\n        folderColorStyle = \"#57A15B\";\n      }\n\n      break;\n\n    case \"purple\":\n      folderColorStyle = \"style='color: #8E3A9D;'\";\n\n      if (onlyColor) {\n        folderColorStyle = \"#8E3A9D\";\n      }\n\n      break;\n\n    case \"red\":\n      folderColorStyle = \"style='color: #CB2E35;'\";\n\n      if (onlyColor) {\n        folderColorStyle = \"#CB2E35\";\n      }\n\n      break;\n\n    case \"gray\":\n      folderColorStyle = \"style='color: gray;'\";\n\n      if (onlyColor) {\n        folderColorStyle = \"gray\";\n      }\n\n      break;\n\n    default:\n      folderColorStyle = \"style='color: #F6C358;'\";\n\n      if (onlyColor) {\n        folderColorStyle = \"#F6C358\";\n      }\n\n      break;\n  }\n\n  return folderColorStyle;\n}\nexport function copyTextToClipboardWeb(text) {\n  var textArea = document.createElement(\"textarea\");\n  textArea.style.position = \"fixed\";\n  textArea.style.top = 0;\n  textArea.style.left = 0;\n  textArea.style.width = \"2em\";\n  textArea.style.height = \"2em\";\n  textArea.style.padding = 0;\n  textArea.style.border = \"none\";\n  textArea.style.outline = \"none\";\n  textArea.style.boxShadow = \"none\";\n  textArea.style.background = \"transparent\";\n  textArea.value = text;\n  document.body.appendChild(textArea);\n  textArea.focus();\n  textArea.select();\n\n  try {\n    document.execCommand(\"copy\");\n  } catch (e) {\n    return console.log(e);\n  } //alert(\"Link copied to clipboard!\")\n\n\n  return document.body.removeChild(textArea);\n}","map":{"version":3,"sources":["/Users/jan/Documents/filen/app/src/utils/utils.js"],"names":["Capacitor","Plugins","CryptoJS","require","striptags","sanitizeHTML","html","getRandomArbitrary","min","max","Math","floor","random","formatBytes","bytes","decimals","k","dm","sizes","i","log","parseFloat","pow","toFixed","uuidv4","d","Date","getTime","d2","performance","now","replace","c","r","toString","generateRandomString","length","result","characters","charAt","generateRandomClassName","getAPIServer","servers","fetchWithTimeout","ms","promise","Promise","resolve","reject","timer","setTimeout","Error","then","value","clearTimeout","catch","err","backgroundAPIRequest","method","endpoint","data","cacheKey","fetch","toUpperCase","cache","headers","body","JSON","stringify","response","json","obj","window","customVariables","cachedAPIItemListRequests","customFunctions","saveAPICache","console","apiRequest","isNative","Network","getStatus","apiCache","getDownloadServer","getUploadServer","hashFn","val","SHA1","SHA512","cryptoJSEncrypt","key","AES","encrypt","cryptoJSDecrypt","decrypt","enc","Utf8","unixTimestamp","decryptCryptoJSFolderName","str","userMasterKeys","uuid","undefined","cachedMetadata","name","folderName","reverse","forEach","parse","e","decryptFolderNamePrivateKey","usrPrivKey","decrypted","crypto","subtle","_base64ToArrayBuffer","TextDecoder","decode","decryptFileMetadata","metadata","file","size","mime","fileName","fileSize","fileMime","fileKey","parseInt","decryptFileMetadataPrivateKey","base64ArrayBuffer","arrayBuffer","base64","encodings","Uint8Array","byteLength","byteRemainder","mainLength","a","b","chunk","selectedItemsDoesNotContainFolder","items","type","selected","selectedItemsContainsFolder","binary_string","atob","len","charCodeAt","buffer","fileNameValidationRegex","test","checkIfNameIsBanned","banned","isBanned","ban","indexOf","removeIllegalCharsFromString","split","join","folderNameRegex","substring","nameRegex","isAlphaNumeric","code","convertWordArrayToUint8Array","wordArray","arrayOfWords","hasOwnProperty","words","sigBytes","uInt8Array","index","word","convertUint8ArrayToBinaryString","u8Array","b_str","String","fromCharCode","Semaphore","counter","waiting","take","shift","acquire","push","release","purge","unresolved","decryptFolderLinkKey","link","checkIfItemIsBeingSharedForRename","metaData","optionalCallback","shareCheckDone","linkCheckDone","isItDoneInterval","callbackFired","isItDone","clearInterval","setInterval","checkIfIsSharing","itemUUID","tries","maxTries","callback","$","ajax","url","contentType","apiKey","processData","timeout","success","res","status","message","sharing","users","error","checkIfIsInFolderLink","links","renameItem","shareItem","isSharing","totalUsers","doneUsers","doneSharingToUsers","user","importKey","publicKey","hash","usrPubKey","mData","TextEncoder","encode","encrypted","receiverId","id","isLinking","totalLinks","linksDone","doneAddingToLink","linkKey","linkUUID","checkIfItemParentIsBeingShared","parentUUID","parent","addItem","email","expiration","password","passwordHashed","downloadBtn","currentParentFolder","ex","location","href","canCompressThumbnail","ext","toLowerCase","canShowThumbnail","getFilePreviewType","escapeHTML","getFileIconFromName","getFileIcon","uInt8ArrayConcat","arrays","totalLength","reduce","acc","array","set","orderItemsByType","files","folders","sortedFiles","sort","localeCompare","sortedFolders","concat","timestamp","getVideoCover","seekTo","videoPlayer","document","createElement","setAttribute","URL","createObjectURL","load","addEventListener","duration","currentTime","canvas","width","videoWidth","height","videoHeight","ctx","getContext","drawImage","toBlob","blob","getLanguageSelection","getFolderColorStyle","color","onlyColor","folderColorStyle","copyTextToClipboardWeb","text","textArea","style","position","top","left","padding","border","outline","boxShadow","background","appendChild","focus","select","execCommand","removeChild"],"mappings":"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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,SAASC,oBAAT,CAA8B1F,GAA9B,EAAmCC,cAAnC,EAAkD;AACxD,MAAI0F,IAAI,GAAG,EAAX;;AAEG,MAAG1F,cAAc,CAAChE,MAAf,GAAwB,CAA3B,EAA6B;AAC1BgE,IAAAA,cAAc,GAAGA,cAAc,CAACM,OAAf,EAAjB;AACF;;AAEDN,EAAAA,cAAc,CAACO,OAAf,CAAwBjB,GAAD,IAAS;AAC5B,QAAG;AACC,UAAInB,GAAG,GAAGrE,QAAQ,CAACyF,GAAT,CAAaG,OAAb,CAAqBK,GAArB,EAA0BT,GAA1B,EAA+BxD,QAA/B,CAAwChC,QAAQ,CAAC6F,GAAT,CAAaC,IAArD,CAAV;;AAEA,UAAGzB,GAAG,IAAI,OAAOA,GAAP,IAAc,QAAxB,EAAiC;AAC7B,YAAGA,GAAG,CAACnC,MAAJ,IAAc,EAAjB,EAAoB;AACnB0J,UAA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","sourcesContent":["import { Capacitor, Plugins } from \"@capacitor/core\";\r\n\r\nconst CryptoJS = require(\"crypto-js\")\r\nconst striptags = require(\"striptags\")\r\n\r\nexport function sanitizeHTML(html){\r\n    return striptags(html)\r\n}\r\n\r\nexport function getRandomArbitrary(min, max){\r\n    return Math.floor(Math.random() * (max - min) + min)\r\n}\r\n\r\nexport function formatBytes(bytes, decimals = 2){\r\n    if(bytes === 0) return \"0 Bytes\"\r\n\r\n    let k = 1024\r\n    let dm = decimals < 0 ? 0 : decimals\r\n    let sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\", \"YB\"]\r\n\r\n    let i = Math.floor(Math.log(bytes) / Math.log(k))\r\n\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + \" \" + sizes[i]\r\n}\r\n\r\nexport function uuidv4(){ // Public Domain/MIT\r\n    let d = new Date().getTime();//Timestamp\r\n    let d2 = (performance && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n        let r = Math.random() * 16;//random number between 0 and 16\r\n        if(d > 0){//Use timestamp until depleted\r\n            r = (d + r)%16 | 0;\r\n            d = Math.floor(d/16);\r\n        } else {//Use microseconds since page-load if supported\r\n            r = (d2 + r)%16 | 0;\r\n            d2 = Math.floor(d2/16);\r\n        }\r\n        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n    });\r\n}\r\n\r\nexport function generateRandomString(length = 32){\r\n    let result = \"\"\r\n    let characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\"\r\n\r\n    for(let i = 0; i < length; i++){\r\n        result += characters.charAt(Math.floor(Math.random() * characters.length))\r\n    }\r\n\r\n    return result\r\n}\r\n\r\nexport function generateRandomClassName(length = 16){\r\n    let result = \"\"\r\n    let characters = \"abcdefghijklmnopqrstuvwxyz\"\r\n\r\n    for(let i = 0; i < length; i++){\r\n        result += characters.charAt(Math.floor(Math.random() * characters.length))\r\n    }\r\n\r\n    return result + \"-\" + result\r\n}\r\n\r\nexport function getAPIServer(){\r\n    let servers = [\r\n        \"https://api.filen.io\",\r\n        \"https://api.filen-1.xyz\",\r\n        \"https://api.filen-2.xyz\",\r\n        \"https://api.filen-3.xyz\",\r\n        \"https://api.filen-4.xyz\",\r\n        \"https://api.filen-5.xyz\"\r\n    ]\r\n\r\n    return servers[getRandomArbitrary(0, (servers.length - 1))]\r\n}\r\n\r\nexport function fetchWithTimeout(ms, promise) {\r\n    return new Promise((resolve, reject) => {\r\n        let timer = setTimeout(() => {\r\n            return reject(new Error(\"Request timeout after \" + ms + \"ms\"))\r\n        }, ms)\r\n\r\n        promise.then((value) => {\r\n            clearTimeout(timer)\r\n            \r\n            return resolve(value)\r\n        }).catch((err) => {\r\n            clearTimeout(timer)\r\n\r\n            return reject(err)\r\n        })\r\n    })\r\n}\r\n\r\nexport function backgroundAPIRequest(method, endpoint, data = {}){\r\n    let cacheKey = method + endpoint\r\n\r\n    fetchWithTimeout(60000, fetch(getAPIServer() + endpoint, {\r\n        method: method.toUpperCase(),\r\n        cache: \"no-cache\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\"\r\n        },\r\n        body: JSON.stringify(data)\r\n    })).then((response) => {\r\n        response.json().then((obj) => {\r\n            window.customVariables.cachedAPIItemListRequests[cacheKey] = obj\r\n\r\n            return window.customFunctions.saveAPICache()\r\n        }).catch((err) => {\r\n            console.log(err)\r\n        })\r\n    }).catch((err) => {\r\n        console.log(err)\r\n    })\r\n}\r\n\r\nexport function apiRequest(method, endpoint, data = {}){\r\n    return new Promise((resolve, reject) => {\r\n        let cacheKey = method + endpoint\r\n        \r\n        /*let useFastCache = false\r\n\r\n        if(method.toUpperCase() == \"POST\"){\r\n            if(endpoint == \"/v1/dir/content\"\r\n            || endpoint == \"/v1/user/shared/in\"\r\n            || endpoint == \"/v1/user/shared/out\"){\r\n                useFastCache = true\r\n            }\r\n        }\r\n\r\n        if(useFastCache){\r\n            if(typeof window.customVariables.cachedAPIItemListRequests[cacheKey] !== \"undefined\"){\r\n                try{\r\n                    let obj = JSON.parse(window.customVariables.cachedAPIItemListRequests[cacheKey])\r\n\r\n                    delete window.customVariables.cachedAPIItemListRequests[cacheKey]\r\n\r\n                    backgroundAPIRequest(method, endpoint, data)\r\n\r\n                    return obj\r\n                }\r\n                catch(e){\r\n                    console.log(e)\r\n                }\r\n            }\r\n        }*/\r\n\r\n        if(Capacitor.isNative){\r\n            if(Plugins.Network.getStatus() == \"none\"){\r\n                if(typeof window.customVariables.apiCache[cacheKey] !== \"undefined\"){\r\n                    return resolve(window.customVariables.apiCache[cacheKey])\r\n                }\r\n            }\r\n        }\r\n\r\n        fetchWithTimeout(60000, fetch(getAPIServer() + endpoint, {\r\n            method: method.toUpperCase(),\r\n            cache: \"no-cache\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(data)\r\n        })).then((response) => {\r\n            response.json().then((obj) => {\r\n                if(endpoint == \"/v1/dir/content\"\r\n                || endpoint == \"/v1/user/baseFolders\"\r\n                || endpoint == \"/v1/user/shared/in\"\r\n                || endpoint == \"/v1/user/shared/out\"\r\n                || endpoint == \"/v1/user/keyPair/info\"){\r\n                    window.customVariables.apiCache[cacheKey] = obj\r\n\r\n                    window.customFunctions.saveAPICache()\r\n                }\r\n\r\n                return resolve(obj)\r\n            }).catch((err) => {\r\n                console.log(err)\r\n\r\n                if(typeof window.customVariables.apiCache[cacheKey] !== \"undefined\"){\r\n                    return resolve(window.customVariables.apiCache[cacheKey])\r\n                }\r\n\r\n                return reject(err)\r\n            })\r\n        }).catch((err) => {\r\n            console.log(err)\r\n\r\n            if(typeof window.customVariables.apiCache[cacheKey] !== \"undefined\"){\r\n                return resolve(window.customVariables.apiCache[cacheKey])\r\n            }\r\n\r\n            return reject(err)\r\n        })\r\n    })\r\n}\r\n\r\nexport function getDownloadServer(){\r\n    let servers = [\r\n        \"https://down.filen-1.xyz\",\r\n        \"https://down.filen-2.xyz\",\r\n        \"https://down.filen-3.xyz\",\r\n        \"https://down.filen-4.xyz\",\r\n        \"https://down.filen-5.xyz\"\r\n    ]\r\n\r\n    return servers[getRandomArbitrary(0, (servers.length - 1))]\r\n}\r\n\r\nexport function getUploadServer(){\r\n    let servers = [\r\n        \"https://up.filen-1.xyz\",\r\n        \"https://up.filen-2.xyz\",\r\n        \"https://up.filen-3.xyz\",\r\n        \"https://up.filen-4.xyz\",\r\n        \"https://up.filen-5.xyz\"\r\n    ]\r\n\r\n    return servers[getRandomArbitrary(0, (servers.length - 1))]\r\n}\r\n\r\nexport function hashFn(val){\r\n    return CryptoJS.SHA1(CryptoJS.SHA512(val).toString()).toString()\r\n}\r\n\r\nexport function cryptoJSEncrypt(val, key){\r\n    return CryptoJS.AES.encrypt(val, key).toString()\r\n}\r\n\r\nexport function cryptoJSDecrypt(val, key){\r\n    return CryptoJS.AES.decrypt(val, key).toString(CryptoJS.enc.Utf8)\r\n}\r\n\r\nexport function unixTimestamp(){\r\n    return Math.floor((+new Date()) / 1000)\r\n}\r\n\r\nexport function decryptCryptoJSFolderName(str, userMasterKeys, uuid = undefined){\r\n    let cacheKey = \"folder_\" + uuid + \"_\" + str\r\n\r\n    if(window.customVariables.cachedMetadata[cacheKey]){\r\n        return window.customVariables.cachedMetadata[cacheKey].name\r\n    }\r\n\r\n    let folderName = \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\"\r\n\r\n    userMasterKeys = userMasterKeys.reverse()\r\n\r\n    let obj = undefined\r\n\r\n    userMasterKeys.forEach((key) => {\r\n        try{\r\n            obj = JSON.parse(CryptoJS.AES.decrypt(str, key).toString(CryptoJS.enc.Utf8))\r\n\r\n            if(obj && typeof obj == \"object\"){\r\n                folderName = obj.name\r\n            }\r\n        }\r\n        catch(e){\r\n            return\r\n        }\r\n    })\r\n\r\n    if(folderName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\"){\r\n        window.customVariables.cachedMetadata[cacheKey] = {\r\n            name: folderName\r\n        }\r\n    }\r\n\r\n    return folderName\r\n}\r\n\r\nexport async function decryptFolderNamePrivateKey(str, usrPrivKey, uuid = undefined){\r\n    let cacheKey = \"folder_\" + uuid + \"_\" + str\r\n\r\n    if(window.customVariables.cachedMetadata[cacheKey]){\r\n        return window.customVariables.cachedMetadata[cacheKey].name\r\n    }\r\n\r\n    let folderName = \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\"\r\n\r\n    try{\r\n        let decrypted = await window.crypto.subtle.decrypt({\r\n            name: \"RSA-OAEP\"\r\n        }, usrPrivKey, _base64ToArrayBuffer(str))\r\n\r\n        decrypted = JSON.parse(new TextDecoder().decode(decrypted))\r\n\r\n        if(decrypted && typeof decrypted == \"object\"){\r\n            folderName = decrypted.name\r\n        }\r\n    }\r\n    catch(e){\r\n        console.log(e)\r\n    }\r\n\r\n    if(folderName !== \"CON_NO_DECRYPT_POSSIBLE_NO_NAME_FOUND_FOR_FOLDER\"){\r\n        window.customVariables.cachedMetadata[cacheKey] = {\r\n            name: folderName\r\n        }\r\n    }\r\n\r\n    return folderName\r\n}\r\n\r\nexport function decryptFileMetadata(metadata, userMasterKeys, uuid = undefined){\r\n    let cacheKey = \"file_\" + uuid + \"_\" + metadata\r\n\r\n    if(window.customVariables.cachedMetadata[cacheKey]){\r\n        let file = window.customVariables.cachedMetadata[cacheKey]\r\n\r\n        return {\r\n            name: file.name,\r\n            size: file.size,\r\n            mime: file.mime,\r\n            key: file.key\r\n        }\r\n    }\r\n\r\n    let fileName = \"\"\r\n    let fileSize = 0\r\n    let fileMime = \"\"\r\n    let fileKey = \"\"\r\n\r\n    userMasterKeys = userMasterKeys.reverse()\r\n\r\n    userMasterKeys.forEach((key) => {\r\n        try{\r\n            let obj = JSON.parse(CryptoJS.AES.decrypt(metadata, key).toString(CryptoJS.enc.Utf8))\r\n\r\n            if(obj && typeof obj == \"object\"){\r\n                fileName = obj.name\r\n                fileSize = parseInt(obj.size)\r\n                fileMime = obj.mime\r\n                fileKey = obj.key\r\n            }\r\n        }\r\n        catch(e){\r\n            return\r\n        }\r\n    })\r\n\r\n    let obj = {\r\n        name: fileName,\r\n        size: fileSize,\r\n        mime: fileMime,\r\n        key: fileKey\r\n    }\r\n\r\n    if(obj.name.length >= 1){\r\n        window.customVariables.cachedMetadata[cacheKey] = obj\r\n    }\r\n\r\n    return obj\r\n}\r\n\r\nexport async function decryptFileMetadataPrivateKey(str, usrPrivKey, uuid = undefined){\r\n    let cacheKey = \"file_\" + uuid + \"_\" + str\r\n\r\n    if(window.customVariables.cachedMetadata[cacheKey]){\r\n        let file = window.customVariables.cachedMetadata[cacheKey]\r\n\r\n        return {\r\n            name: file.name,\r\n            size: file.size,\r\n            mime: file.mime,\r\n            key: file.key\r\n        }\r\n    }\r\n\r\n    let fileName = \"\"\r\n    let fileSize = 0\r\n    let fileMime = \"\"\r\n    let fileKey = \"\"\r\n\r\n    try{\r\n        let decrypted = await window.crypto.subtle.decrypt({\r\n            name: \"RSA-OAEP\"\r\n        }, usrPrivKey, _base64ToArrayBuffer(str))\r\n\r\n        decrypted = JSON.parse(new TextDecoder().decode(decrypted))\r\n\r\n        if(decrypted && typeof decrypted == \"object\"){\r\n            fileName = decrypted.name\r\n            fileSize = parseInt(decrypted.size)\r\n            fileMime = decrypted.mime\r\n            fileKey = decrypted.key\r\n        }\r\n    }\r\n    catch(e){\r\n        return {\r\n            name: fileName,\r\n            size: fileSize,\r\n            mime: fileMime,\r\n            key: fileKey\r\n        }\r\n    }\r\n\r\n    let obj = {\r\n        name: fileName,\r\n        size: fileSize,\r\n        mime: fileMime,\r\n        key: fileKey\r\n    }\r\n\r\n    if(obj.name.length >= 1){\r\n        window.customVariables.cachedMetadata[cacheKey] = obj\r\n    }\r\n\r\n    return obj\r\n}\r\n\r\nexport function base64ArrayBuffer(arrayBuffer){\r\n    var base64    = ''\r\n    var encodings = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\r\n  \r\n    var bytes         = new Uint8Array(arrayBuffer)\r\n    var byteLength    = bytes.byteLength\r\n    var byteRemainder = byteLength % 3\r\n    var mainLength    = byteLength - byteRemainder\r\n  \r\n    var a, b, c, d\r\n    var chunk\r\n  \r\n    // Main loop deals with bytes in chunks of 3\r\n    for (var i = 0; i < mainLength; i = i + 3) {\r\n      // Combine the three bytes into a single integer\r\n      chunk = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2]\r\n  \r\n      // Use bitmasks to extract 6-bit segments from the triplet\r\n      a = (chunk & 16515072) >> 18 // 16515072 = (2^6 - 1) << 18\r\n      b = (chunk & 258048)   >> 12 // 258048   = (2^6 - 1) << 12\r\n      c = (chunk & 4032)     >>  6 // 4032     = (2^6 - 1) << 6\r\n      d = chunk & 63               // 63       = 2^6 - 1\r\n  \r\n      // Convert the raw binary segments to the appropriate ASCII encoding\r\n      base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d]\r\n    }\r\n  \r\n    // Deal with the remaining bytes and padding\r\n    if (byteRemainder == 1) {\r\n      chunk = bytes[mainLength]\r\n  \r\n      a = (chunk & 252) >> 2 // 252 = (2^6 - 1) << 2\r\n  \r\n      // Set the 4 least significant bits to zero\r\n      b = (chunk & 3)   << 4 // 3   = 2^2 - 1\r\n  \r\n      base64 += encodings[a] + encodings[b] + '=='\r\n    } else if (byteRemainder == 2) {\r\n      chunk = (bytes[mainLength] << 8) | bytes[mainLength + 1]\r\n  \r\n      a = (chunk & 64512) >> 10 // 64512 = (2^6 - 1) << 10\r\n      b = (chunk & 1008)  >>  4 // 1008  = (2^6 - 1) << 4\r\n  \r\n      // Set the 2 least significant bits to zero\r\n      c = (chunk & 15)    <<  2 // 15    = 2^4 - 1\r\n  \r\n      base64 += encodings[a] + encodings[b] + encodings[c] + '='\r\n    }\r\n    \r\n    return base64\r\n}\r\n\r\nexport function selectedItemsDoesNotContainFolder(items){\r\n    for(let i = 0; i < items.length; i++){\r\n        if(items[i].type == \"folder\" && items[i].selected){\r\n            return false\r\n        }\r\n    }\r\n\r\n    return true\r\n}\r\n\r\nexport function selectedItemsContainsFolder(items){\r\n    for(let i = 0; i < items.length; i++){\r\n        if(items[i].type == \"folder\" && items[i].selected){\r\n            return true\r\n        }\r\n    }\r\n\r\n    return false\r\n}\r\n\r\nexport function _base64ToArrayBuffer(base64){\r\n    var binary_string = window.atob(base64);\r\n    var len = binary_string.length;\r\n    var bytes = new Uint8Array(len);\r\n    for (var i = 0; i < len; i++) {\r\n        bytes[i] = binary_string.charCodeAt(i);\r\n    }\r\n    return bytes.buffer;\r\n}\r\n\r\nexport function fileNameValidationRegex(name){\r\n\tif(/^(con|prn|aux|nul|com[0-9]|lpt[0-9])$|([<>:\"\\/\\\\|?*])|(\\.|\\s)$/ig.test(name)){\r\n\t\treturn true\r\n\t}\r\n\r\n\treturn false\r\n}\r\n\r\nexport function checkIfNameIsBanned(name){\r\n    let banned = [\r\n      \"/\",\r\n      \"\\\\\",\r\n      \"?\",\r\n      \"@\",\r\n      \"$\",\r\n      \"%\",\r\n      \"[\",\r\n      \"]\",\r\n      \"{\",\r\n      \"}\",\r\n      \"&\",\r\n      '\"',\r\n      \"'\",\r\n      \"`\",\r\n      \"*\",\r\n      \"=\",\r\n      \"´\",\r\n      \"<\",\r\n      \">\",\r\n      \":\",\r\n      \";\",\r\n      \"|\",\r\n      \"§\",\r\n      \"CON\", \"PRN\", \"AUX\", \"NUL\", \"COM1\", \"COM2\", \"COM3\", \"COM4\", \"COM5\", \"COM6\", \"COM7\", \"COM8\", \"COM9\",\r\n      \"LPT1\", \"LPT2\", \"LPT3\", \"LPT4\", \"LPT5\", \"LPT6\", \"LPT7\", \"LPT8\", \"LPT9\"\r\n    ]\r\n  \r\n    let isBanned = false\r\n  \r\n    banned.forEach((ban) => {\r\n      if(name.indexOf(ban) !== -1){\r\n        isBanned = true\r\n      }\r\n    })\r\n  \r\n    return isBanned\r\n  }\r\n\r\nexport function removeIllegalCharsFromString(str){\r\n    str = str.split(\"'\").join(\"\")\r\n    str = str.split('\"').join(\"\")\r\n    str = str.split(\"´\").join(\"\")\r\n    str = str.split(\"`\").join(\"\")\r\n    str = str.split(\"<\").join(\"\")\r\n    str = str.split(\">\").join(\"\")\r\n    str = str.split(\"!\").join(\"\")\r\n    str = str.split(\"^\").join(\"\")\r\n    str = str.split(\":\").join(\"\")\r\n    str = str.replace(/(<([^>]+)>)/ig, \"\")\r\n\r\n    return str\r\n}\r\n\r\nexport function folderNameRegex(name){\r\n    if(name.substring(0, 1) == \".\" || name.substring(0, 2) == \"..\"){\r\n        return true\r\n    }\r\n    \r\n    return false\r\n}\r\n\r\nexport function nameRegex(name){\r\n    return false\r\n}\r\n\r\nexport function isAlphaNumeric(str){\r\n    var code, i, len;\r\n    \r\n    for (i = 0, len = str.length; i < len; i++) {\r\n        code = str.charCodeAt(i);\r\n        if (!(code > 47 && code < 58) && // numeric (0-9)\r\n            !(code > 64 && code < 91) && // upper alpha (A-Z)\r\n            !(code > 96 && code < 123)) { // lower alpha (a-z)\r\n        return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function convertWordArrayToUint8Array(wordArray){\r\n    let arrayOfWords = wordArray.hasOwnProperty(\"words\") ? wordArray.words : []\r\n    let length = wordArray.hasOwnProperty(\"sigBytes\") ? wordArray.sigBytes : arrayOfWords.length * 4\r\n    let uInt8Array = new Uint8Array(length), index=0, word, i\r\n\r\n    for(i = 0; i < length; i++){\r\n        word = arrayOfWords[i]\r\n\r\n        uInt8Array[index++] = word >> 24\r\n        uInt8Array[index++] = (word >> 16) & 0xff\r\n        uInt8Array[index++] = (word >> 8) & 0xff\r\n        uInt8Array[index++] = word & 0xff\r\n    }\r\n\r\n    return uInt8Array\r\n}\r\n\r\nexport function convertUint8ArrayToBinaryString(u8Array){\r\n    let i, len = u8Array.length, b_str = \"\"\r\n\r\n    for (i = 0; i < len; i++){\r\n        b_str += String.fromCharCode(u8Array[i])\r\n    }\r\n\r\n    return b_str\r\n}\r\n\r\nexport function Semaphore(max){\r\n    var counter = 0;\r\n    var waiting = [];\r\n    \r\n    var take = function() {\r\n      if (waiting.length > 0 && counter < max){\r\n        counter++;\r\n        let promise = waiting.shift();\r\n        promise.resolve();\r\n      }\r\n    }\r\n    \r\n    this.acquire = function() {\r\n      if(counter < max) {\r\n        counter++\r\n        return new Promise(resolve => {\r\n        resolve();\r\n      });\r\n      } else {\r\n        return new Promise((resolve, err) => {\r\n          waiting.push({resolve: resolve, err: err});\r\n        });\r\n      }\r\n    }\r\n      \r\n    this.release = function() {\r\n     counter--;\r\n     take();\r\n    }\r\n    \r\n    this.purge = function() {\r\n      let unresolved = waiting.length;\r\n    \r\n      for (let i = 0; i < unresolved; i++) {\r\n        waiting[i].err('Task has been purged.');\r\n      }\r\n    \r\n      counter = 0;\r\n      waiting = [];\r\n      \r\n      return unresolved;\r\n    }\r\n}\r\n\r\n/*export function checkIfItemParentIsBeingShared(parentUUID, type, metadata){\r\n    const checkIfIsSharing = async (parent, callback) => {\r\n        if(parent == \"default\" || parent == \"base\"){\r\n            return callback(false)\r\n        }\r\n\r\n        try{\r\n            var res = await apiRequest(\"POST\", \"/v1/share/dir/status\", {\r\n                apiKey: window.customVariables.apiKey,\r\n                uuid: parent\r\n            })\r\n        }\r\n        catch(e){\r\n            console.log(e)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        if(!res.status){\r\n            console.log(res.message)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        return callback(res.data.sharing, res.data.users)\r\n    }\r\n\r\n    checkIfIsSharing(parentUUID, async (status, users) => {\r\n        if(!status){\r\n            return false\r\n        }\r\n\r\n        for(let i = 0; i < users.length; i++){\r\n            let user = users[i]\r\n\r\n            try{\r\n                var usrPubKey = await window.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\r\n                    name: \"RSA-OAEP\",\r\n                    hash: \"SHA-512\"\r\n                }, true, [\"encrypt\"])\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            let mData = \"\"\r\n\r\n            if(type == \"file\"){\r\n                mData = JSON.stringify({\r\n                    name: metadata.name,\r\n                    size: parseInt(metadata.size),\r\n                    mime: metadata.mime,\r\n                    key: metadata.key\r\n                })\r\n            }\r\n            else{\r\n                mData = JSON.stringify({\r\n                    name: metadata.name\r\n                })\r\n            }\r\n            \r\n            try{\r\n                var encrypted = await window.crypto.subtle.encrypt({\r\n                    name: \"RSA-OAEP\"\r\n                }, usrPubKey, new TextEncoder().encode(mData))\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            try{\r\n                var res = await apiRequest(\"POST\", \"/v1/share\", {\r\n                    apiKey: window.customVariables.apiKey,\r\n                    uuid: metadata.uuid,\r\n                    parent: parentUUID,\r\n                    email: user.email,\r\n                    type,\r\n                    metadata: base64ArrayBuffer(encrypted)\r\n                })\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            if(!res.status){\r\n                console.log(res.message)\r\n\r\n                return false\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nexport function checkIfItemIsBeingSharedForRename(type, uuid, metadata){\r\n    const checkIfIsSharing = async (itemUUID, callback) => {\r\n        try{\r\n            var res = await apiRequest(\"POST\", \"/v1/user/shared/item/status\", {\r\n                apiKey: window.customVariables.apiKey,\r\n                uuid: itemUUID\r\n            })\r\n        }\r\n        catch(e){\r\n            console.log(e)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        if(!res.status){\r\n            console.log(res.message)\r\n\r\n            return callback(false)\r\n        }\r\n\r\n        return callback(res.data.sharing, res.data.users)\r\n    }\r\n\r\n    checkIfIsSharing(uuid, async (sharing, users) => {\r\n        if(!sharing){\r\n            return false\r\n        }\r\n\r\n        for(let i = 0; i < users.length; i++){\r\n            let user = users[i]\r\n\r\n            try{\r\n                var usrPubKey = await window.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\r\n                    name: \"RSA-OAEP\",\r\n                    hash: \"SHA-512\"\r\n                }, true, [\"encrypt\"])\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            let mData = \"\"\r\n\r\n            if(type == \"file\"){\r\n                mData = JSON.stringify({\r\n                    name: metadata.name,\r\n                    size: parseInt(metadata.size),\r\n                    mime: metadata.mime,\r\n                    key: metadata.key\r\n                })\r\n            }\r\n            else{\r\n                mData = JSON.stringify({\r\n                    name: metadata.name\r\n                })\r\n            }\r\n            \r\n            try{\r\n                var encrypted = await window.crypto.subtle.encrypt({\r\n                    name: \"RSA-OAEP\"\r\n                }, usrPubKey, new TextEncoder().encode(mData))\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            try{\r\n                var res = await apiRequest(\"POST\", \"/v1/user/shared/item/rename\", {\r\n                    apiKey: window.customVariables.apiKey,\r\n                    uuid,\r\n                    receiverId: user.id,\r\n                    metadata: base64ArrayBuffer(encrypted)\r\n                })\r\n            }\r\n            catch(e){\r\n                console.log(e)\r\n\r\n                return false\r\n            }\r\n\r\n            if(!res.status){\r\n                console.log(res.message)\r\n\r\n                return false\r\n            }\r\n        }\r\n    })\r\n}*/\r\n\r\nexport function decryptFolderLinkKey(str, userMasterKeys){\r\n\tlet link = \"\"\r\n\r\n    if(userMasterKeys.length > 1){\r\n      \tuserMasterKeys = userMasterKeys.reverse()\r\n    }\r\n\r\n    userMasterKeys.forEach((key) => {\r\n        try{\r\n            let obj = CryptoJS.AES.decrypt(str, key).toString(CryptoJS.enc.Utf8)\r\n\r\n            if(obj && typeof obj == \"string\"){\r\n                if(obj.length >= 16){\r\n                \tlink = obj\r\n                }\r\n            }\r\n        }\r\n        catch(e){\r\n            return\r\n        }\r\n    })\r\n\r\n    return link\r\n}\r\n\r\nexport function checkIfItemIsBeingSharedForRename(type, uuid, metaData, optionalCallback){\r\n\tlet shareCheckDone = false\r\n\tlet linkCheckDone = false\r\n\r\n\tlet isItDoneInterval = undefined\r\n\tlet callbackFired = false\r\n\r\n\tconst isItDone = () => {\r\n\t\tif(shareCheckDone && linkCheckDone){\r\n\t\t\tclearInterval(isItDoneInterval)\r\n\r\n\t\t\tif(typeof optionalCallback == \"function\" && !callbackFired){\r\n\t\t\t\tcallbackFired = true\r\n\r\n\t\t\t \toptionalCallback()\r\n\t\t\t}\r\n\r\n\t\t\treturn true\r\n\t\t}\r\n\t}\r\n\r\n\tisItDoneInterval = setInterval(isItDone, 100)\r\n\r\n\tconst checkIfIsSharing = (itemUUID, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(false)\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/user/shared/item/status\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: JSON.stringify({\r\n\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\tuuid: itemUUID\r\n\t\t\t}),\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\tcheckIfIsSharing(itemUUID, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tcallback(false)\r\n\r\n\t\t\t\t\treturn console.log(res.message)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(res.data.sharing, res.data.users)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\tcheckIfIsSharing(itemUUID, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst checkIfIsInFolderLink = (itemUUID, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(false)\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/link/dir/item/status\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: JSON.stringify({\r\n\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\tuuid: itemUUID\r\n\t\t\t}),\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\tcheckIfIsInFolderLink(itemUUID, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tcallback(false)\r\n\r\n\t\t\t\t\treturn console.log(res.message)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(res.data.link, res.data.links)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\tcheckIfIsInFolderLink(itemUUID, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst renameItem = (data, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(new Error(\"Max requests reached\"))\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/link/dir/item/rename\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: data,\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\trenameItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(null)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\trenameItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst shareItem = (data, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(new Error(\"Max requests reached\"))\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/user/shared/item/rename\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: data,\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\tshareItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(null)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\tshareItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tcheckIfIsSharing(uuid, 0, 32, (isSharing, users) => {\r\n\t\tif(!isSharing){\r\n\t\t\tshareCheckDone = true\r\n\r\n\t\t\treturn isItDone()\r\n\t\t}\r\n\r\n\t\tlet totalUsers = users.length\r\n\t\tlet doneUsers = 0\r\n\r\n\t\tconst doneSharingToUsers = () => {\r\n\t\t\tdoneUsers += 1\r\n\r\n\t\t\tif(doneUsers >= totalUsers){\r\n\t\t\t\tshareCheckDone = true\r\n\r\n\t\t\t\treturn isItDone()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tusers.forEach((user) => {\r\n\t\t\twindow.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\r\n      \t\t\tname: \"RSA-OAEP\",\r\n        \t\thash: \"SHA-512\"\r\n    \t\t}, true, [\"encrypt\"]).then((usrPubKey) => {\r\n    \t\t\tlet mData = \"\"\r\n\r\n    \t\t\tif(type == \"file\"){\r\n    \t\t\t\tmData = JSON.stringify({\r\n\t    \t\t\t\tname: metaData.name,\r\n\t    \t\t\t\tsize: parseInt(metaData.size),\r\n\t    \t\t\t\tmime: metaData.mime,\r\n\t    \t\t\t\tkey: metaData.key\r\n\t    \t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tmData = JSON.stringify({\r\n\t\t\t\t\t\tname: metaData.name\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.crypto.subtle.encrypt({\r\n    \t\t\t\tname: \"RSA-OAEP\"\r\n    \t\t\t}, usrPubKey, new TextEncoder().encode(mData)).then((encrypted) => {\r\n    \t\t\t\tshareItem(JSON.stringify({\r\n\t\t\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\t\t\tuuid: uuid,\r\n\t\t\t\t\t\treceiverId: user.id,\r\n\t\t\t\t\t\tmetadata: base64ArrayBuffer(encrypted)\r\n\t\t\t\t\t}), 0, 32, (err) => {\r\n    \t\t\t\t\tif(err){\r\n    \t\t\t\t\t\tconsole.log(err)\r\n    \t\t\t\t\t}\r\n\r\n    \t\t\t\t\tdoneSharingToUsers()\r\n    \t\t\t\t})\r\n    \t\t\t}).catch((err) => {\r\n\t    \t\t\tdoneSharingToUsers()\r\n\t    \t\t})\r\n    \t\t}).catch((err) => {\r\n    \t\t\tdoneSharingToUsers()\r\n    \t\t})\r\n\t\t})\r\n\t})\r\n\r\n\tcheckIfIsInFolderLink(uuid, 0, 32, (isLinking, links) => {\r\n\t\tif(!isLinking){\r\n\t\t\tlinkCheckDone = true\r\n\r\n\t\t\treturn isItDone()\r\n\t\t}\r\n\r\n\t\tlet userMasterKeys = window.customVariables.userMasterKeys\r\n\r\n\t\tlet totalLinks = links.length\r\n\t\tlet linksDone = 0\r\n\r\n\t\tconst doneAddingToLink = () => {\r\n\t\t\tlinksDone += 1\r\n\r\n\t\t\tif(linksDone >= totalLinks){\r\n\t\t\t\tlinkCheckDone = true\r\n\r\n\t\t\t\treturn isItDone()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlinks.forEach((link) => {\r\n\t\t\tlet key = decryptFolderLinkKey(link.linkKey, userMasterKeys)\r\n\r\n\t\t\tlet mData = \"\"\r\n\r\n\t\t\tif(type == \"file\"){\r\n\t\t\t\tmData = JSON.stringify({\r\n    \t\t\t\tname: metaData.name,\r\n    \t\t\t\tsize: parseInt(metaData.size),\r\n    \t\t\t\tmime: metaData.mime,\r\n    \t\t\t\tkey: metaData.key\r\n    \t\t\t})\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tmData = JSON.stringify({\r\n\t\t\t\t\tname: metaData.name\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tmData = CryptoJS.AES.encrypt(mData, key).toString()\r\n\r\n\t\t\trenameItem(JSON.stringify({\r\n\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\tuuid: uuid,\r\n\t\t\t\tlinkUUID: link.linkUUID,\r\n\t\t\t\tmetadata: mData\r\n\t\t\t}), 0, 32, (err) => {\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdoneAddingToLink()\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n}\r\n\r\nexport function checkIfItemParentIsBeingShared(parentUUID, type, metaData, optionalCallback){\r\n\tlet shareCheckDone = false\r\n\tlet linkCheckDone = false\r\n\r\n\tlet isItDoneInterval = undefined\r\n\tlet callbackFired = false\r\n\r\n\tconst isItDone = () => {\r\n\t\tif(shareCheckDone && linkCheckDone){\r\n\t\t\tclearInterval(isItDoneInterval)\r\n\r\n\t\t\tif(typeof optionalCallback == \"function\" && !callbackFired){\r\n\t\t\t\tcallbackFired = true\r\n\t\t\t\t\r\n\t\t\t \toptionalCallback()\r\n\t\t\t}\r\n\r\n\t\t\treturn true\r\n\t\t}\r\n\t}\r\n\r\n\tisItDoneInterval = setInterval(isItDone, 100)\r\n\r\n\tconst checkIfIsSharing = (parent, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(false)\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/share/dir/status\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: JSON.stringify({\r\n\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\tuuid: parent\r\n\t\t\t}),\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\tcheckIfIsSharing(parent, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tconsole.log(res.message)\r\n\r\n\t\t\t\t\treturn callback(false)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(res.data.sharing, res.data.users)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\tcheckIfIsSharing(parent, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst checkIfIsInFolderLink = (parent, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(false)\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/link/dir/status\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: JSON.stringify({\r\n\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\tuuid: parent\r\n\t\t\t}),\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\tcheckIfIsInFolderLink(parent, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!res.status){\r\n\t\t\t\t\tconsole.log(res.message)\r\n\r\n\t\t\t\t\treturn callback(false)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(res.data.link, res.data.links)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\tcheckIfIsInFolderLink(parent, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst addItem = (data, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(new Error(\"Max requests reached\"))\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/dir/link/add\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: data,\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\taddItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(null)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\taddItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst shareItem = (data, tries, maxTries, callback) => {\r\n\t\tif(tries >= maxTries){\r\n\t\t\treturn callback(new Error(\"Max requests reached\"))\r\n\t\t}\r\n\r\n\t\twindow.$.ajax({\r\n\t\t\turl: getAPIServer() + \"/v1/share\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tcontentType: \"application/json\",\r\n\t\t\tdata: data,\r\n\t\t\tprocessData: false,\r\n\t\t\tcache: false,\r\n\t\t\ttimeout: 300000,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif(!res){\r\n\t\t\t\t\tconsole.log(\"Request error\")\r\n\r\n\t\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\t\tshareItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn callback(null)\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\tconsole.log(err)\r\n\r\n\t\t\t\treturn setTimeout(() => {\r\n\t\t\t\t\tshareItem(data, (tries + 1), maxTries, callback)\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tcheckIfIsSharing(parentUUID, 0, 32, (status, users) => {\r\n\t\tif(!status){\r\n\t\t\tshareCheckDone = true\r\n\r\n\t\t\treturn isItDone()\r\n\t\t}\r\n\r\n\t\tlet totalUsers = users.length\r\n\t\tlet doneUsers = 0\r\n\r\n\t\tconst doneSharingToUsers = () => {\r\n\t\t\tdoneUsers += 1\r\n\r\n\t\t\tif(doneUsers >= totalUsers){\r\n\t\t\t\tshareCheckDone = true\r\n\r\n\t\t\t\treturn isItDone()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tusers.forEach((user) => {\r\n\t\t\twindow.crypto.subtle.importKey(\"spki\", _base64ToArrayBuffer(user.publicKey), {\r\n      \t\t\tname: \"RSA-OAEP\",\r\n        \t\thash: \"SHA-512\"\r\n    \t\t}, true, [\"encrypt\"]).then((usrPubKey) => {\r\n    \t\t\tlet mData = \"\"\r\n\r\n    \t\t\tif(type == \"file\"){\r\n    \t\t\t\tmData = JSON.stringify({\r\n\t    \t\t\t\tname: metaData.name,\r\n\t    \t\t\t\tsize: parseInt(metaData.size),\r\n\t    \t\t\t\tmime: metaData.mime,\r\n\t    \t\t\t\tkey: metaData.key\r\n\t    \t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tmData = JSON.stringify({\r\n\t\t\t\t\t\tname: metaData.name\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.crypto.subtle.encrypt({\r\n    \t\t\t\tname: \"RSA-OAEP\"\r\n    \t\t\t}, usrPubKey, new TextEncoder().encode(mData)).then((encrypted) => {\r\n    \t\t\t\tshareItem(JSON.stringify({\r\n\t\t\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\t\t\tuuid: metaData.uuid,\r\n\t\t\t\t\t\tparent: parentUUID,\r\n\t\t\t\t\t\temail: user.email,\r\n\t\t\t\t\t\ttype: type,\r\n\t\t\t\t\t\tmetadata: base64ArrayBuffer(encrypted)\r\n\t\t\t\t\t}), 0, 32, (err) => {\r\n    \t\t\t\t\tif(err){\r\n    \t\t\t\t\t\tconsole.log(err)\r\n    \t\t\t\t\t}\r\n\r\n    \t\t\t\t\tdoneSharingToUsers()\r\n\t\t\t\t\t})\r\n    \t\t\t}).catch((err) => {\r\n\t    \t\t\tdoneSharingToUsers()\r\n\t    \t\t})\r\n    \t\t}).catch((err) => {\r\n    \t\t\tdoneSharingToUsers()\r\n    \t\t})\r\n\t\t})\r\n\t})\r\n\r\n\tcheckIfIsInFolderLink(parentUUID, 0, 32, (status, links) => {\r\n\t\tif(!status){\r\n\t\t\tlinkCheckDone = true\r\n\r\n\t\t\treturn isItDone()\r\n\t\t}\r\n\r\n\t\tlet userMasterKeys = window.customVariables.userMasterKeys\r\n\r\n\t\tlet totalLinks = links.length\r\n\t\tlet linksDone = 0\r\n\r\n\t\tconst doneAddingToLink = () => {\r\n\t\t\tlinksDone += 1\r\n\r\n\t\t\tif(linksDone >= totalLinks){\r\n\t\t\t\tlinkCheckDone = true\r\n\r\n\t\t\t\treturn isItDone()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlinks.forEach((link) => {\r\n\t\t\tlet key = decryptFolderLinkKey(link.linkKey, userMasterKeys)\r\n\r\n\t\t\tlet mData = \"\"\r\n\r\n\t\t\tif(type == \"file\"){\r\n\t\t\t\tmData = JSON.stringify({\r\n\t\t\t\t\tname: metaData.name,\r\n\t\t\t\t\tsize: parseInt(metaData.size),\r\n\t\t\t\t\tmime: metaData.mime,\r\n\t\t\t\t\tkey: metaData.key\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tmData = JSON.stringify({\r\n\t\t\t\t\tname: metaData.name\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tmData = CryptoJS.AES.encrypt(mData, key).toString()\r\n\r\n\t\t\taddItem(JSON.stringify({\r\n\t\t\t\tapiKey: window.customVariables.apiKey,\r\n\t\t\t\tuuid: metaData.uuid,\r\n\t\t\t\tparent: parentUUID,\r\n\t\t\t\tlinkUUID: link.linkUUID,\r\n\t\t\t\ttype: type,\r\n\t\t\t\tmetadata: mData,\r\n\t\t\t\tkey: link.linkKey,\r\n\t\t\t\texpiration: \"never\",\r\n\t\t\t\tpassword: \"empty\",\r\n\t\t\t\tpasswordHashed: hashFn(\"empty\"),\r\n\t\t\t\tdownloadBtn: \"enable\"\r\n\t\t\t}), 0, 32, (err) => {\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdoneAddingToLink()\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n}\r\n\r\nexport function currentParentFolder(){\r\n    let ex = window.location.href.split(\"/\")\r\n\r\n    return ex[ex.length - 1]\r\n}\r\n\r\nexport function canCompressThumbnail(ext){\r\n    switch(ext.toLowerCase()){\r\n        case \"jpeg\":\r\n        case \"jpg\":\r\n        case \"png\":\r\n        case \"gif\":\r\n            return true\r\n        break\r\n        default:\r\n            return false\r\n        break\r\n    }\r\n}\r\n\r\nexport function canShowThumbnail(ext){\r\n    switch(ext.toLowerCase()){\r\n        case \"jpeg\":\r\n        case \"jpg\":\r\n        case \"png\":\r\n        case \"gif\":\r\n        case \"svg\":\r\n        case \"mp4\":\r\n        case \"webm\":\r\n        case \"avi\":\r\n        case \"mov\":\r\n        case \"wmv\":\r\n            return true\r\n        break\r\n        default:\r\n            return false\r\n        break\r\n    }\r\n}\r\n\r\nexport function getFilePreviewType(ext){\r\n    switch(ext.toLowerCase()){\r\n      case \"jpeg\":\r\n      case \"jpg\":\r\n      case \"png\":\r\n      case \"gif\":\r\n      case \"svg\":\r\n        return \"image\"\r\n      break\r\n      case \"mp3\":\r\n      case \"mp2\":\r\n      case \"wav\":\r\n      case \"ogg\":\r\n      case \"m4a\":\r\n      case \"aac\":\r\n      case \"flac\":\r\n      case \"midi\":\r\n      case \"xmf\":\r\n      case \"rtx\":\r\n      case \"ota\":\r\n      case \"mpa\":\r\n      case \"aif\":\r\n      case \"rtttl\":\r\n      case \"wma\":\r\n        return \"audio\"\r\n      break\r\n      case \"mp4\":\r\n      case \"webm\":\r\n      case \"mkv\":\r\n      case \"flv\":\r\n      case \"mov\":\r\n      case \"ogv\":\r\n      case \"3gp\":\r\n      case \"avi\":\r\n        return \"video\"\r\n      break\r\n      case \"json\":\r\n      case \"js\":\r\n      case \"md\":\r\n      case \"php\":\r\n      case \"css\":\r\n      case \"c\":\r\n      case \"perl\":\r\n      case \"html\":\r\n      case \"html5\":\r\n      case \"jsx\":\r\n      case \"php5\":\r\n      case \"yml\":\r\n      case \"md\":\r\n      case \"xml\":\r\n      case \"sql\":\r\n      case \"java\":\r\n      case \"csharp\":\r\n      case \"dist\":\r\n      case \"py\":\r\n      case \"cc\":\r\n      case \"cpp\":\r\n      case \"log\":\r\n      case \"conf\":\r\n      case \"cxx\":\r\n      case \"ini\":\r\n      case \"lock\":\r\n      case \"bat\":\r\n      case \"sh\":\r\n      case \"properties\":\r\n      case \"cfg\":\r\n      case \"ahk\":\r\n      case \"ts\":\r\n      case \"tsx\":\r\n        return \"code\"\r\n      break\r\n      case \"txt\":\r\n      case \"rtf\":\r\n        return \"text\"\r\n      break\r\n      case \"pdf\":\r\n        return \"pdf\"\r\n      break\r\n      default:\r\n        return \"none\"\r\n      break\r\n    }\r\n}\r\n\r\nexport function escapeHTML(str){\r\n    if(typeof str !== \"string\"){\r\n      return str\r\n    }\r\n  \r\n    if(str.length == 0){\r\n      return str\r\n    }\r\n  \r\n    return str.replace(/(<([^>]+)>)/ig, \"\")\r\n}\r\n\r\nexport function getFileIconFromName(name){\r\n    let ex = name.split(\".\")\r\n\r\n    return getFileIcon(ex[ex.length - 1].toLowerCase())\r\n}\r\n\r\nexport function getFileIcon(ext){\r\n    switch(ext.toLowerCase()){\r\n      case \"pdf\":\r\n        return `assets/img/types/pdf.svg`\r\n      break\r\n      case \"doc\":\r\n      case \"docx\":\r\n        return `assets/img/types/doc.svg`\r\n      break\r\n      case \"exe\":\r\n        return `assets/img/types/exe.svg`\r\n      break\r\n      case \"mp3\":\r\n        return `assets/img/types/mp3.svg`\r\n      break\r\n      case \"json\":\r\n        return `assets/img/types/json-file.svg`\r\n      break\r\n      case \"png\":\r\n        return `assets/img/types/png.svg`\r\n      break\r\n      case \"ico\":\r\n        return `assets/img/types/ico.svg`\r\n      break\r\n      case \"txt\":\r\n        return `assets/img/types/txt.svg`\r\n      break\r\n      case \"jpg\":\r\n      case \"jpeg\":\r\n        return `assets/img/types/jpg.svg`\r\n      break\r\n      case \"iso\":\r\n        return `assets/img/types/iso.svg`\r\n      break\r\n      case \"js\":\r\n        return `assets/img/types/javascript.svg`\r\n      break\r\n      case \"html\":\r\n        return `assets/img/types/html.svg`\r\n      break\r\n      case \"css\":\r\n        return `assets/img/types/css.svg`\r\n      break\r\n      case \"csv\":\r\n        return `assets/img/types/csv.svg`\r\n      break\r\n      case \"avi\":\r\n        return `assets/img/types/avi.svg`\r\n      break\r\n      case \"mp4\":\r\n        return `assets/img/types/mp4.svg`\r\n      break\r\n      case \"ppt\":\r\n        return `assets/img/types/ppt.svg`\r\n      break\r\n      case \"zip\":\r\n        return `assets/img/types/zip.svg`\r\n      break\r\n      case \"rar\":\r\n      case \"tar\":\r\n      case \"tgz\":\r\n      case \"gz\":\r\n      case \"gzip\":\r\n        return `assets/img/types/zip-1.svg`\r\n      break\r\n      case \"txt\":\r\n        return `assets/img/types/txt.svg`\r\n      break\r\n      case \"svg\":\r\n        return `assets/img/types/svg.svg`\r\n      break\r\n      case \"xml\":\r\n        return `assets/img/types/xml.svg`\r\n      break\r\n      case \"dwg\":\r\n        return `assets/img/types/dwg.svg`\r\n      break\r\n      case \"fla\":\r\n        return `assets/img/types/fla.svg`\r\n      break\r\n      case \"ai\":\r\n        return `assets/img/types/ai.svg`\r\n      break\r\n      default:\r\n        return `assets/img/types/file.svg`\r\n      break\r\n    }\r\n}\r\n\r\nexport function uInt8ArrayConcat(arrays){\r\n    // sum of individual array lengths\r\n    let totalLength = arrays.reduce((acc, value) => acc + value.length, 0);\r\n  \r\n    if (!arrays.length) return null;\r\n  \r\n    let result = new Uint8Array(totalLength);\r\n  \r\n    // for each array - copy it over result\r\n    // next array is copied right after the previous one\r\n    let length = 0;\r\n    for(let array of arrays) {\r\n      result.set(array, length);\r\n      length += array.length;\r\n    }\r\n  \r\n    return result;\r\n}\r\n\r\nexport function orderItemsByType(items, type){\r\n    let files = []\r\n    let folders = []\r\n\r\n    for(let i = 0; i < items.length; i++){\r\n        if(items[i].type == \"file\"){\r\n            files.push(items[i])\r\n        }\r\n        else{\r\n            folders.push(items[i])\r\n        }\r\n    }\r\n\r\n    if(type == \"nameAsc\"){\r\n        let sortedFiles = files.sort((a, b) => {\r\n            return a.name.localeCompare(b.name)\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return a.name.localeCompare(b.name)\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n    else if(type == \"sizeAsc\"){\r\n        let sortedFiles = files.sort((a, b) => {\r\n            return a.size - b.size\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return b.timestamp - a.timestamp\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n    else if(type == \"dateAsc\"){\r\n        let sortedFiles = files.sort((a, b) => {\r\n            return a.timestamp - b.timestamp\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return a.timestamp - b.timestamp\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n    else if(type == \"typeAsc\"){\r\n        let sortedFiles = files.sort((a, b) => {\r\n            if(typeof a.mime == \"undefined\"){\r\n                a.mime = \"_\"\r\n            }\r\n\r\n            if(typeof b.mime == \"undefined\"){\r\n                b.mime = \"_\"\r\n            }\r\n\r\n            if(a.mime.length <= 1){\r\n                a.mime = \"_\"\r\n            }\r\n\r\n            if(b.mime.length <= 1){\r\n                b.mime = \"_\"\r\n            }\r\n\r\n            return a.mime.localeCompare(b.mime)\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return b.timestamp - a.timestamp\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n    else if(type == \"nameDesc\"){\r\n        let sortedFiles = files.sort((a, b) => {\r\n            return b.name.localeCompare(a.name)\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return b.name.localeCompare(a.name)\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n    else if(type == \"sizeDesc\"){\r\n        let sortedFiles = files.sort((a, b) => {\r\n            return b.size - a.size\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return b.timestamp - a.timestamp\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n    else if(type == \"typeDesc\"){\r\n        let sortedFiles = files.sort((a, b) => {\r\n            if(typeof a.mime == \"undefined\"){\r\n                a.mime = \"_\"\r\n            }\r\n\r\n            if(typeof b.mime == \"undefined\"){\r\n                b.mime = \"_\"\r\n            }\r\n\r\n            if(a.mime.length <= 1){\r\n                a.mime = \"_\"\r\n            }\r\n\r\n            if(b.mime.length <= 1){\r\n                b.mime = \"_\"\r\n            }\r\n\r\n            return b.mime.localeCompare(a.mime)\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return b.timestamp - a.timestamp\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n    else{\r\n        //default, dateDesc\r\n\r\n        let sortedFiles = files.sort((a, b) => {\r\n            return b.timestamp - a.timestamp\r\n        })\r\n\r\n        let sortedFolders = folders.sort((a, b) => {\r\n            return b.timestamp - a.timestamp\r\n        })\r\n\r\n        return sortedFolders.concat(sortedFiles)\r\n    }\r\n}\r\n\r\nexport function getVideoCover(file, seekTo = 0.0) {\r\n    return new Promise((resolve, reject) => {\r\n        // load the file to a video player\r\n        const videoPlayer = document.createElement('video');\r\n        videoPlayer.setAttribute('src', URL.createObjectURL(file));\r\n        videoPlayer.load();\r\n        videoPlayer.addEventListener('error', (ex) => {\r\n            reject(\"error when loading video file\", ex);\r\n        });\r\n        // load metadata of the video to get video duration and dimensions\r\n        videoPlayer.addEventListener('loadedmetadata', () => {\r\n            // seek to user defined timestamp (in seconds) if possible\r\n            if (videoPlayer.duration < seekTo) {\r\n                reject(\"video is too short.\");\r\n                return;\r\n            }\r\n\r\n            if(videoPlayer.duration >= 1){\r\n            \tseekTo = 1.0\r\n            }\r\n\r\n            // delay seeking or else 'seeked' event won't fire on Safari\r\n            setTimeout(() => {\r\n              videoPlayer.currentTime = seekTo;\r\n            }, 200);\r\n            // extract video thumbnail once seeking is complete\r\n            videoPlayer.addEventListener('seeked', () => {\r\n                // define a canvas to have the same dimension as the video\r\n                const canvas = document.createElement(\"canvas\");\r\n                canvas.width = videoPlayer.videoWidth;\r\n                canvas.height = videoPlayer.videoHeight;\r\n                // draw the video frame to canvas\r\n                const ctx = canvas.getContext(\"2d\");\r\n                ctx.drawImage(videoPlayer, 0, 0, canvas.width, canvas.height);\r\n                // return the canvas image as a blob\r\n                ctx.canvas.toBlob(\r\n                    blob => {\r\n                        resolve(blob);\r\n                    },\r\n                    \"image/jpeg\",\r\n                    0.1 /* quality */\r\n                );\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nexport function getLanguageSelection(){\r\n    return `\r\n        <ion-select-option value=\"en\">English</ion-select-option>\r\n        <ion-select-option value=\"de\">Deutsch</ion-select-option>\r\n        <ion-select-option value=\"nl\">Nederlands</ion-select-option>\r\n        <ion-select-option value=\"hi\">हिन्दी, हिंदी</ion-select-option>\r\n        <ion-select-option value=\"fr\">Français</ion-select-option>\r\n        <ion-select-option value=\"da\">Dansk</ion-select-option>\r\n        <ion-select-option value=\"es\">Español</ion-select-option>\r\n    `\r\n}\r\n\r\nexport function getFolderColorStyle(color = null, onlyColor = false){\r\n\tlet folderColorStyle = \"\"\r\n\r\n\tswitch(color){\r\n\t\tcase \"default\":\r\n            folderColorStyle = \"style='color: #F6C358;'\"\r\n            \r\n            if(onlyColor){\r\n                folderColorStyle = \"#F6C358\"\r\n            }\r\n\t\tbreak\r\n\t\tcase \"blue\":\r\n            folderColorStyle = \"style='color: #2992E5;'\"\r\n            \r\n            if(onlyColor){\r\n                folderColorStyle = \"#2992E5\"\r\n            }\r\n\t\tbreak\r\n\t\tcase \"green\":\r\n            folderColorStyle = \"style='color: #57A15B;'\"\r\n            \r\n            if(onlyColor){\r\n                folderColorStyle = \"#57A15B\"\r\n            }\r\n\t\tbreak\r\n\t\tcase \"purple\":\r\n            folderColorStyle = \"style='color: #8E3A9D;'\"\r\n            \r\n            if(onlyColor){\r\n                folderColorStyle = \"#8E3A9D\"\r\n            }\r\n\t\tbreak\r\n\t\tcase \"red\":\r\n            folderColorStyle = \"style='color: #CB2E35;'\"\r\n            \r\n            if(onlyColor){\r\n                folderColorStyle = \"#CB2E35\"\r\n            }\r\n\t\tbreak\r\n\t\tcase \"gray\":\r\n            folderColorStyle = \"style='color: gray;'\"\r\n            \r\n            if(onlyColor){\r\n                folderColorStyle = \"gray\"\r\n            }\r\n\t\tbreak\r\n\t\tdefault:\r\n            folderColorStyle = \"style='color: #F6C358;'\"\r\n            \r\n            if(onlyColor){\r\n                folderColorStyle = \"#F6C358\"\r\n            }\r\n\t\tbreak\r\n\t}\r\n\r\n\treturn folderColorStyle\r\n}\r\n\r\nexport function copyTextToClipboardWeb(text){\r\n\tvar textArea = document.createElement(\"textarea\")\r\n\r\n\ttextArea.style.position = \"fixed\"\r\n\ttextArea.style.top = 0\r\n\ttextArea.style.left = 0\r\n\ttextArea.style.width = \"2em\"\r\n\ttextArea.style.height = \"2em\"\r\n\ttextArea.style.padding = 0\r\n\ttextArea.style.border = \"none\"\r\n\ttextArea.style.outline = \"none\"\r\n\ttextArea.style.boxShadow = \"none\"\r\n\ttextArea.style.background = \"transparent\"\r\n\r\n\ttextArea.value = text\r\n\r\n\tdocument.body.appendChild(textArea)\r\n\r\n\ttextArea.focus()\r\n\ttextArea.select()\r\n\r\n\ttry{\r\n\t\tdocument.execCommand(\"copy\")\r\n\t}\r\n\tcatch(e){\r\n\t\treturn console.log(e)\r\n\t}\r\n\r\n\t//alert(\"Link copied to clipboard!\")\r\n\r\n\treturn document.body.removeChild(textArea)\r\n}"]},"metadata":{},"sourceType":"module"}